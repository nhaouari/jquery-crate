var session=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=222)}([function(e,t,n){"use strict";var r,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":o(window))&&(r=window)}e.exports=r},function(e,t,n){"use strict";(function(e,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=200,i="__lodash_hash_undefined__",s=800,a=16,c=9007199254740991,u="[object Arguments]",l="[object AsyncFunction]",f="[object Function]",h="[object GeneratorFunction]",p="[object Null]",d="[object Object]",y="[object Proxy]",g="[object Undefined]",v=/^\[object .+?Constructor\]$/,m=/^(?:0|[1-9]\d*)$/,b={};b["[object Float32Array]"]=b["[object Float64Array]"]=b["[object Int8Array]"]=b["[object Int16Array]"]=b["[object Int32Array]"]=b["[object Uint8Array]"]=b["[object Uint8ClampedArray]"]=b["[object Uint16Array]"]=b["[object Uint32Array]"]=!0,b[u]=b["[object Array]"]=b["[object ArrayBuffer]"]=b["[object Boolean]"]=b["[object DataView]"]=b["[object Date]"]=b["[object Error]"]=b[f]=b["[object Map]"]=b["[object Number]"]=b[d]=b["[object RegExp]"]=b["[object Set]"]=b["[object String]"]=b["[object WeakMap]"]=!1;var _="object"==(void 0===e?"undefined":r(e))&&e&&e.Object===Object&&e,w="object"==("undefined"==typeof self?"undefined":r(self))&&self&&self.Object===Object&&self,C=_||w||Function("return this")(),k="object"==r(t)&&t&&!t.nodeType&&t,E=k&&"object"==r(n)&&n&&!n.nodeType&&n,S=E&&E.exports===k,O=S&&_.process,x=function(){try{return O&&O.binding&&O.binding("util")}catch(e){}}(),A=x&&x.isTypedArray;function T(e,t){return"__proto__"==t?void 0:e[t]}var j,P,R,M=Array.prototype,I=Function.prototype,F=Object.prototype,N=C["__core-js_shared__"],D=I.toString,B=F.hasOwnProperty,L=(j=/[^.]+$/.exec(N&&N.keys&&N.keys.IE_PROTO||""))?"Symbol(src)_1."+j:"",U=F.toString,q=D.call(Object),z=RegExp("^"+D.call(B).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),V=S?C.Buffer:void 0,W=C.Symbol,J=C.Uint8Array,H=V?V.allocUnsafe:void 0,$=(P=Object.getPrototypeOf,R=Object,function(e){return P(R(e))}),Y=Object.create,Q=F.propertyIsEnumerable,X=M.splice,G=W?W.toStringTag:void 0,Z=function(){try{var e=ke(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),K=V?V.isBuffer:void 0,ee=Math.max,te=Date.now,ne=ke(C,"Map"),re=ke(Object,"create"),oe=function(){function e(){}return function(t){if(!Ie(t))return{};if(Y)return Y(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function ie(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function se(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ae(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ce(e){var t=this.__data__=new se(e);this.size=t.size}function ue(e,t){var n=Te(e),r=!n&&Ae(e),o=!n&&!r&&Pe(e),i=!n&&!r&&!o&&Ne(e),s=n||r||o||i,a=s?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],c=a.length;for(var u in e)!t&&!B.call(e,u)||s&&("length"==u||o&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Ee(u,c))||a.push(u);return a}function le(e,t,n){(void 0===n||xe(e[t],n))&&(void 0!==n||t in e)||pe(e,t,n)}function fe(e,t,n){var r=e[t];B.call(e,t)&&xe(r,n)&&(void 0!==n||t in e)||pe(e,t,n)}function he(e,t){for(var n=e.length;n--;)if(xe(e[n][0],t))return n;return-1}function pe(e,t,n){"__proto__"==t&&Z?Z(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}ie.prototype.clear=function(){this.__data__=re?re(null):{},this.size=0},ie.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ie.prototype.get=function(e){var t=this.__data__;if(re){var n=t[e];return n===i?void 0:n}return B.call(t,e)?t[e]:void 0},ie.prototype.has=function(e){var t=this.__data__;return re?void 0!==t[e]:B.call(t,e)},ie.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=re&&void 0===t?i:t,this},se.prototype.clear=function(){this.__data__=[],this.size=0},se.prototype.delete=function(e){var t=this.__data__,n=he(t,e);return!(n<0||(n==t.length-1?t.pop():X.call(t,n,1),--this.size,0))},se.prototype.get=function(e){var t=this.__data__,n=he(t,e);return n<0?void 0:t[n][1]},se.prototype.has=function(e){return he(this.__data__,e)>-1},se.prototype.set=function(e,t){var n=this.__data__,r=he(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},ae.prototype.clear=function(){this.size=0,this.__data__={hash:new ie,map:new(ne||se),string:new ie}},ae.prototype.delete=function(e){var t=Ce(this,e).delete(e);return this.size-=t?1:0,t},ae.prototype.get=function(e){return Ce(this,e).get(e)},ae.prototype.has=function(e){return Ce(this,e).has(e)},ae.prototype.set=function(e,t){var n=Ce(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},ce.prototype.clear=function(){this.__data__=new se,this.size=0},ce.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},ce.prototype.get=function(e){return this.__data__.get(e)},ce.prototype.has=function(e){return this.__data__.has(e)},ce.prototype.set=function(e,t){var n=this.__data__;if(n instanceof se){var r=n.__data__;if(!ne||r.length<o-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new ae(r)}return n.set(e,t),this.size=n.size,this};var de,ye=function(e,t,n){for(var r=-1,o=Object(e),i=n(e),s=i.length;s--;){var a=i[de?s:++r];if(!1===t(o[a],a,o))break}return e};function ge(e){return null==e?void 0===e?g:p:G&&G in Object(e)?function(e){var t=B.call(e,G),n=e[G];try{e[G]=void 0;var r=!0}catch(e){}var o=U.call(e);r&&(t?e[G]=n:delete e[G]);return o}(e):function(e){return U.call(e)}(e)}function ve(e){return Fe(e)&&ge(e)==u}function me(e){return!(!Ie(e)||L&&L in e)&&(Re(e)?z:v).test(function(e){if(null!=e){try{return D.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e))}function be(e){if(!Ie(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=Se(e),n=[];for(var r in e)("constructor"!=r||!t&&B.call(e,r))&&n.push(r);return n}function _e(e,t,n,r,o){e!==t&&ye(t,function(i,s){if(Ie(i))o||(o=new ce),function(e,t,n,r,o,i,s){var a=T(e,n),c=T(t,n),u=s.get(c);if(u)return void le(e,n,u);var l=i?i(a,c,n+"",e,t,s):void 0,f=void 0===l;if(f){var h=Te(c),p=!h&&Pe(c),y=!h&&!p&&Ne(c);l=c,h||p||y?Te(a)?l=a:Fe(_=a)&&je(_)?l=function(e,t){var n=-1,r=e.length;t||(t=Array(r));for(;++n<r;)t[n]=e[n];return t}(a):p?(f=!1,l=function(e,t){if(t)return e.slice();var n=e.length,r=H?H(n):new e.constructor(n);return e.copy(r),r}(c,!0)):y?(f=!1,g=c,v=!0?(m=g.buffer,b=new m.constructor(m.byteLength),new J(b).set(new J(m)),b):g.buffer,l=new g.constructor(v,g.byteOffset,g.length)):l=[]:function(e){if(!Fe(e)||ge(e)!=d)return!1;var t=$(e);if(null===t)return!0;var n=B.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&D.call(n)==q}(c)||Ae(c)?(l=a,Ae(a)?l=function(e){return function(e,t,n,r){var o=!n;n||(n={});var i=-1,s=t.length;for(;++i<s;){var a=t[i],c=r?r(n[a],e[a],a,n,e):void 0;void 0===c&&(c=e[a]),o?pe(n,a,c):fe(n,a,c)}return n}(e,De(e))}(a):(!Ie(a)||r&&Re(a))&&(l=function(e){return"function"!=typeof e.constructor||Se(e)?{}:oe($(e))}(c))):f=!1}var g,v,m,b;var _;f&&(s.set(c,l),o(l,c,r,i,s),s.delete(c));le(e,n,l)}(e,t,s,n,_e,r,o);else{var a=r?r(T(e,s),i,s+"",e,t,o):void 0;void 0===a&&(a=i),le(e,s,a)}},De)}function we(e,t){return Oe(function(e,t,n){return t=ee(void 0===t?e.length-1:t,0),function(){for(var r=arguments,o=-1,i=ee(r.length-t,0),s=Array(i);++o<i;)s[o]=r[t+o];o=-1;for(var a=Array(t+1);++o<t;)a[o]=r[o];return a[t]=n(s),function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}(e,this,a)}}(e,t,Ue),e+"")}function Ce(e,t){var n,o,i=e.__data__;return("string"==(o=void 0===(n=t)?"undefined":r(n))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function ke(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return me(n)?n:void 0}function Ee(e,t){var n=void 0===e?"undefined":r(e);return!!(t=null==t?c:t)&&("number"==n||"symbol"!=n&&m.test(e))&&e>-1&&e%1==0&&e<t}function Se(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||F)}var Oe=function(e){var t=0,n=0;return function(){var r=te(),o=a-(r-n);if(n=r,o>0){if(++t>=s)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(Z?function(e,t){return Z(e,"toString",{configurable:!0,enumerable:!1,value:(n=t,function(){return n}),writable:!0});var n}:Ue);function xe(e,t){return e===t||e!=e&&t!=t}var Ae=ve(function(){return arguments}())?ve:function(e){return Fe(e)&&B.call(e,"callee")&&!Q.call(e,"callee")},Te=Array.isArray;function je(e){return null!=e&&Me(e.length)&&!Re(e)}var Pe=K||function(){return!1};function Re(e){if(!Ie(e))return!1;var t=ge(e);return t==f||t==h||t==l||t==y}function Me(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=c}function Ie(e){var t=void 0===e?"undefined":r(e);return null!=e&&("object"==t||"function"==t)}function Fe(e){return null!=e&&"object"==(void 0===e?"undefined":r(e))}var Ne=A?function(e){return function(t){return e(t)}}(A):function(e){return Fe(e)&&Me(e.length)&&!!b[ge(e)]};function De(e){return je(e)?ue(e,!0):be(e)}var Be,Le=(Be=function(e,t,n){_e(e,t,n)},we(function(e,t){var n=-1,o=t.length,i=o>1?t[o-1]:void 0,s=o>2?t[2]:void 0;for(i=Be.length>3&&"function"==typeof i?(o--,i):void 0,s&&function(e,t,n){if(!Ie(n))return!1;var o=void 0===t?"undefined":r(t);return!!("number"==o?je(n)&&Ee(t,n.length):"string"==o&&t in n)&&xe(n[t],e)}(t[0],t[1],s)&&(i=o<3?void 0:i,o=1),e=Object(e);++n<o;){var a=t[n];a&&Be(e,a,n,i)}return e}));function Ue(e){return e}n.exports=Le}).call(this,n(0),n(15)(e))},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function s(e){return"object"===(void 0===e?"undefined":r(e))&&null!==e}function a(e){return void 0===e}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},o.prototype.emit=function(e){var t,n,r,o,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(a(n=this._events[e]))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,o=new Array(r-1),c=1;c<r;c++)o[c-1]=arguments[c];n.apply(this,o)}else if(s(n)){for(r=arguments.length,o=new Array(r-1),c=1;c<r;c++)o[c-1]=arguments[c];for(r=(u=n.slice()).length,c=0;c<r;c++)u[c].apply(this,o)}return!0},o.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned)&&((n=a(this._maxListeners)?o.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()));return this},o.prototype.on=o.prototype.addListener,o.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var n=!1;function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}return r.listener=t,this.on(e,r),this},o.prototype.removeListener=function(e,t){var n,r,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(n=this._events[e]).length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=o;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){r=a;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},o.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(n=this._events[e]))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},o.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},o.listenerCount=function(e,t){return e._events&&e._events[t]?i(e._events[t])?1:e._events[t].length:0}},function(e,t,n){"use strict";(function(r){var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(195)).log=function(){return"object"===("undefined"==typeof console?"undefined":o(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++o)}),e.splice(i,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,n(4))},function(e,t,n){"use strict";var r,o,i=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(e){if(r===setTimeout)return setTimeout(e,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(e){r=s}try{o="function"==typeof clearTimeout?clearTimeout:a}catch(e){o=a}}();var u,l=[],f=!1,h=-1;function p(){f&&u&&(f=!1,u.length?l=u.concat(l):h=-1,l.length&&d())}function d(){if(!f){var e=c(p);f=!0;for(var t=l.length;t;){for(u=l,l=[];++h<t;)u&&u[h].run();h=-1,t=l.length}u=null,f=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function y(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new y(e,t)),1!==l.length||f||c(d)},y.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";var r=n(212),o=n(211);e.exports=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||r)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[i+a]=s[a];return t||o(s)}},function(e,t,n){"use strict";(function(t){var n=Object.assign?Object.assign:function(e,t,n,r){for(var o=1;o<arguments.length;o++)a(Object(arguments[o]),function(t,n){e[n]=t});return e},r=function(){if(Object.create)return function(e,t,r,o){var i=s(arguments,1);return n.apply(this,[Object.create(e)].concat(i))};var e=function(){};return function(t,r,o,i){var a=s(arguments,1);return e.prototype=t,n.apply(this,[new e].concat(a))}}(),o=String.prototype.trim?function(e){return String.prototype.trim.call(e)}:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},i="undefined"!=typeof window?window:t;function s(e,t){return Array.prototype.slice.call(e,t||0)}function a(e,t){c(e,function(e,n){return t(e,n),!1})}function c(e,t){if(u(e)){for(var n=0;n<e.length;n++)if(t(e[n],n))return e[n]}else for(var r in e)if(e.hasOwnProperty(r)&&t(e[r],r))return e[r]}function u(e){return null!=e&&"function"!=typeof e&&"number"==typeof e.length}e.exports={assign:n,create:r,trim:o,bind:function(e,t){return function(){return t.apply(e,Array.prototype.slice.call(arguments,0))}},slice:s,each:a,map:function(e,t){var n=u(e)?[]:{};return c(e,function(e,r){return n[r]=t(e,r),!1}),n},pluck:c,isList:u,isFunction:function(e){return e&&"[object Function]"==={}.toString.call(e)},isObject:function(e){return e&&"[object Object]"==={}.toString.call(e)},Global:i}}).call(this,n(0))},function(e,t,n){"use strict";(function(e){var r,o=n(174),i=n(46),s=n(172),a=n(171),c=n(170);e&&e.ArrayBuffer&&(r=n(169));var u="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),l="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),f=u||l;t.protocol=3;var h=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},p=o(h),d={type:"error",data:"parser error"},y=n(168);function g(e,t,n){for(var r=new Array(e.length),o=a(e.length,n),i=function(e,n,o){t(n,function(t,n){r[e]=n,o(t,r)})},s=0;s<e.length;s++)i(s,e[s],o)}t.encodePacket=function(n,r,o,i){"function"==typeof r&&(i=r,r=!1),"function"==typeof o&&(i=o,o=null);var s=void 0===n.data?void 0:n.data.buffer||n.data;if(e.ArrayBuffer&&s instanceof ArrayBuffer)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var o=e.data,i=new Uint8Array(o),s=new Uint8Array(1+o.byteLength);s[0]=h[e.type];for(var a=0;a<i.length;a++)s[a+1]=i[a];return r(s.buffer)}(n,r,i);if(y&&s instanceof e.Blob)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);if(f)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var o=new FileReader;return o.onload=function(){e.data=o.result,t.encodePacket(e,n,!0,r)},o.readAsArrayBuffer(e.data)}(e,n,r);var o=new Uint8Array(1);o[0]=h[e.type];var i=new y([o.buffer,e.data]);return r(i)}(n,r,i);if(s&&s.base64)return function(e,n){var r="b"+t.packets[e.type]+e.data.data;return n(r)}(n,i);var a=h[n.type];return void 0!==n.data&&(a+=o?c.encode(String(n.data),{strict:!1}):String(n.data)),i(""+a)},t.encodeBase64Packet=function(n,r){var o,i="b"+t.packets[n.type];if(y&&n.data instanceof e.Blob){var s=new FileReader;return s.onload=function(){var e=s.result.split(",")[1];r(i+e)},s.readAsDataURL(n.data)}try{o=String.fromCharCode.apply(null,new Uint8Array(n.data))}catch(e){for(var a=new Uint8Array(n.data),c=new Array(a.length),u=0;u<a.length;u++)c[u]=a[u];o=String.fromCharCode.apply(null,c)}return i+=e.btoa(o),r(i)},t.decodePacket=function(e,n,r){if(void 0===e)return d;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(r&&!1===(e=function(e){try{e=c.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return d;var o=e.charAt(0);return Number(o)==o&&p[o]?e.length>1?{type:p[o],data:e.substring(1)}:{type:p[o]}:d}o=new Uint8Array(e)[0];var i=s(e,1);return y&&"blob"===n&&(i=new y([i])),{type:p[o],data:i}},t.decodeBase64Packet=function(e,t){var n=p[e.charAt(0)];if(!r)return{type:n,data:{base64:!0,data:e.substr(1)}};var o=r.decode(e.substr(1));return"blob"===t&&y&&(o=new y([o])),{type:n,data:o}},t.encodePayload=function(e,n,r){"function"==typeof n&&(r=n,n=null);var o=i(e);if(n&&o)return y&&!f?t.encodePayloadAsBlob(e,r):t.encodePayloadAsArrayBuffer(e,r);if(!e.length)return r("0:");g(e,function(e,r){t.encodePacket(e,!!o&&n,!1,function(e){r(null,function(e){return e.length+":"+e}(e))})},function(e,t){return r(t.join(""))})},t.decodePayload=function(e,n,r){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,r);var o;if("function"==typeof n&&(r=n,n=null),""===e)return r(d,0,1);for(var i,s,a="",c=0,u=e.length;c<u;c++){var l=e.charAt(c);if(":"===l){if(""===a||a!=(i=Number(a)))return r(d,0,1);if(a!=(s=e.substr(c+1,i)).length)return r(d,0,1);if(s.length){if(o=t.decodePacket(s,n,!1),d.type===o.type&&d.data===o.data)return r(d,0,1);if(!1===r(o,c+i,u))return}c+=i,a=""}else a+=l}return""!==a?r(d,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){if(!e.length)return n(new ArrayBuffer(0));g(e,function(e,n){t.encodePacket(e,!0,!0,function(e){return n(null,e)})},function(e,t){var r=t.reduce(function(e,t){var n;return e+(n="string"==typeof t?t.length:t.byteLength).toString().length+n+2},0),o=new Uint8Array(r),i=0;return t.forEach(function(e){var t="string"==typeof e,n=e;if(t){for(var r=new Uint8Array(e.length),s=0;s<e.length;s++)r[s]=e.charCodeAt(s);n=r.buffer}o[i++]=t?0:1;var a=n.byteLength.toString();for(s=0;s<a.length;s++)o[i++]=parseInt(a[s]);o[i++]=255;for(r=new Uint8Array(n),s=0;s<r.length;s++)o[i++]=r[s]}),n(o.buffer)})},t.encodePayloadAsBlob=function(e,n){g(e,function(e,n){t.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var r=new Uint8Array(e.length),o=0;o<e.length;o++)r[o]=e.charCodeAt(o);e=r.buffer,t[0]=0}var i=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),s=new Uint8Array(i.length+1);for(o=0;o<i.length;o++)s[o]=parseInt(i[o]);if(s[i.length]=255,y){var a=new y([t.buffer,s.buffer,e]);n(null,a)}})},function(e,t){return n(new y(t))})},t.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var o=e,i=[];o.byteLength>0;){for(var a=new Uint8Array(o),c=0===a[0],u="",l=1;255!==a[l];l++){if(u.length>310)return r(d,0,1);u+=a[l]}o=s(o,2+u.length),u=parseInt(u);var f=s(o,0,u);if(c)try{f=String.fromCharCode.apply(null,new Uint8Array(f))}catch(e){var h=new Uint8Array(f);f="";for(l=0;l<h.length;l++)f+=String.fromCharCode(h[l])}i.push(f),o=s(o,u)}var p=i.length;i.forEach(function(e,o){r(t.decodePacket(e,n,!0),o,p)})}}).call(this,n(0))},function(e,t,n){"use strict";function r(e){if(e)return function(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}(e)}e.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<r.length;o++)if((n=r[o])===t||n.fn===t){r.splice(o,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var r=0,o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,t);return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,n){"use strict";var r=n(19),o=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=f;var i=n(13);i.inherits=n(10);var s=n(61),a=n(57);i.inherits(f,s);for(var c=o(a.prototype),u=0;u<c.length;u++){var l=c[u];f.prototype[l]||(f.prototype[l]=a.prototype[l])}function f(e){if(!(this instanceof f))return new f(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",h)}function h(){this.allowHalfOpen||this._writableState.ended||r.nextTick(p,this)}function p(e){e.end()}Object.defineProperty(f.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(f.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),f.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},function(e,t,n){"use strict";"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=1e3,i=60*o,s=60*i,a=24*s,c=365.25*a;function u(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var n,l=void 0===e?"undefined":r(e);if("string"===l&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*c;case"days":case"day":case"d":return n*a;case"hours":case"hour":case"hrs":case"hr":case"h":return n*s;case"minutes":case"minute":case"mins":case"min":case"m":return n*i;case"seconds":case"second":case"secs":case"sec":case"s":return n*o;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===l&&!1===isNaN(e))return t.long?u(n=e,a,"day")||u(n,s,"hour")||u(n,i,"minute")||u(n,o,"second")||n+" ms":function(e){if(e>=a)return Math.round(e/a)+"d";if(e>=s)return Math.round(e/s)+"h";if(e>=i)return Math.round(e/i)+"m";if(e>=o)return Math.round(e/o)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(2),i=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._rps=n._buildRPS(e),n._options=e,n._id=n._rps.PEER,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"_buildRPS",value:function(e){throw new Error("A valid network must implement a _buildRPS method using options",e)}},{key:"getNeighbours",value:function(e){throw new Error("A valid network must implement a getNeighbours method with limit",e)}},{key:"id",get:function(){return this._id}},{key:"rps",get:function(){return this._rps}},{key:"inviewId",get:function(){throw new Error("A valid network must implement a inviewId getter")}},{key:"outviewId",get:function(){throw new Error("A valid network must implement a outviewId getter")}}]),t}();e.exports=i},function(e,t,n){"use strict";(function(e){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function r(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===r(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"===(void 0===e?"undefined":n(e))},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===r(e)},t.isObject=function(e){return"object"===(void 0===e?"undefined":n(e))&&null!==e},t.isDate=function(e){return"[object Date]"===r(e)},t.isError=function(e){return"[object Error]"===r(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"===(void 0===e?"undefined":n(e))||void 0===e},t.isBuffer=e.isBuffer}).call(this,n(18).Buffer)},function(e,t,n){"use strict";var r=n(18),o=r.Buffer;function i(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return o(e,t,n)}o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?e.exports=r:(i(r,t),t.Buffer=s),i(o,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return o(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=o(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,n){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";e.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";t.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},t.decode=function(e){for(var t={},n=e.split("&"),r=0,o=n.length;r<o;r++){var i=n[r].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var r=n(192),o=n(191),i=n(60);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return f(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=h(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|d(t,n),o=(e=a(e,r)).write(t,n);o!==r&&(e=e.slice(0,o));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|p(t.length);return 0===(e=a(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?a(e,0):h(e,t);if("Buffer"===t.type&&i(t.data))return h(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function f(e,t){if(l(t),e=a(e,t<0?0:0|p(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function h(e,t){var n=t.length<0?0:0|p(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function p(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function d(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return q(e).length;default:if(r)return U(e).length;t=(""+t).toLowerCase(),r=!0}}function y(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,o){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:v(e,t,n,r,o);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,r,o);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,o){var i,s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(o){var l=-1;for(i=n;i<a;i++)if(u(e,i)===u(t,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===c)return l*s}else-1!==l&&(i-=i-l),l=-1}else for(n+c>a&&(n=a-c),i=n;i>=0;i--){for(var f=!0,h=0;h<c;h++)if(u(e,i+h)!==u(t,h)){f=!1;break}if(f)return i}return-1}function m(e,t,n,r){n=Number(n)||0;var o=e.length-n;r?(r=Number(r))>o&&(r=o):r=o;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function b(e,t,n,r){return z(U(t,e.length-n),e,n,r)}function _(e,t,n,r){return z(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function w(e,t,n,r){return _(e,t,n,r)}function C(e,t,n,r){return z(q(t),e,n,r)}function k(e,t,n,r){return z(function(e,t){for(var n,r,o,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,o=n%256,i.push(o),i.push(r);return i}(t,e.length-n),e,n,r)}function E(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function S(e,t,n){n=Math.min(e.length,n);for(var r=[],o=t;o<n;){var i,s,a,c,u=e[o],l=null,f=u>239?4:u>223?3:u>191?2:1;if(o+f<=n)switch(f){case 1:u<128&&(l=u);break;case 2:128==(192&(i=e[o+1]))&&(c=(31&u)<<6|63&i)>127&&(l=c);break;case 3:i=e[o+1],s=e[o+2],128==(192&i)&&128==(192&s)&&(c=(15&u)<<12|(63&i)<<6|63&s)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:i=e[o+1],s=e[o+2],a=e[o+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&i)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(l=c)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),o+=f}return function(e){var t=e.length;if(t<=O)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=O));return n}(r)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?a(e,t):void 0!==n?"string"==typeof r?a(e,t).fill(n,r):a(e,t).fill(n):a(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return f(null,e)},c.allocUnsafeSlow=function(e){return f(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,o=0,i=Math.min(n,r);o<i;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!i(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){var s=e[n];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,o),o+=s.length}return r},c.byteLength=d,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)y(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?S(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return T(this,t,n);case"utf8":case"utf-8":return S(this,t,n);case"ascii":return x(this,t,n);case"latin1":case"binary":return A(this,t,n);case"base64":return E(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,o){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),t<0||n>e.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&t>=n)return 0;if(r>=o)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,o>>>=0,this===e)return 0;for(var i=o-r,s=n-t,a=Math.min(i,s),u=this.slice(r,o),l=e.slice(t,n),f=0;f<a;++f)if(u[f]!==l[f]){i=u[f],s=l[f];break}return i<s?-1:s<i?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-t;if((void 0===n||n>o)&&(n=o),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return m(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return _(this,e,t,n);case"latin1":case"binary":return w(this,e,t,n);case"base64":return C(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var O=4096;function x(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(127&e[o]);return r}function A(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(e[o]);return r}function T(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var o="",i=t;i<n;++i)o+=L(e[i]);return o}function j(e,t,n){for(var r=e.slice(t,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function P(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,n,r,o,i){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function M(e,t,n,r){t<0&&(t=65535+t+1);for(var o=0,i=Math.min(e.length-n,2);o<i;++o)e[n+o]=(t&255<<8*(r?o:1-o))>>>8*(r?o:1-o)}function I(e,t,n,r){t<0&&(t=4294967295+t+1);for(var o=0,i=Math.min(e.length-n,4);o<i;++o)e[n+o]=t>>>8*(r?o:3-o)&255}function F(e,t,n,r,o,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function N(e,t,n,r,i){return i||F(e,0,n,4),o.write(e,t,n,r,23,4),n+4}function D(e,t,n,r,i){return i||F(e,0,n,8),o.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n,r=this.length;if(e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var o=t-e;n=new c(o,void 0);for(var i=0;i<o;++i)n[i]=this[i+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=this[e],o=1,i=0;++i<t&&(o*=256);)r+=this[e+i]*o;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=this[e+--t],o=1;t>0&&(o*=256);)r+=this[e+--t]*o;return r},c.prototype.readUInt8=function(e,t){return t||P(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||P(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||P(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=this[e],o=1,i=0;++i<t&&(o*=256);)r+=this[e+i]*o;return r>=(o*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=t,o=1,i=this[e+--r];r>0&&(o*=256);)i+=this[e+--r]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*t)),i},c.prototype.readInt8=function(e,t){return t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||P(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||P(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||P(e,4,this.length),o.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||P(e,4,this.length),o.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||P(e,8,this.length),o.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||P(e,8,this.length),o.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||R(this,e,t,n,Math.pow(2,8*n)-1,0);var o=1,i=0;for(this[t]=255&e;++i<n&&(o*=256);)this[t+i]=e/o&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||R(this,e,t,n,Math.pow(2,8*n)-1,0);var o=n-1,i=1;for(this[t+o]=255&e;--o>=0&&(i*=256);)this[t+o]=e/i&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):I(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):I(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var o=Math.pow(2,8*n-1);R(this,e,t,n,o-1,-o)}var i=0,s=1,a=0;for(this[t]=255&e;++i<n&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var o=Math.pow(2,8*n-1);R(this,e,t,n,o-1,-o)}var i=n-1,s=1,a=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):I(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):I(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return N(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return N(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return D(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return D(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var o,i=r-n;if(this===e&&n<t&&t<r)for(o=i-1;o>=0;--o)e[o+t]=this[o+n];else if(i<1e3||!c.TYPED_ARRAY_SUPPORT)for(o=0;o<i;++o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var s=c.isBuffer(e)?e:U(new c(e,r).toString()),a=s.length;for(i=0;i<n-t;++i)this[i+t]=s[i%a]}return this};var B=/[^+\/0-9A-Za-z-_]/g;function L(e){return e<16?"0"+e.toString(16):e.toString(16)}function U(e,t){var n;t=t||1/0;for(var r=e.length,o=null,i=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!o){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&i.push(239,191,189);continue}o=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function q(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(B,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function z(e,t,n,r){for(var o=0;o<r&&!(o+n>=t.length||o>=e.length);++o)t[o+n]=e[o];return o}}).call(this,n(0))},function(e,t,n){"use strict";(function(t){!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,n,r,o){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var i,s,a=arguments.length;switch(a){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick(function(){e.call(null,n)});case 3:return t.nextTick(function(){e.call(null,n,r)});case 4:return t.nextTick(function(){e.call(null,n,r,o)});default:for(i=new Array(a-1),s=0;s<i.length;)i[s++]=arguments[s];return t.nextTick(function(){e.apply(null,i)})}}}:e.exports=t}).call(this,n(4))},function(e,t,n){"use strict";var r,o,i,s=n(219),a="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function c(){i=!1}function u(e){if(e){if(e!==r){if(e.length!==a.length)throw new Error("Custom alphabet for shortid must be "+a.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter(function(e,t,n){return t!==n.lastIndexOf(e)});if(t.length)throw new Error("Custom alphabet for shortid must be "+a.length+" unique characters. These characters were not unique: "+t.join(", "));r=e,c()}}else r!==a&&(r=a,c())}function l(){return i||(i=function(){r||u(a);for(var e,t=r.split(""),n=[],o=s.nextValue();t.length>0;)o=s.nextValue(),e=Math.floor(o*t.length),n.push(t.splice(e,1)[0]);return n.join("")}())}e.exports={characters:function(e){return u(e),r},seed:function(e){s.seed(e),o!==e&&(c(),o=e)},lookup:function(e){return l()[e]},shuffled:l}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.p=t,this.s=n,this.c=r}return r(e,[{key:"compareTo",value:function(e){return this.s===Number.MAX_VALUE&&this.c===Number.MAX_VALUE?1:e.s===Number.MAX_VALUE&&e.s===Number.MAX_VALUE?-1:this.p<e.p?-1:this.p>e.p?1:this.s<e.s?-1:this.s>e.s?1:this.c<e.c?-1:this.c>e.c?1:0}}]),e}();e.exports=o},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(159)("n2n-overlay-wrtc"),s=n(157),a=n(2),c=n(1),u=n(5),l=n(141),f=n(140),h=n(139),p=n(138),d=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.options=c({pid:u(),peer:u(),retry:5},e),n.PID=n.options.pid,n.NI=n.options.inview||new s(c(c({},n.options),{peer:n.options.peer+"-I"})),n.NO=n.options.outview||new s(c(c({},n.options),{peer:n.options.peer+"-O"})),n.II=n.NI.register(n),n.IO=n.NO.register(n),n.PEER=n.II.peer+"|"+n.IO.peer,i("[%s] registered to ==> %s ==>",n.PID,n.PEER),n.i=new Map,n.o=new Map,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),o(t,[{key:"_pid",value:function(){return this.PID}},{key:"_received",value:function(e,t){t.type?"MConnectTo"===t.type||"MForwarded"===t.type||"MForwardTo"===t.type?this._bridge(e,t):"MResponse"===t.type||"MRequest"===t.type||"MDirect"===t.type?this._direct(e,t):this.emit("receive",e,t):this.emit("receive",e,t)}},{key:"_streamed",value:function(e,t){this.emit("stream",e,t)}},{key:"_connected",value:function(e,t){t?(this.o.has(e)||this.o.set(e,0),this.o.set(e,this.o.get(e)+1),this.emit("open",e)):(this.i.has(e)||this.i.set(e,0),this.i.set(e,this.i.get(e)+1))}},{key:"_disconnected",value:function(e){this.o.has(e)?(this.o.set(e,this.o.get(e)-1),this.o.get(e)<=0&&this.o.delete(e),this.emit("close",e)):this.i.has(e)&&(this.i.set(e,this.i.get(e)-1),this.i.get(e)<=0&&this.i.delete(e))}},{key:"_failed",value:function(e,t){t&&this.emit("fail",e)}},{key:"_bridge",value:function(e,t){var n=this;t.type&&"MConnectTo"===t.type?this.IO.connect(function(r){n.send(e,new l(t.from,t.to,r),n.options.retry).catch(function(e){})}):t.type&&"MForwardTo"===t.type?this.send(t.to,new f(t.from,t.to,t.message),this.options.retry).catch(function(e){}):t.type&&"MForwarded"===t.type&&"MRequest"===t.message.type?this.II.connect(function(r){n.send(e,new l(t.to,t.from,r),n.options.retry).catch(function(e){})},t.message):t.type&&"MForwarded"===t.type&&"MResponse"===t.message.type&&this.IO.connect(t.message)}},{key:"_direct",value:function(e,t){var n=this;"MDirect"===t.type&&this.IO.connect(function(t){n.send(e,t,n.options.retry).catch(function(e){})}),"MRequest"===t.type&&this.II.connect(function(t){n.send(e,t,n.options.retry).catch(function(e){})},t),"MResponse"===t.type&&this.IO.connect(t)}},{key:"send",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=void 0;if(this.i.has(e))o=this.II.send(e,t,r);else if(this.o.has(e))o=this.IO.send(e,t,r);else{var i=e.substr(0,e.length-2),s=i+"-I",a=i+"-O";o=this.o.has(s)?this.IO.send(s,t,r):this.i.has(a)?this.II.send(a,t,r):new Promise(function(o,i){!function s(a){n.IO.send(e,t,0).then(function(){return o()}).catch(function(c){return n.II.send(e,t,0).then(function(){return o()}).catch(function(e){a<r?setTimeout(function(){s(a+1)},1e3):i(e)})})}(0)})}return o}},{key:"connect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;"function"==typeof e&&null===t?this.IO.connect(function(t){return e(t)}):"function"==typeof e&&null!==t?(i("[%s] %s <= ??? == %s",this.PID,this.getInviewId(),t.peer),this.II.connect(function(t){return e(t)},t)):null!==e&&"object"===(void 0===e?"undefined":r(e))&&null===t?this.IO.connect(e):(null===e||e!==this.IO.peer&&e!==this.II.peer||(e=null),null===t||t!==this.IO.peer&&t!==this.II.peer||(t=null),null!==e&&null!==t?(i("[%s] %s == %s => %s",this.PID,e,this.PEER,t),this.send(e,new h(e,t),this.options.retry).catch(function(e){})):null!==e?this.send(e,new p,this.options.retry).catch(function(e){}):null!==t&&this._direct(t,new p))}},{key:"disconnect",value:function(e){void 0===e?(this.II.disconnect(),this.IO.disconnect()):(this.i.has(e)&&this.II.disconnect(e),this.o.has(e)&&this.IO.disconnect(e))}},{key:"getInview",value:function(){return new Map(this.i)}},{key:"getInviewId",value:function(){return this.NI.PEER}},{key:"getOutview",value:function(){return new Map(this.o)}},{key:"getOutviewId",value:function(){return this.NO.PEER}}]),t}();e.exports=d},function(e,t,n){"use strict";var r=n(7),o=n(8);function i(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}e.exports=i,o(i.prototype),i.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},i.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},i.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},i.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},i.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},i.prototype.onData=function(e){var t=r.decodePacket(e,this.socket.binaryType);this.onPacket(t)},i.prototype.onPacket=function(e){this.emit("packet",e)},i.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t,n){"use strict";(function(t){var r=n(176);e.exports=function(e){var n=e.xdomain,o=e.xscheme,i=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!n||r))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!o&&i)return new XDomainRequest}catch(e){}if(!n)try{return new(t[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}).call(this,n(0))},function(e,t,n){"use strict";var r=n(3)("socket.io-parser"),o=n(8),i=n(179),s=n(51),a=n(50);function c(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=c,t.Decoder=f;var u=t.ERROR+'"encode error"';function l(e){var n=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(n+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(n+=e.nsp+","),null!=e.id&&(n+=e.id),null!=e.data){var o=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(e.data);if(!1===o)return u;n+=o}return r("encoded %j as %s",e,n),n}function f(){this.reconstructor=null}function h(e){this.reconPack=e,this.buffers=[]}function p(e){return{type:t.ERROR,data:"parser error: "+e}}c.prototype.encode=function(e,n){(r("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type)?function(e,t){i.removeBlobs(e,function(e){var n=i.deconstructPacket(e),r=l(n.packet),o=n.buffers;o.unshift(r),t(o)})}(e,n):n([l(e)])},o(f.prototype),f.prototype.add=function(e){var n;if("string"==typeof e)n=function(e){var n=0,o={type:Number(e.charAt(0))};if(null==t.types[o.type])return p("unknown packet type "+o.type);if(t.BINARY_EVENT===o.type||t.BINARY_ACK===o.type){for(var i="";"-"!==e.charAt(++n)&&(i+=e.charAt(n),n!=e.length););if(i!=Number(i)||"-"!==e.charAt(n))throw new Error("Illegal attachments");o.attachments=Number(i)}if("/"===e.charAt(n+1))for(o.nsp="";++n;){var a=e.charAt(n);if(","===a)break;if(o.nsp+=a,n===e.length)break}else o.nsp="/";var c=e.charAt(n+1);if(""!==c&&Number(c)==c){for(o.id="";++n;){var a=e.charAt(n);if(null==a||Number(a)!=a){--n;break}if(o.id+=e.charAt(n),n===e.length)break}o.id=Number(o.id)}if(e.charAt(++n)){var u=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(n)),l=!1!==u&&(o.type===t.ERROR||s(u));if(!l)return p("invalid payload");o.data=u}return r("decoded %s as %j",e,o),o}(e),t.BINARY_EVENT===n.type||t.BINARY_ACK===n.type?(this.reconstructor=new h(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!a(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(n=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",n))}},f.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},h.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=i.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},h.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t,n){"use strict";(t=e.exports=n(61)).Stream=t,t.Readable=t,t.Writable=n(57),t.Duplex=n(9),t.Transform=n(55),t.PassThrough=n(184)},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(2),i=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._source=e,r._protocol=n,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"send",value:function(e){throw new Error("A valid communication protocol should implement a send method, message:"+e.toString())}},{key:"_receive",value:function(e,t){throw new Error("A valid communication protocol should implement a _receiveMessage method; (id, message)=("+e.toString()+","+t.toString()+")")}}]),t}();e.exports=i},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(208),i=n(207),s=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r._unicast=new i(r._source.rps,{pid:r._protocol}),r._unicast.on(r._protocol,function(e,t){r._receive(e,t)}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"send",value:function(e,t){return this._unicast.emit(this._protocol,e,this._source.outviewId,t)}},{key:"sendMultiple",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments[1];return t.reduce(function(t,r){return t.then(function(){return e.send(r,n)})},Promise.resolve())}},{key:"_receive",value:function(e,t){this.emit("receive",e,t)}}]),t}();e.exports=s},function(e,t,n){"use strict";var r=n(213),o=n(64),i=n(126),s=n(54),a=n(39),c=n(37),u=n(12),l=n(119),f=n(118),h=n(96);e.exports={Foglet:r,protocol:i,Signaling:s,SimplePeerMoc:h,networks:{Spray:a,Cyclon:c},communication:o,abstract:{rps:u,overlay:l,tman:f}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=s(n(83)),i=s(n(80));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(t,n,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),null==n)n={lifeTime:-1,range:{},cursor:!1,isItME:!1};this.options=n,this.origin=t,this.lifeTime=n.lifeTime,this.time=(new Date).getTime(),this.colorRGB=this.constructor.getColor(this.origin,"rgb"),this.colorRGBLight=this.constructor.getColor(this.origin,"rgba"),this.animal=this.constructor.getPseudoname(this.origin,null),this.pseudoName=this.constructor.getPseudoname(this.origin),this.avatarAdd=!1,this.cursor=n.cursor,this._editor=r,r&&(this._editorContainerID=r._editorContainerID),-1!=this.lifeTime&&(n.isItME?this.addAvatar():this.cursor&&this.addCursor(n.range))}return r(e,[{key:"update",value:function(e,t){this.time=(new Date).getTime();var n=$("#"+this._editorContainerID),r=$("#"+this._editorContainerID+" #"+this.origin);!r.length&&n.length&&this.addAvatar(),this.avatarAdd&&(r.attr("data-toggle","tooltip"),r.attr("title",this.pseudoName)),1==this.cursor&&1==t?this._editor.viewEditor.getModule("cursors").moveCursor(this.origin,e):1==t&&(this.cursor=t,this.addCursor(e))}},{key:"checkIfOutdated",value:function(){var e=(new Date).getTime();this.time;return e-this.time>=this.lifeTime&&(this.cursor&&(this._editor.viewEditor.getModule("cursors").removeCursor(this.origin),this.cursor=!1),this.removeAvatar(),!0)}},{key:"addAvatar",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#users";jQuery("#"+this._editorContainerID+" "+t).append(this.getAvatar());var n=$("#"+this._editorContainerID+" #"+this.origin);n.attr("data-toggle","tooltip"),n.attr("title",this.pseudoName),this.avatarAdd=!0,this.options.isItME||(this.timer=setInterval(function(){return e.checkIfOutdated()},1e3))}},{key:"getAvatar",value:function(){return'<div id="'+this.origin+'"style="background-color:'+this.colorRGB+';"><img class="imageuser" src="./icons/'+this.animal+'.png" alt="'+this.pseudoName+'"></div>'}},{key:"removeAvatar",value:function(){$("#"+this._editorContainerID+" #"+this.origin).remove(),this.avatarAdd=!1,clearInterval(this.timer)}},{key:"setPseudo",value:function(e){this.pseudoName=e;var t=$("#"+this._editorContainerID+" #"+this.origin);t.length&&t.attr("title",this.pseudoName)}},{key:"addCursor",value:function(e){this.cursor=!0,this._editor.viewEditor.getModule("cursors").setCursor(this.origin,e,this.pseudoName,this.colorRGB)}}],[{key:"capitalize",value:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}},{key:"getColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"rgb",n=(0,i.default)(e)%206,r=7*n%206,o=11*n%206,s=Math.floor(n+50)+", "+Math.floor(r+50)+", "+Math.floor(o+50);return"rgb"===t?"rgb("+s+")":"rgba"===t?"rgba("+s+")":s}},{key:"getPseudoname",value:function(e){return"Anonymous"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Anonymous")?"Anonymous "+this.capitalize(o.default.words[(0,i.default)(e)%o.default.words.length]):o.default.words[(0,i.default)(e)%o.default.words.length]}},{key:"getAvatar",value:function(e){return'<div id="'+e+'"style="background-color:'+this.getColor(e,"rgb")+';"><img class="imageuser" src="./icons/'+this.getPseudoname(e,null)+'.png" alt="'+this.getPseudoname(e)+'"></div>'}}]),e}();t.default=a},function(e,t,n){"use strict";(function(r){var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(88)).log=function(){return"object"===("undefined"==typeof console?"undefined":o(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++o)}),e.splice(i,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,n(4))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(21),i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=t.shift(),this.e=null,0===t.length&&(this.e=n),this.subCounter=t.length>0?1:0,this.children=[],t.length>0&&this.children.push(new e(t,n))}return r(e,[{key:"compareTo",value:function(e){return this.t.compareTo(e.t)}},{key:"add",value:function(e){var t=this._binaryIndexOf(e);if(this._contains(e))if(0===e.children.length){if(null!==this.children[t].e)return!1;this.children[t].e=e.e,this.subCounter+=1}else this.children[t].add(e.child)&&(this.subCounter+=1);else this.children.splice(-t,0,e),this.subCounter+=1;return!0}},{key:"del",value:function(e){var t=this._getIndexes(e),n=this,r=0,o=!1;if(0===t.length)return!1;for(n.subCounter-=1;r<t.length&&!o;){var i=n.children[t[r]]._hasElement&&r===t.length-1;i||(n.children[t[r]].subCounter-=1),n.children[t[r]].subCounter<=0&&(!n.children[t[r]]._hasElement||i)&&(n.children.splice(t[r],1),o=!0),n=n.children[t[r]],++r}return o||(n.e=null),!0}},{key:"indexOf",value:function(e){var t=this._getIndexes(e),n=0,r=this,o=void 0;if(0===t.length)return-1;r._hasElement&&(n+=1);for(var i=0;i<t.length;++i){if(t[i]<r.children.length/2)for(o=0;o<t[i];)r.children[o]._hasElement&&(n+=1),n+=r.children[o].subCounter,++o;else{for(n+=r.subCounter,o=r.children.length-1;o>=t[i];)r.children[o]._hasElement&&(n-=1),n-=r.children[o].subCounter,--o;o+=1}r.children[o]._hasElement&&(n+=1),r=r.children[o]}return n-1}},{key:"get",value:function(t){return function n(r,o,i,s){var a,c=void 0,u=0,l=void 0,f=void 0;if(r===t&&s._hasElement)return i.e=s.e,o;for(s._hasElement&&(r+=1),(a=t-r<s.subCounter/2)?c=function(e,t){return e+t}:(r+=s.subCounter,c=function(e,t){return e-t}),a||(u=s.children.length-1);a&&r<=t||!a&&r>t;)s.children[u]._hasElement&&(r=c(r,1)),r=c(r,s.children[u].subCounter),u=c(u,1);return u=c(u,-1),a&&(s.children[u]._hasElement&&(r=c(r,-1)),r=c(r,-s.children[u].subCounter)),(l=[]).push(s.children[u].t),null===o?i=o=new e(l,null):(f=new e(l,null),i.add(f),i=f),n(r,o,i,s.children[u])}(0,null,null,this)}},{key:"_getIndexes",value:function(e){return function e(t,n,r){if(!n._contains(r))return[];var o=n._binaryIndexOf(r);return t.push(o),(0===r.children.length||0===n.children.length)&&t||e(t,n.children[o],r.child)}([],this,e)}},{key:"_binaryIndexOf",value:function(e){for(var t=0,n=this.children.length-1,r=void 0,o=void 0;t<=n;)if(r=Math.floor((t+n)/2),(o=this.children[r]).compareTo(e)<0)t=r+1;else{if(!(o.compareTo(e)>0))return r;n=r-1}return~n}},{key:"_contains",value:function(e){var t=this._binaryIndexOf(e);return this.children.length>0&&(t>0||0===t&&0===this.child.compareTo(e))}},{key:"child",get:function(){return this.children.length>0&&this.children[0]||null}},{key:"_hasElement",get:function(){return null!==this.e}},{key:"isLeaf",get:function(){return 0===this.children.length}}],[{key:"fromJSON",value:function(t){var n=void 0;return 0===t.children.length?n=new e([new o(t.t.p,t.t.s,t.t.c)],t.e):(n=new e([new o(t.t.p,t.t.s,t.t.c)])).children.push(e.fromJSON(t.children[0])),n}}]),e}();e.exports=i},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(34),i=n(21),s=n(32),a=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._d=n,this._s=r,this._c=o,this._base=t}return r(e,[{key:"fromNode",value:function(e){for(var t=1,n=e;!n.isLeaf;)++t,n=n.child;this._d=o.int2bigInt(0,this._base.getSumBit(t-1));for(var r=0;r<t;++r)this._s.push(e.t.s),this._c.push(e.t.c),o.addInt_(this._d,e.t.p),r!==t-1&&o.leftShift_(this._d,this._base.getBitBase(r+1)),e=e.child;return this}},{key:"toNode",value:function(e){for(var t=this._base.getSumBit(this._c.length-1),n=[],r=void 0,a=0;a<this._c.length;++a)r=o.dup(this._d),o.rightShift_(r,t-this._base.getSumBit(a)),n.push(new i(o.modInt(r,Math.pow(2,this._base.getBitBase(a))),this._s[a],this._c[a]));return new s(n,e)}},{key:"compareTo",value:function(e){for(var t=this._base.getSumBit(this._c.length-1),n=this._base.getSumBit(e._c.length-1),r=!0,i=0,s=0,a=void 0,c=void 0,u=void 0;r&&s<Math.min(this._c.length,e._c.length);)a=this._base.getSumBit(s),c=o.dup(this._d),o.rightShift_(c,t-a),u=o.dup(e._d),o.rightShift_(u,n-a),o.equals(c,u)?0!==(i=this._s[s]-e._s[s])?r=!1:0!==(i=this._c[s]-e._c[s])&&(r=!1):(i=o.greater(c,u)?1:-1,r=!1),++s;return 0===i&&(i=this._c.length-e._c.length),i}}]),e}();e.exports=a},function(e,t,n){"use strict";(function(e){var r,o,i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};i=function(e,t,n){var r=function(){return Math.random()};var o=0,i=0,s=i+1,a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_=!@#$%^&*()[]{}|;:,.<>/?`~ \\'\"+-";for(o=0;1<<o+1>1<<o;o++);s=(i=(1<<(o>>=1))-1)+1;var c=ae(1,1,1),u=new Array(0),l=u,f=u,h=u,p=u,d=u,y=u,g=u,v=u,m=u,b=u,_=u,C=u,k=u,E=u,S=u,O=u,x=u,A=u,T=u,j=u,P=u,R=u,M=u,I=u,F=u,N=u,D=u,B=u,L=u,U=u,q=u,z=u,V=u;function W(e){var t,n,r,o;for(n=new Array(e),t=0;t<e;t++)n[t]=0;for(n[0]=2,r=0;n[r]<e;){for(t=n[r]*n[r];t<e;t+=n[r])n[t]=1;for(n[++r]=n[r-1]+1;n[r]<e&&n[n[r]];n[r]++);}for(o=new Array(r),t=0;t<r;t++)o[t]=n[t];return o}function J(e,t){return b.length!=e.length&&(b=fe(e),_=fe(e),C=fe(e)),pe(C,t),H(e,C)}function H(e,t){var n,r,s,a;for(b.length!=e.length&&(b=fe(e),_=fe(e),C=fe(e)),he(C,t),he(_,e),he(b,e),de(_,-1),de(b,-1),s=0,n=0;n<_.length;n++)for(r=1;r<i;r<<=1)e[n]&r?(a=s<_.length+o?s:0,n=_.length,r=i):s++;if(a&&ye(_,a),Pe(C,_,e),!ce(C,1)&&!ue(C,b)){for(r=1;r<=a-1&&!ue(C,b);){if(Te(C,e),ce(C,1))return 0;r++}if(!ue(C,b))return 0}return 1}function $(e){var t,n,r;for(t=e.length-1;0==e[t]&&t>0;t--);for(n=0,r=e[t];r;r>>=1,n++);return n+=o*t}function Y(e,t){var n=ae(0,(e.length>t?e.length:t)*o,0);return he(n,e),n}function Q(e,t){var n,r,o;for(3e4,n=ae(0,e,0),0==T.length&&(T=W(3e4)),V.length!=n.length&&(V=fe(n));;){for(G(n,e,0),n[0]|=1,o=0,r=0;r<T.length&&T[r]<=3e4;r++)if(0==se(n,T[r])&&!ce(n,T[r])){o=1;break}for(r=0;r<t&&!o;r++){for(G(V,e,0);!re(n,V);)G(V,e,0);H(n,V)||(o=1)}if(!o)return n}}function X(e,t){var n,i,s,a,c,u,l,f,h;if(0==T.length&&(T=W(3e4)),0==j.length)for(j=new Array(512),s=0;s<512;s++)j[s]=Math.pow(2,s/511-1);if(R.length!=e.length&&(R=fe(e),M=fe(e),N=fe(e),B=fe(e),q=fe(e),fe(e),fe(e),U=fe(e),L=fe(e),P=fe(e),I=fe(e),F=fe(e),D=fe(e),z=fe(e)),t<=20){for(n=(1<<(t+2>>1))-1,pe(e,0),i=1;i;)for(i=0,e[0]=1|1<<t-1|Math.floor(r()*(1<<t)),s=1;s<T.length&&(T[s]&n)==T[s];s++)if(0==e[0]%T[s]){i=1;break}ie(e)}else{if(c=.1*t*t,t>40)for(a=1;t-t*a<=20;)a=j[Math.floor(512*r())];else a=.5;for(h=Math.floor(a*t)+1,X(F,h),pe(R,0),R[Math.floor((t-2)/o)]|=1<<(t-2)%o,oe(R,F,P,I),l=$(P);;){for(;G(M,l,0),!re(P,M););for(de(M,1),Se(M,P),he(L,F),Oe(L,M),me(L,2),de(L,1),he(B,M),me(B,2),u=0,s=0;s<T.length&&T[s]<c;s++)if(0==se(L,T[s])&&!ce(L,T[s])){u=1;break}if(u||J(L,2)||(u=1),!u){for(de(L,-3),s=L.length-1;0==L[s]&&s>0;s--);for(f=0,w=L[s];w;w>>=1,f++);for(f+=o*s;G(D,f,0),!re(L,D););if(de(L,3),de(D,2),he(U,D),he(N,L),de(N,-1),Pe(U,N,L),de(U,-1),le(U)&&(he(U,D),Pe(U,B,L),de(U,-1),he(z,L),he(q,U),Z(q,L),ce(q,1)))return void he(e,z)}}}}function G(e,t,n){var i,s;for(i=0;i<e.length;i++)e[i]=0;for(s=Math.floor((t-1)/o)+1,i=0;i<s;i++)e[i]=Math.floor(r()*(1<<o-1));e[s-1]&=(2<<(t-1)%o)-1,1==n&&(e[s-1]|=1<<(t-1)%o)}function Z(e,t){var n,r,o,i,s,a,c,l,f;for(v.length!=e.length&&(v=fe(e)),f=1;f;){for(f=0,n=1;n<t.length;n++)if(t[n]){f=1;break}if(!f)break;for(n=e.length;!e[n]&&n>=0;n--);for(r=e[n],o=t[n],i=1,s=0,a=0,c=1;o+a&&o+c;){if((l=Math.floor((r+i)/(o+a)))!=Math.floor((r+s)/(o+c)))break;u=i-l*a,i=a,a=u,u=s-l*c,s=c,c=u,u=r-l*o,r=o,o=u}s?(he(v,e),_e(e,t,i,s),_e(t,v,c,a)):(xe(e,t),he(v,e),he(e,t),he(t,v))}if(0!=t[0])for(u=se(e,t[0]),pe(e,t[0]),t[0]=u;t[0];)e[0]%=t[0],u=e[0],e[0]=t[0],t[0]=u}function K(e,t){var n=1+2*Math.max(e.length,t.length);if(!(1&e[0]||1&t[0]))return pe(e,0),0;for(E.length!=n&&(E=new Array(n),k=new Array(n),S=new Array(n),O=new Array(n),x=new Array(n),A=new Array(n)),he(E,e),he(k,t),pe(S,1),pe(O,0),pe(x,0),pe(A,1);;){for(;!(1&E[0]);)ge(E),1&S[0]||1&O[0]?(Se(S,t),ge(S),Ee(O,e),ge(O)):(ge(S),ge(O));for(;!(1&k[0]);)ge(k),1&x[0]||1&A[0]?(Se(x,t),ge(x),Ee(A,e),ge(A)):(ge(x),ge(A));if(re(k,E)?(Ee(k,E),Ee(x,S),Ee(A,O)):(Ee(E,k),Ee(S,x),Ee(O,A)),ce(E,0)){for(;te(x);)Se(x,t);return he(e,x),ce(k,1)?1:(pe(e,0),0)}}}function ee(e,t){for(var n=1,r=0;;){if(1==e)return n;if(0==e)return 0;if(r-=n*Math.floor(t/e),1==(t%=e))return r;if(0==t)return 0;n-=r*Math.floor(e/t),e%=t}}function te(e){return e[e.length-1]>>o-1&1}function ne(e,t,n){var r,o=e.length,i=t.length,s=o+n<i?o+n:i;for(r=i-1-n;r<o&&r>=0;r++)if(e[r]>0)return 1;for(r=o-1+n;r<i;r++)if(t[r]>0)return 0;for(r=s-1;r>=n;r--){if(e[r-n]>t[r])return 1;if(e[r-n]<t[r])return 0}return 0}function re(e,t){var n,r=e.length<t.length?e.length:t.length;for(n=e.length;n<t.length;n++)if(t[n])return 0;for(n=t.length;n<e.length;n++)if(e[n])return 1;for(n=r-1;n>=0;n--){if(e[n]>t[n])return 1;if(e[n]<t[n])return 0}return 0}function oe(e,t,n,r){var a,c,u,l,f,h,p,d;for(he(r,e),c=t.length;0==t[c-1];c--);for(d=t[c-1],p=0;d;p++)d>>=1;for(ve(t,p=o-p),ve(r,p),a=r.length;0==r[a-1]&&a>c;a--);for(pe(n,0);!ne(t,r,a-c);)ke(r,t,a-c),n[a-c]++;for(u=a-1;u>=c;u--){for(r[u]==t[c-1]?n[u-c]=i:n[u-c]=Math.floor((r[u]*s+r[u-1])/t[c-1]);h=(f=(c>1?t[c-2]:0)*n[u-c])>>o,f&=i,h=(l=h+n[u-c]*t[c-1])>>o,l&=i,h==r[u]?l==r[u-1]?f>(u>1?r[u-2]:0):l>r[u-1]:h>r[u];)n[u-c]--;we(r,t,-n[u-c],u-c),te(r)&&(Ce(r,t,u-c),n[u-c]--)}ye(t,p),ye(r,p)}function ie(e){var t,n,r,a;for(n=e.length,r=0,t=0;t<n;t++)a=0,(r+=e[t])<0&&(r+=(a=-(r>>o))*s),e[t]=r&i,r=(r>>o)-a}function se(e,t){var n,r=0;for(n=e.length-1;n>=0;n--)r=(r*s+e[n])%t;return r}function ae(e,t,n){var r;r=n>(r=Math.ceil(t/o)+1)?n:r;var i=new Array(r);return pe(i,e),i}function ce(e,t){var n;if(e[0]!=t)return 0;for(n=1;n<e.length;n++)if(e[n])return 0;return 1}function ue(e,t){var n,r=e.length<t.length?e.length:t.length;for(n=0;n<r;n++)if(e[n]!=t[n])return 0;if(e.length>t.length){for(;n<e.length;n++)if(e[n])return 0}else for(;n<t.length;n++)if(t[n])return 0;return 1}function le(e){var t;for(t=0;t<e.length;t++)if(e[t])return 0;return 1}function fe(e){var t=new Array(e.length);return he(t,e),t}function he(e,t){var n,r=e.length<t.length?e.length:t.length;for(n=0;n<r;n++)e[n]=t[n];for(n=r;n<e.length;n++)e[n]=0}function pe(e,t){var n,r;for(r=t,n=0;n<e.length;n++)e[n]=r&i,r>>=o}function de(e,t){var n,r,a,c;for(e[0]+=t,r=e.length,a=0,n=0;n<r;n++)if(c=0,(a+=e[n])<0&&(a+=(c=-(a>>o))*s),e[n]=a&i,!(a=(a>>o)-c))return}function ye(e,t){var n,r=Math.floor(t/o);if(r){for(n=0;n<e.length-r;n++)e[n]=e[n+r];for(;n<e.length;n++)e[n]=0;t%=o}for(n=0;n<e.length-1;n++)e[n]=i&(e[n+1]<<o-t|e[n]>>t);e[n]>>=t}function ge(e){var t;for(t=0;t<e.length-1;t++)e[t]=i&(e[t+1]<<o-1|e[t]>>1);e[t]=e[t]>>1|e[t]&s>>1}function ve(e,t){var n,r=Math.floor(t/o);if(r){for(n=e.length;n>=r;n--)e[n]=e[n-r];for(;n>=0;n--)e[n]=0;t%=o}if(t){for(n=e.length-1;n>0;n--)e[n]=i&(e[n]<<t|e[n-1]>>o-t);e[n]=i&e[n]<<t}}function me(e,t){var n,r,a,c;if(t)for(r=e.length,a=0,n=0;n<r;n++)c=0,(a+=e[n]*t)<0&&(a+=(c=-(a>>o))*s),e[n]=a&i,a=(a>>o)-c}function be(e,t){var n,r,o=0;for(n=e.length-1;n>=0;n--)r=o*s+e[n],e[n]=Math.floor(r/t),o=r%t;return o}function _e(e,t,n,r){var s,a,c,u;for(c=e.length<t.length?e.length:t.length,u=e.length,a=0,s=0;s<c;s++)a+=n*e[s]+r*t[s],e[s]=a&i,a>>=o;for(s=c;s<u;s++)a+=n*e[s],e[s]=a&i,a>>=o}function we(e,t,n,r){var s,a,c,u;for(c=e.length<r+t.length?e.length:r+t.length,u=e.length,a=0,s=r;s<c;s++)a+=e[s]+n*t[s-r],e[s]=a&i,a>>=o;for(s=c;a&&s<u;s++)a+=e[s],e[s]=a&i,a>>=o}function Ce(e,t,n){var r,s,a,c;for(a=e.length<n+t.length?e.length:n+t.length,c=e.length,s=0,r=n;r<a;r++)s+=e[r]+t[r-n],e[r]=s&i,s>>=o;for(r=a;s&&r<c;r++)s+=e[r],e[r]=s&i,s>>=o}function ke(e,t,n){var r,s,a,c;for(a=e.length<n+t.length?e.length:n+t.length,c=e.length,s=0,r=n;r<a;r++)s+=e[r]-t[r-n],e[r]=s&i,s>>=o;for(r=a;s&&r<c;r++)s+=e[r],e[r]=s&i,s>>=o}function Ee(e,t){var n,r,s;for(s=e.length<t.length?e.length:t.length,r=0,n=0;n<s;n++)r+=e[n]-t[n],e[n]=r&i,r>>=o;for(n=s;r&&n<e.length;n++)r+=e[n],e[n]=r&i,r>>=o}function Se(e,t){var n,r,s;for(s=e.length<t.length?e.length:t.length,r=0,n=0;n<s;n++)r+=e[n]+t[n],e[n]=r&i,r>>=o;for(n=s;r&&n<e.length;n++)r+=e[n],e[n]=r&i,r>>=o}function Oe(e,t){var n;for(l.length!=2*e.length&&(l=new Array(2*e.length)),pe(l,0),n=0;n<t.length;n++)t[n]&&we(l,e,t[n],n);he(e,l)}function xe(e,t){p.length!=e.length?p=fe(e):he(p,e),d.length!=e.length&&(d=fe(e)),oe(p,t,d,e)}function Ae(e,t,n){var r;for(f.length!=2*e.length&&(f=new Array(2*e.length)),pe(f,0),r=0;r<t.length;r++)t[r]&&we(f,e,t[r],r);xe(f,n),he(e,f)}function Te(e,t){var n,r,s,a,c;for(a=e.length;a>0&&!e[a-1];a--);for(c=a>t.length?2*a:2*t.length,f.length!=c&&(f=new Array(c)),pe(f,0),n=0;n<a;n++){for(s=f[2*n]+e[n]*e[n],f[2*n]=s&i,s>>=o,r=n+1;r<a;r++)s=f[n+r]+2*e[n]*e[r]+s,f[n+r]=s&i,s>>=o;f[n+a]=s}xe(f,t),he(e,f)}function je(e,t){var n,r;for(n=e.length;n>0&&!e[n-1];n--);return he(r=new Array(n+t),e),r}function Pe(e,t,n){var r,i,a,u;if(g.length!=n.length&&(g=fe(n)),0!=(1&n[0])){for(pe(g,0),a=n.length;a>0&&!n[a-1];a--);for(u=s-ee(se(n,s),s),g[a]=1,Ae(e,g,n),h.length!=e.length?h=fe(e):he(h,e),r=t.length-1;r>0&!t[r];r--);if(0!=t[r]){for(i=1<<o-1;i&&!(t[r]&i);i>>=1);for(;;){if(!(i>>=1)){if(--r<0)return void Re(e,c,n,u);i=1<<o-1}Re(e,e,n,u),i&t[r]&&Re(e,h,n,u)}}else pe(e,1)}else for(he(g,e),pe(e,1);!ce(t,0);)1&t[0]&&Ae(e,g,n),be(t,2),Te(g,n)}function Re(e,t,n,r){var s,a,c,u,l,f,h=n.length,p=t.length;for(m.length!=h&&(m=new Array(h)),pe(m,0);h>0&&0==n[h-1];h--);for(;p>0&&0==t[p-1];p--);for(f=m.length-1,s=0;s<h;s++){for(c=(l=m[0]+e[s]*t[0])+(u=(l&i)*r&i)*n[0]>>o,l=e[s],a=1;a<p-4;)c+=m[a]+u*n[a]+l*t[a],m[a-1]=c&i,c>>=o,c+=m[++a]+u*n[a]+l*t[a],m[a-1]=c&i,c>>=o,c+=m[++a]+u*n[a]+l*t[a],m[a-1]=c&i,c>>=o,c+=m[++a]+u*n[a]+l*t[a],m[a-1]=c&i,c>>=o,c+=m[++a]+u*n[a]+l*t[a],m[a-1]=c&i,c>>=o,a++;for(;a<p;)c+=m[a]+u*n[a]+l*t[a],m[a-1]=c&i,c>>=o,a++;for(;a<h-4;)c+=m[a]+u*n[a],m[a-1]=c&i,c>>=o,c+=m[++a]+u*n[a],m[a-1]=c&i,c>>=o,c+=m[++a]+u*n[a],m[a-1]=c&i,c>>=o,c+=m[++a]+u*n[a],m[a-1]=c&i,c>>=o,c+=m[++a]+u*n[a],m[a-1]=c&i,c>>=o,a++;for(;a<h;)c+=m[a]+u*n[a],m[a-1]=c&i,c>>=o,a++;for(;a<f;)c+=m[a],m[a-1]=c&i,c>>=o,a++;m[a-1]=c&i}re(n,m)||Ee(m,n),he(e,m)}n.exports={add:function(e,t){var n=Y(e,e.length>t.length?e.length+1:t.length+1);return Se(n,t),je(n,1)},addInt:function(e,t){var n=Y(e,e.length+1);return de(n,t),je(n,1)},bigInt2str:function(e,t){var n,r,o,i,s="";if("string"==typeof t?(o=t.length,i=t):(o=t,i=a),y.length!=e.length?y=fe(e):he(y,e),-1==o){for(n=e.length-1;n>0;n--)s+=e[n]+",";s+=e[0]}else for(;!le(y);)r=be(y,o),s=i.substring(r,r+1)+s;return 0==s.length&&(s=i[0]),s},bitSize:$,dup:fe,equals:ue,equalsInt:ce,expand:Y,findPrimes:W,GCD:function(e,t){var n;return Z(n=fe(e),fe(t)),n},greater:re,greaterShift:ne,int2bigInt:ae,inverseMod:function(e,t){var n=Y(e,t.length);return K(n,t)?je(n,1):null},inverseModInt:ee,isZero:le,millerRabin:H,millerRabinInt:J,mod:function(e,t){var n=fe(e);return xe(n,t),je(n,1)},modInt:se,mult:function(e,t){var n=Y(e,e.length+t.length);return Oe(n,t),je(n,1)},multMod:function(e,t,n){var r=Y(e,n.length);return Ae(r,t,n),je(r,1)},negative:te,powMod:function(e,t,n){var r=Y(e,n.length);return Pe(r,je(t,2),je(n,2)),je(r,1)},randBigInt:function(e,t){var n;return G(n=ae(0,0,Math.floor((e-1)/o)+2),e,t),n},randTruePrime:function(e){var t=ae(0,e,0);return X(t,e),je(t,1)},randProbPrime:function(e){return Q(e,e>=600?2:e>=550?4:e>=500?5:e>=400?6:e>=350?7:e>=300?9:e>=250?12:e>=200?15:e>=150?18:e>=100?27:40)},str2bigInt:function(e,t,n){var r,o,i,s,c,u,l;"string"==typeof t?(i=t.length,s=t):(i=t,s=a);var f=e.length;if(-1==i){for(c=new Array(0);;){for(u=new Array(c.length+1),o=0;o<c.length;o++)u[o+1]=c[o];if(u[0]=parseInt(e,10),c=u,(r=e.indexOf(",",0))<1)break;if(0==(e=e.substring(r+1)).length)break}return c.length<n?(he(u=new Array(n),c),u):c}for(c=ae(0,i*f,0),o=0;o<f;o++)r=s.indexOf(e.substring(o,o+1),0),i<=36&&r>=36&&(r-=26),r>=i||r<0||(me(c,i),de(c,r));for(f=c.length;f>0&&!c[f-1];f--);for(f=n>f+1?n:f+1,u=new Array(f),l=f<c.length?f:c.length,o=0;o<l;o++)u[o]=c[o];for(;o<f;o++)u[o]=0;return u},sub:function(e,t){var n=Y(e,e.length>t.length?e.length+1:t.length+1);return Ee(n,t),je(n,1)},trim:je,addInt_:de,add_:Se,copy_:he,copyInt_:pe,GCD_:Z,inverseMod_:K,mod_:xe,mult_:Oe,multMod_:Ae,powMod_:Pe,randBigInt_:G,randTruePrime_:X,sub_:Ee,addShift_:Ce,carry_:ie,divide_:oe,divInt_:be,eGCD_:function(e,t,n,r,o){var i=0,s=Math.max(e.length,t.length);for(E.length!=s&&(E=new Array(s),S=new Array(s),O=new Array(s),x=new Array(s),A=new Array(s));!(1&e[0]||1&t[0]);)ge(e),ge(t),i++;for(he(E,e),he(n,t),pe(S,1),pe(O,0),pe(x,0),pe(A,1);;){for(;!(1&E[0]);)ge(E),1&S[0]||1&O[0]?(Se(S,t),ge(S),Ee(O,e),ge(O)):(ge(S),ge(O));for(;!(1&n[0]);)ge(n),1&x[0]||1&A[0]?(Se(x,t),ge(x),Ee(A,e),ge(A)):(ge(x),ge(A));if(re(n,E)?(Ee(n,E),Ee(x,S),Ee(A,O)):(Ee(E,n),Ee(S,x),Ee(O,A)),ce(E,0)){for(;te(x);)Se(x,t),Ee(A,e);return me(A,-1),he(r,x),he(o,A),void ve(n,i)}}},halve_:ge,leftShift_:ve,linComb_:_e,linCombShift_:we,mont_:Re,multInt_:me,rightShift_:ye,squareMod_:Te,subShift_:ke}},"object"===s(t)?i(n(91),0,e):void 0===(o="function"==typeof(r=i)?r.call(t,n,t,e):r)||(e.exports=o)}).call(this,n(15)(e))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(36);function i(e){return function(t){var n=void 0;return e.reduce(function(e,t){return void 0===(n=t(e))||null===n?e:n},t)}}var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._serviceName=t,this._camelCasedName=o.camelCase(this._serviceName),this._capitalizedCamelCase=o.capitalize(this._camelCasedName)}return r(e,[{key:"buildService",value:function(e){throw new Error("A valid Builder must implement a valid buildService method")}},{key:"buildHandler",value:function(e,t){e.prototype[this.handlerName]=t}},{key:"buildBeforeHooks",value:function(e,t){t.send.length>0&&(e.prototype[this.beforeSendName]=i(t.send)),t.receive.length>0&&(e.prototype[this.beforeReceiveName]=i(t.receive))}},{key:"buildAfterHooks",value:function(e,t){t.send.length>0&&(e.prototype[this.afterSendName]=i(t.send)),t.receive.length>0&&(e.prototype[this.afterReceiveName]=i(t.receive))}},{key:"methodName",get:function(){return this._camelCasedName}},{key:"handlerName",get:function(){return"_"+this._camelCasedName}},{key:"beforeSendName",get:function(){return"_beforeSend"+this._capitalizedCamelCase}},{key:"beforeReceiveName",get:function(){return"_beforeReceive"+this._capitalizedCamelCase}},{key:"afterSendName",get:function(){return"_afterSend"+this._capitalizedCamelCase}},{key:"afterReceiveName",get:function(){return"_afterReceive"+this._capitalizedCamelCase}}]),e}();e.exports=s},function(e,t,n){"use strict";var r=function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0===t?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")},o=function(e){return e[0].toUpperCase()+e.slice(1)};e.exports={camelCase:r,capitalize:o,methodName:function(e){return r(e)},handlerName:function(e){return"_"+r(e)},beforeSendName:function(e){return"_beforeSend"+o(r(e))},beforeReceiveName:function(e){return"_beforeReceive"+o(r(e))},afterSendName:function(e){return"_afterSend"+o(r(e))},afterReceiveName:function(e){return"_afterReceive"+o(r(e))}}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(12),i=n(129),s=n(1),a=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,s({webrtc:{trickle:!0,iceServers:[]},origins:"*"},e)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"_buildRPS",value:function(e){var t=s({config:e.webrtc},e);return new i(t)}},{key:"getNeighbours",value:function(e){return this._rps.getPeers(e)}},{key:"inviewId",get:function(){return this._rps.getInviewId()}},{key:"outviewId",get:function(){return this._rps.getOutviewId()}}]),t}();e.exports=a},function(e,t,n){"use strict";(function(r){var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(156)).log=function(){return"object"===("undefined"==typeof console?"undefined":o(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++o)}),e.splice(i,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,n(4))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(12),i=n(162),s=n(1),a=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,s({webrtc:{trickle:!0,iceServers:[]},origins:"*"},e)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"_buildRPS",value:function(e){var t=s({config:e.webrtc},e);return new i(t)}},{key:"getNeighbours",value:function(e){return this._rps.getPeers(e)}},{key:"inviewId",get:function(){return this._rps.getInviewId()}},{key:"outviewId",get:function(){return this._rps.getOutviewId()}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return t.apply(e,n.concat(r.call(arguments)))}}},function(e,t,n){"use strict";e.exports=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(25),i=n(8),s=n(164),a=n(41),c=n(40),u=n(3)("socket.io-client:socket"),l=n(17),f=n(46);e.exports=d;var h={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},p=i.prototype.emit;function d(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}i(d.prototype),d.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[a(e,"open",c(this,"onopen")),a(e,"packet",c(this,"onpacket")),a(e,"close",c(this,"onclose"))]}},d.prototype.open=d.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},d.prototype.send=function(){var e=s(arguments);return e.unshift("message"),this.emit.apply(this,e),this},d.prototype.emit=function(e){if(h.hasOwnProperty(e))return p.apply(this,arguments),this;var t=s(arguments),n={type:(void 0!==this.flags.binary?this.flags.binary:f(t))?o.BINARY_EVENT:o.EVENT,data:t,options:{}};return n.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(u("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),this.flags={},this},d.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},d.prototype.onopen=function(){if(u("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"===r(this.query)?l.encode(this.query):this.query;u("sending connect packet with query %s",e),this.packet({type:o.CONNECT,query:e})}else this.packet({type:o.CONNECT})},d.prototype.onclose=function(e){u("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},d.prototype.onpacket=function(e){var t=e.nsp===this.nsp,n=e.type===o.ERROR&&"/"===e.nsp;if(t||n)switch(e.type){case o.CONNECT:this.onconnect();break;case o.EVENT:case o.BINARY_EVENT:this.onevent(e);break;case o.ACK:case o.BINARY_ACK:this.onack(e);break;case o.DISCONNECT:this.ondisconnect();break;case o.ERROR:this.emit("error",e.data)}},d.prototype.onevent=function(e){var t=e.data||[];u("emitting event %j",t),null!=e.id&&(u("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?p.apply(this,t):this.receiveBuffer.push(t)},d.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var r=s(arguments);u("sending ack %j",r),t.packet({type:f(r)?o.BINARY_ACK:o.ACK,id:e,data:r})}}},d.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(u("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):u("bad ack %s",e.id)},d.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},d.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)p.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},d.prototype.ondisconnect=function(){u("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},d.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},d.prototype.close=d.prototype.disconnect=function(){return this.connected&&(u("performing disconnect (%s)",this.nsp),this.packet({type:o.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},d.prototype.compress=function(e){return this.flags.compress=e,this},d.prototype.binary=function(e){return this.flags.binary=e,this}},function(e,t,n){"use strict";var r=[].indexOf;e.exports=function(e,t){if(r)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},function(e,t,n){"use strict";var r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i=64,s={},a=0,c=0;function u(e){var t="";do{t=o[e%i]+t,e=Math.floor(e/i)}while(e>0);return t}function l(){var e=u(+new Date);return e!==r?(a=0,r=e):e+"."+u(a++)}for(;c<i;c++)s[o[c]]=c;l.encode=u,l.decode=function(e){var t=0;for(c=0;c<e.length;c++)t=t*i+s[e.charAt(c)];return t},e.exports=l},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t,n){"use strict";(function(t){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(173),i=Object.prototype.toString,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===i.call(Blob),a="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===i.call(File);e.exports=function e(n){if(!n||"object"!==(void 0===n?"undefined":r(n)))return!1;if(o(n)){for(var i=0,c=n.length;i<c;i++)if(e(n[i]))return!0;return!1}if("function"==typeof t&&t.isBuffer&&t.isBuffer(n)||"function"==typeof ArrayBuffer&&n instanceof ArrayBuffer||s&&n instanceof Blob||a&&n instanceof File)return!0;if(n.toJSON&&"function"==typeof n.toJSON&&1===arguments.length)return e(n.toJSON(),!0);for(var u in n)if(Object.prototype.hasOwnProperty.call(n,u)&&e(n[u]))return!0;return!1}}).call(this,n(18).Buffer)},function(e,t,n){"use strict";var r=n(23),o=n(17),i=n(7),s=n(16),a=n(44),c=n(3)("engine.io-client:polling");e.exports=l;var u=null!=new(n(24))({xdomain:!1}).responseType;function l(e){var t=e&&e.forceBase64;u&&!t||(this.supportsBinary=!1),r.call(this,e)}s(l,r),l.prototype.name="polling",l.prototype.doOpen=function(){this.poll()},l.prototype.pause=function(e){var t=this;function n(){c("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(c("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){c("pre-pause polling complete"),--r||n()})),this.writable||(c("we are currently writing - waiting to pause"),r++,this.once("drain",function(){c("pre-pause writing complete"),--r||n()}))}else n()},l.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},l.prototype.onData=function(e){var t=this;c("polling got data %s",e);i.decodePayload(e,this.socket.binaryType,function(e,n,r){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},l.prototype.doClose=function(){var e=this;function t(){c("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(c("transport open - closing"),t()):(c("transport not open - deferring close"),this.once("open",t))},l.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};i.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},l.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=a()),this.supportsBinary||e.sid||(e.b64=1),e=o.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e}},function(e,t,n){"use strict";(function(e){var r=n(24),o=n(175),i=n(167),s=n(166);t.polling=function(t){var n=!1,s=!1,a=!1!==t.jsonp;if(e.location){var c="https:"===location.protocol,u=location.port;u||(u=c?443:80),n=t.hostname!==location.hostname||u!==t.port,s=t.secure!==c}if(t.xdomain=n,t.xscheme=s,"open"in new r(t)&&!t.forceJSONP)return new o(t);if(!a)throw new Error("JSONP disabled");return new i(t)},t.websocket=s}).call(this,n(0))},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(178),i=n(42),s=n(8),a=n(25),c=n(41),u=n(40),l=n(3)("socket.io-client:manager"),f=n(43),h=n(163),p=Object.prototype.hasOwnProperty;function d(e,t){if(!(this instanceof d))return new d(e,t);e&&"object"===(void 0===e?"undefined":r(e))&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new h({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||a;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}e.exports=d,d.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)p.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},d.prototype.updateSocketIds=function(){for(var e in this.nsps)p.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},d.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},s(d.prototype),d.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},d.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},d.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},d.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},d.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},d.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},d.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},d.prototype.open=d.prototype.connect=function(e,t){if(l("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;l("opening %s",this.uri),this.engine=o(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var i=c(n,"open",function(){r.onopen(),e&&e()}),s=c(n,"error",function(t){if(l("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else r.maybeReconnectOnOpen()});if(!1!==this._timeout){var a=this._timeout;l("connect attempt will timeout after %d",a);var u=setTimeout(function(){l("connect attempt timed out after %d",a),i.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(u)}})}return this.subs.push(i),this.subs.push(s),this},d.prototype.onopen=function(){l("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(c(e,"data",u(this,"ondata"))),this.subs.push(c(e,"ping",u(this,"onping"))),this.subs.push(c(e,"pong",u(this,"onpong"))),this.subs.push(c(e,"error",u(this,"onerror"))),this.subs.push(c(e,"close",u(this,"onclose"))),this.subs.push(c(this.decoder,"decoded",u(this,"ondecoded")))},d.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},d.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},d.prototype.ondata=function(e){this.decoder.add(e)},d.prototype.ondecoded=function(e){this.emit("packet",e)},d.prototype.onerror=function(e){l("error",e),this.emitAll("error",e)},d.prototype.socket=function(e,t){var n=this.nsps[e];if(!n){n=new i(this,e,t),this.nsps[e]=n;var r=this;n.on("connecting",o),n.on("connect",function(){n.id=r.generateId(e)}),this.autoConnect&&o()}function o(){~f(r.connecting,n)||r.connecting.push(n)}return n},d.prototype.destroy=function(e){var t=f(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},d.prototype.packet=function(e){l("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(n){for(var r=0;r<n.length;r++)t.engine.write(n[r],e.options);t.encoding=!1,t.processPacketQueue()}))},d.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},d.prototype.cleanup=function(){l("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},d.prototype.close=d.prototype.disconnect=function(){l("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},d.prototype.onclose=function(e){l("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},d.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)l("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();l("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout(function(){e.skipReconnect||(l("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(l("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(l("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(n)}})}},d.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,n){"use strict";(function(t){e.exports=function(e){return n&&t.Buffer.isBuffer(e)||r&&(e instanceof t.ArrayBuffer||o(e))};var n="function"==typeof t.Buffer&&"function"==typeof t.Buffer.isBuffer,r="function"==typeof t.ArrayBuffer,o=r&&"function"==typeof t.ArrayBuffer.isView?t.ArrayBuffer.isView:function(e){return e.buffer instanceof t.ArrayBuffer}}).call(this,n(0))},function(e,t,n){"use strict";var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,n){"use strict";var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,n=e.indexOf("["),i=e.indexOf("]");-1!=n&&-1!=i&&(e=e.substring(0,n)+e.substring(n,i).replace(/:/g,";")+e.substring(i,e.length));for(var s=r.exec(e||""),a={},c=14;c--;)a[o[c]]=s[c]||"";return-1!=n&&-1!=i&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(180),i=n(25),s=n(49),a=n(3)("socket.io-client");e.exports=t=u;var c=t.managers={};function u(e,t){"object"===(void 0===e?"undefined":r(e))&&(t=e,e=void 0),t=t||{};var n,i=o(e),u=i.source,l=i.id,f=i.path,h=c[l]&&f in c[l].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||h?(a("ignoring socket cache for %s",u),n=s(u,t)):(c[l]||(a("new io instance for %s",u),c[l]=s(u,t)),n=c[l]),i.query&&!t.query&&(t.query=i.query),n.socket(i.path,t)}t.protocol=i.protocol,t.connect=u,t.Manager=n(49),t.Socket=n(42)},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(2),i=n(53),s=n(3)("foglet-core:signaling"),a=n(1),c=n(5),u=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(!(e&&n&&n.address&&n.room))throw s(n),new SyntaxError("Not enough parameters, need a source an address and a room.");return r.options=a({address:"http://localhost:3000/",origins:"*",room:c(),timeout:2e4,io:i,reconnectionAttempts:10},n),s("Signaling options: ",r.options),r._network=e,r._id=r._network.id,r._source=e.rps,r._socket=r.options.io(r.options.address,{autoConnect:!1,origins:r.options.origins,reconnectionAttempts:r.options.reconnectionAttempts,timeout:r.options.timeout}),r._socket.on("connect_timeout",function(e){r.unsignaling(),r._manageTimeout(e)}),r._socket.on("connect_error",function(e){r.unsignaling(),r._manageConnectionError(e)}),r._socket.on("error",function(e){r.unsignaling(),r._manageError(e)}),r._socket.on("disconnect",function(e){r._manageDisconnection(e)}),r._socket.on("new_spray",function(e){s("Receive a new offer: ",e),r._source.connect(function(e){s("Emit the accepted offer: ",e),r._socket.emit("accept",{id:r._id,offer:e,room:r.options.room})},e)}),r._socket.on("accept_spray",function(e){s("Receive an accepted offer: ",e),r._source.connect(e)}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"connection",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.timeout;return null===t&&null===this._socket?Promise.reject(new Error("There is no available connection to the server. Try to use the function signaling() before.")):new Promise(function(r,o){var i=setTimeout(function(){o(new Error("connection timed out."))},n),a=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];clearTimeout(i),r({connected:!0,alone:e})},c=function(e){"connected"===e?a():(clearTimeout(i),o(e))};try{t?e._source.join(e.direct(e._network.rps,t.rps)).then(function(){a()}).catch(c):(s("Connecting to the room "+e.options.room+"..."),e._socket.emit("joinRoom",{id:e._id,room:e.options.room}),e._socket.on("joinedRoom",function(t){t.connected?a(!0):(e._source.join(e._signalingInit()).then(function(){e._socket.emit("connected",{id:e._id,room:e.options.room})}).catch(c),e._socket.once("connected",function(){s("Peer connected."),a()})),s("Connected to the room: "+e.options.room)}))}catch(e){o(e)}})}},{key:"signaling",value:function(){s("Connection to the signaling server..."),this._socket.open()}},{key:"unsignaling",value:function(){s("Disconnection from the signaling server..."),this._socket.emit("disconnect"),this._socket.removeAllListeners("connected"),this._socket.removeAllListeners("joinedRoom"),this._socket.close()}},{key:"direct",value:function(e,t){return function(n){t.connect(function(t){e.connect(t)},n)}}},{key:"_signalingInit",value:function(){var e=this;console.log(this._id);var t=this;return function(n){s("Emit a new offer."),e._socket.emit("new",{id:t._id,tid:c(),offer:n,room:e.options.room})}}},{key:"_manageTimeout",value:function(e){s(e)}},{key:"_manageError",value:function(e){s(e)}},{key:"_manageDisconnection",value:function(e){s(e)}},{key:"_manageConnectionError",value:function(e){s(e)}}]),t}();e.exports=u},function(e,t,n){"use strict";e.exports=i;var r=n(9),o=n(13);function i(e){if(!(this instanceof i))return new i(e);r.call(this,e),this._transformState={afterTransform:function(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var o=this._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&this._read(o.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",s)}function s(){var e=this;"function"==typeof this._flush?this._flush(function(t,n){a(e,t,n)}):a(this,null,null)}function a(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}o.inherits=n(10),o.inherits(i,r),i.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},i.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},i.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var o=this._readableState;(r.needTransform||o.needReadable||o.length<o.highWaterMark)&&this._read(o.highWaterMark)}},i.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},i.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,function(e){t(e),n.emit("close")})}},function(e,t,n){"use strict";var r=n(14).Buffer,o=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function i(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===o||!o(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=u,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=l,this.end=f,t=3;break;default:return this.write=h,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function l(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function f(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function h(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}t.StringDecoder=i,i.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},i.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},i.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var o=s(t[r]);if(o>=0)return o>0&&(e.lastNeed=o-1),o;if(--r<n||-2===o)return 0;if((o=s(t[r]))>=0)return o>0&&(e.lastNeed=o-2),o;if(--r<n||-2===o)return 0;if((o=s(t[r]))>=0)return o>0&&(2===o?o=0:e.lastNeed=o-3),o;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},i.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";(function(t,r,o){var i=n(19);function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;e.entry=null;for(;r;){var o=r.callback;t.pendingcb--,o(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=m;var a,c=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:i.nextTick;m.WritableState=v;var u=n(13);u.inherits=n(10);var l={deprecate:n(185)},f=n(59),h=n(14).Buffer,p=o.Uint8Array||function(){};var d,y=n(58);function g(){}function v(e,t){a=a||n(9),e=e||{};var r=t instanceof a;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var o=e.highWaterMark,u=e.writableHighWaterMark,l=this.objectMode?16:16384;this.highWaterMark=o||0===o?o:r&&(u||0===u)?u:l,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var f=!1===e.decodeStrings;this.decodeStrings=!f,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,o=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,o){--t.pendingcb,n?(i.nextTick(o,r),i.nextTick(E,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(o(r),e._writableState.errorEmitted=!0,e.emit("error",r),E(e,t))}(e,n,r,t,o);else{var s=C(n);s||n.corked||n.bufferProcessing||!n.bufferedRequest||w(e,n),r?c(_,e,n,s,o):_(e,n,s,o)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function m(e){if(a=a||n(9),!(d.call(m,this)||this instanceof a))return new m(e);this._writableState=new v(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),f.call(this)}function b(e,t,n,r,o,i,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(o,t.onwrite):e._write(o,i,t.onwrite),t.sync=!1}function _(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),E(e,t)}function w(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,o=new Array(r),i=t.corkedRequestsFree;i.entry=n;for(var a=0,c=!0;n;)o[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;o.allBuffers=c,b(e,t,!0,t.length,o,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;n;){var u=n.chunk,l=n.encoding,f=n.callback;if(b(e,t,!1,t.objectMode?1:u.length,u,l,f),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function C(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function k(e,t){e._final(function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),E(e,t)})}function E(e,t){var n=C(t);return n&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,i.nextTick(k,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}u.inherits(m,f),v.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(v.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(d=Function.prototype[Symbol.hasInstance],Object.defineProperty(m,Symbol.hasInstance,{value:function(e){return!!d.call(this,e)||this===m&&(e&&e._writableState instanceof v)}})):d=function(e){return e instanceof this},m.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},m.prototype.write=function(e,t,n){var r,o=this._writableState,s=!1,a=!o.objectMode&&(r=e,h.isBuffer(r)||r instanceof p);return a&&!h.isBuffer(e)&&(e=function(e){return h.from(e)}(e)),"function"==typeof t&&(n=t,t=null),a?t="buffer":t||(t=o.defaultEncoding),"function"!=typeof n&&(n=g),o.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),i.nextTick(t,n)}(this,n):(a||function(e,t,n,r){var o=!0,s=!1;return null===n?s=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),i.nextTick(r,s),o=!1),o}(this,o,e,n))&&(o.pendingcb++,s=function(e,t,n,r,o,i){if(!n){var s=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=h.from(t,n));return t}(t,r,o);r!==s&&(n=!0,o="buffer",r=s)}var a=t.objectMode?1:r.length;t.length+=a;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:o,isBuf:n,callback:i,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else b(e,t,!1,a,r,o,i);return c}(this,o,a,e,t,n)),s},m.prototype.cork=function(){this._writableState.corked++},m.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||w(this,e))},m.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(m.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),m.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},m.prototype._writev=null,m.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&void 0!==e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,E(e,t),n&&(t.finished?i.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,r,n)},Object.defineProperty(m.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),m.prototype.destroy=y.destroy,m.prototype._undestroy=y.undestroy,m.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,n(4),n(187).setImmediate,n(0))},function(e,t,n){"use strict";var r=n(19);function o(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,i=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return i||s?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(o,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(r.nextTick(o,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){"use strict";e.exports=n(2).EventEmitter},function(e,t,n){"use strict";var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,n){"use strict";(function(t,r){var o=n(19);e.exports=b;var i,s=n(60);b.ReadableState=m;n(2).EventEmitter;var a=function(e,t){return e.listeners(t).length},c=n(59),u=n(14).Buffer,l=t.Uint8Array||function(){};var f=n(13);f.inherits=n(10);var h=n(190),p=void 0;p=h&&h.debuglog?h.debuglog("stream"):function(){};var d,y=n(189),g=n(58);f.inherits(b,c);var v=["error","close","destroy","pause","resume"];function m(e,t){i=i||n(9),e=e||{};var r=t instanceof i;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var o=e.highWaterMark,s=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=o||0===o?o:r&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new y,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(d||(d=n(56).StringDecoder),this.decoder=new d(e.encoding),this.encoding=e.encoding)}function b(e){if(i=i||n(9),!(this instanceof b))return new b(e);this._readableState=new m(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),c.call(this)}function _(e,t,n,r,o){var i,s=e._readableState;null===t?(s.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,E(e)}(e,s)):(o||(i=function(e,t){var n;r=t,u.isBuffer(r)||r instanceof l||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));var r;return n}(s,t)),i?e.emit("error",i):s.objectMode||t&&t.length>0?("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===u.prototype||(t=function(e){return u.from(e)}(t)),r?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):w(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!n?(t=s.decoder.write(t),s.objectMode||0!==t.length?w(e,s,t,!1):O(e,s)):w(e,s,t,!1))):r||(s.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(s)}function w(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&E(e)),O(e,t)}Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),b.prototype.destroy=g.destroy,b.prototype._undestroy=g.undestroy,b.prototype._destroy=function(e,t){this.push(null),t(e)},b.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=u.from(e,t),t=""),n=!0),_(this,e,t,!1,n)},b.prototype.unshift=function(e){return _(this,e,null,!0,!1)},b.prototype.isPaused=function(){return!1===this._readableState.flowing},b.prototype.setEncoding=function(e){return d||(d=n(56).StringDecoder),this._readableState.decoder=new d(e),this._readableState.encoding=e,this};var C=8388608;function k(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=C?e=C:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function E(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(p("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?o.nextTick(S,e):S(e))}function S(e){p("emit readable"),e.emit("readable"),j(e)}function O(e,t){t.readingMore||(t.readingMore=!0,o.nextTick(x,e,t))}function x(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(p("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function A(e){p("readable nexttick read 0"),e.read(0)}function T(e,t){t.reading||(p("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),j(e),t.flowing&&!t.reading&&e.read(0)}function j(e){var t=e._readableState;for(p("flow",t.flowing);t.flowing&&null!==e.read(););}function P(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,o=n.data;e-=o.length;for(;n=n.next;){var i=n.data,s=e>i.length?i.length:e;if(s===i.length?o+=i:o+=i.slice(0,e),0===(e-=s)){s===i.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=i.slice(s));break}++r}return t.length-=r,o}(e,t):function(e,t){var n=u.allocUnsafe(e),r=t.head,o=1;r.data.copy(n),e-=r.data.length;for(;r=r.next;){var i=r.data,s=e>i.length?i.length:e;if(i.copy(n,n.length-e,0,s),0===(e-=s)){s===i.length?(++o,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=i.slice(s));break}++o}return t.length-=o,n}(e,t);return r}(e,t.buffer,t.decoder),n);var n}function R(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,o.nextTick(M,t,e))}function M(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function I(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}b.prototype.read=function(e){p("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return p("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?R(this):E(this),null;if(0===(e=k(e,t))&&t.ended)return 0===t.length&&R(this),null;var r,o=t.needReadable;return p("need readable",o),(0===t.length||t.length-e<t.highWaterMark)&&p("length less than watermark",o=!0),t.ended||t.reading?p("reading or ended",o=!1):o&&(p("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=k(n,t))),null===(r=e>0?P(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&R(this)),null!==r&&this.emit("data",r),r},b.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},b.prototype.pipe=function(e,t){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,p("pipe count=%d opts=%j",i.pipesCount,t);var c=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?l:b;function u(t,r){p("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,p("cleanup"),e.removeListener("close",v),e.removeListener("finish",m),e.removeListener("drain",f),e.removeListener("error",g),e.removeListener("unpipe",u),n.removeListener("end",l),n.removeListener("end",b),n.removeListener("data",y),h=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||f())}function l(){p("onend"),e.end()}i.endEmitted?o.nextTick(c):n.once("end",c),e.on("unpipe",u);var f=function(e){return function(){var t=e._readableState;p("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,j(e))}}(n);e.on("drain",f);var h=!1;var d=!1;function y(t){p("ondata"),d=!1,!1!==e.write(t)||d||((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==I(i.pipes,e))&&!h&&(p("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,d=!0),n.pause())}function g(t){p("onerror",t),b(),e.removeListener("error",g),0===a(e,"error")&&e.emit("error",t)}function v(){e.removeListener("finish",m),b()}function m(){p("onfinish"),e.removeListener("close",v),b()}function b(){p("unpipe"),n.unpipe(e)}return n.on("data",y),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",g),e.once("close",v),e.once("finish",m),e.emit("pipe",n),i.flowing||(p("pipe resume"),n.resume()),e},b.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n),this);if(!e){var r=t.pipes,o=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<o;i++)r[i].emit("unpipe",this,n);return this}var s=I(t.pipes,e);return-1===s?this:(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n),this)},b.prototype.on=function(e,t){var n=c.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&E(this):o.nextTick(A,this))}return n},b.prototype.addListener=b.prototype.on,b.prototype.resume=function(){var e=this._readableState;return e.flowing||(p("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,o.nextTick(T,e,t))}(this,e)),this},b.prototype.pause=function(){return p("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(p("pause"),this._readableState.flowing=!1,this.emit("pause")),this},b.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var o in e.on("end",function(){if(p("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(o){(p("wrapped data"),n.decoder&&(o=n.decoder.write(o)),!n.objectMode||null!==o&&void 0!==o)&&((n.objectMode||o&&o.length)&&(t.push(o)||(r=!0,e.pause())))}),e)void 0===this[o]&&"function"==typeof e[o]&&(this[o]=function(t){return function(){return e[t].apply(e,arguments)}}(o));for(var i=0;i<v.length;i++)e.on(v[i],this.emit.bind(this,v[i]));return this._read=function(t){p("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(b.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),b._fromList=P}).call(this,n(0),n(4))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(201),i=n(199),s=n(198),a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.local=new i(t),this.vector=new o(i.comparator),this.vector.insert(this.local)}return r(e,[{key:"clone",value:function(){for(var t=new e(this.local.e),n=0;n<this.vector.arr.length;++n){t.vector.arr[n]=new i(this.vector.arr[n].e),t.vector.arr[n].v=this.vector.arr[n].v;for(var r=0;r<this.vector.arr[n].x.length;++r)t.vector.arr[n].x.push(this.vector.arr[n].x[r]);t.vector.arr[n].e===this.local.e&&(t.local=t.vector.arr[n])}return t}},{key:"increment",value:function(){return this.local.increment(),new s(this.local.e,this.local.v)}},{key:"incrementFrom",value:function(e){var t=this.vector.indexOf(e.e);t<0?(this.vector.insert(new i(e.e)),this.vector.arr[this.vector.indexOf(e.e)].incrementFrom(e.c)):this.vector.arr[t].incrementFrom(e.c)}},{key:"isReady",value:function(e){if(void 0===e||null===e)return!0;var t=this.vector.indexOf(e.e);return t>=0&&e.c<=this.vector.arr[t].v&&this.vector.arr[t].x.indexOf(e.c)<0}},{key:"isLower",value:function(e){return void 0!==e&&null!==e&&this.isReady(e)}},{key:"merge",value:function(e){for(var t=0;t<e.vector.arr.length;++t){var n=e.vector.arr[t],r=this.vector.indexOf(n);if(r<0){var o=new i(n.e);o.v=n.v;for(var s=0;s<n.x.length;++s)o.x.push(n.x[s]);this.vector.insert(o)}else{for(var a=this.vector.arr[r],c=0;c<a.x.length;)a.x[c]<n.v&&n.x.indexOf(a.x[c])<0?a.x.splice(c,1):++c;for(c=0;c<n.x.length;)n.x[c]>a.v&&a.x.indexOf(n.x[c])<0&&a.x.push(n.x[c]),++c;a.v=Math.max(a.v,n.v)}}}}],[{key:"fromJSON",value:function(t){for(var n=new e(t.local.e),r=0;r<t.vector.arr.length;++r){n.vector.arr[r]=new i(t.vector.arr[r].e),n.vector.arr[r].v=t.vector.arr[r].v;for(var o=0;o<t.vector.arr[r].x.length;++o)n.vector.arr[r].x.push(t.vector.arr[r].x[o]);t.vector.arr[r].e===t.local.e&&(n.local=n.vector.arr[r])}return n}}]),e}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var i=n(202),s=n(62),a=n(197),c=n(5),u=n(196),l=n(3)("foglet-core:broadcast");function f(e){return"e="+e.id.e+"&c="+e.id.c}var h=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return e&&n?(r.options={id:e._options.peer,delta:3e4},r._causality=new s(r.options.id),r._buffer=[],r._bufferAntiEntropy=a.MAntiEntropyResponse("init"),r):o(r,new Error("Not enough parameters","fbroadcast.js"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"_sendAll",value:function(e){var t=this,n=this._source.getNeighbours(1/0);n.length>0&&n.forEach(function(n){return t._unicast.send(n,e).catch(function(e){return l("Error: It seems there is not a receiver",e)})})}},{key:"send",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=t||this._causality.increment(),o=a.BroadcastMessage(this._protocol,r,n,e);return this._causality.incrementFrom(r),this._sendAll(o),r}},{key:"startAntiEntropy",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.delta;this._intervalAntiEntropy=setInterval(function(){e._source.getNeighbours().forEach(function(t){return e._unicast.send(t,a.MAntiEntropyRequest(e._causality))})},t),this.on("antiEntropy",function(t,n,r){return e._defaultBehaviorAntiEntropy(t,n,r)})}},{key:"_defaultBehaviorAntiEntropy",value:function(e,t,n){l("(Warning) You should modify this, AntiEntropy default behavior: ",e,t,n)}},{key:"clearAntiEntropy",value:function(){this._intervalAntiEntropy&&clearInterval(this._intervalAntiEntropy)}},{key:"sendAntiEntropyResponse",value:function(e,t,n){for(var r=c(),o=this._unicast.send(e,a.MAntiEntropyResponse(r,t,n.length)),i=0;o&&i<n.length;)o=this._unicast.send(e,a.MAntiEntropyResponse(r,null,n.length,n[i])),++i}},{key:"_receive",value:function(e,t){switch("issuer"in t||(t.issuer=e),t.type){case"MAntiEntropyRequest":l(e,t),this.emit("antiEntropy",e,t.causality,this._causality.clone());break;case"MAntiEntropyResponse":if(this._bufferAntiEntropy.id!==t.id&&(this._bufferAntiEntropy=t),t.element&&this._bufferAntiEntropy.elements.push(t.element),t.causality&&(this._bufferAntiEntropy.causality=t.causality),this._bufferAntiEntropy.elements.length===this._bufferAntiEntropy.nbElements){for(var n=0;n<this._bufferAntiEntropy.elements.length;++n){var r=this._bufferAntiEntropy.elements[n];this._shouldStopPropagation(r)||(this._causality.incrementFrom(r.id),this.emit("receive",t.issuer,r.payload))}this._causality.merge(this._bufferAntiEntropy.causality)}break;default:if(!this._shouldStopPropagation(t)){var o=u(this._buffer,t,f);this._buffer.splice(o,0,t),this._reviewBuffer(),this._sendAll(t)}}}},{key:"_shouldStopPropagation",value:function(e){return this._causality.isLower(e.id)||this._findInBuffer(f(e))>=0}},{key:"_findInBuffer",value:function(e){for(var t=0,n=this._buffer.length-1,r=void 0,o=void 0;t<=n;)if(r=(t+n)/2|0,(o=f(this._buffer[r]))<e)t=r+1;else{if(!(o>e))return r;n=r-1}return-1}},{key:"_reviewBuffer",value:function(){for(var e=void 0,t=!1,n=this._buffer.length-1;n>=0;--n)e=this._buffer[n],this._causality.isLower(e.id)?this._buffer.splice(n,1):this._causality.isReady(e.isReady)&&(t=!0,this._causality.incrementFrom(e.id),this._buffer.splice(n,1),this.emit("receive",e.issuer,e.payload));t&&this._reviewBuffer()}}]),t}();e.exports=h},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(28),i=n(63),s=n(194),a=n(193),c=n(182),u=n(181),l=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.network=t,this.unicast=new o(this.network,n),this.broadcast=new i(this.network,n),this.media=new u(this.network,n),this._unicastStreams=new o(this.network,n+"-streams"),this._broadcastStreams=new i(this.network,n+"-streams"),this._activeStreams=new Map,this._middlewares=new s}return r(e,[{key:"use",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._middlewares.register(e,t)}},{key:"sendUnicastMediaStream",value:function(e,t){return console.log("[Warning] experimental function. Allows you to send a stream to a neighbor. But will be closed when a shuffle arrives."),this.media.sendUnicast(e,t)}},{key:"sendBroadcastMediaStream",value:function(e,t){return console.log("[Warning] experimental function. Allows you to send a stream to all the network."),this.media.sendBroadcast(e,t)}},{key:"onMediaStream",value:function(e){this.media.on("receive",e)}},{key:"sendUnicast",value:function(e,t){return this.unicast.send(e,this._middlewares.in(t))}},{key:"streamUnicast",value:function(e){var t=this;return new a(function(n){n.payload=t._middlewares.in(n.payload),t._unicastStreams.send(e,n)})}},{key:"sendMulticast",value:function(e,t){return this.unicast.sendMultiple(e,this._middlewares.in(t))}},{key:"sendBroadcast",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return this.broadcast.send(this._middlewares.in(e),t,n)}},{key:"streamBroadcast",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return new a(function(t,n,r){return t.payload=e._middlewares.in(t.payload),e._broadcastStreams.send(t,n,r)},t)}},{key:"onUnicast",value:function(e){var t=this;this.unicast.on("receive",function(n,r){e(n,t._middlewares.out(r))})}},{key:"onStreamUnicast",value:function(e){var t=this;this._unicastStreams.on("receive",function(n,r){return t._handleStreamMessage(n,r,e)})}},{key:"onOnceUnicast",value:function(e){var t=this;this.unicast.once("receive",function(n,r){e(n,t._middlewares.out(r))})}},{key:"onBroadcast",value:function(e){var t=this;this.broadcast.on("receive",function(n,r){return e(n,t._middlewares.out(r))})}},{key:"onStreamBroadcast",value:function(e){var t=this;this._broadcastStreams.on("receive",function(n,r){return t._handleStreamMessage(n,r,e)})}},{key:"onOnceBroadcast",value:function(e){var t=this;this.broadcast.once("receive",function(n,r){return e(n,t._middlewares.out(r))})}},{key:"removeAllUnicastCallback",value:function(){this.unicast.removeAllListeners("receive")}},{key:"removeAllBroacastCallback",value:function(){this.broadcast.removeAllListeners("receive")}},{key:"_handleStreamMessage",value:function(e,t,n){switch(this._activeStreams.has(t.id)||(this._activeStreams.set(t.id,new c),n(e,this._activeStreams.get(t.id))),t.type){case"chunk":this._activeStreams.get(t.id).push(t.payload);break;case"trailers":if(!this._activeStreams.has(t.id))throw new Error("Cannot add trailers to an unkown stream with id = "+t.id);this._activeStreams.get(t.id)._trailers=t.payload;break;case"end":this._closeStream(t.id);break;case"error":if(!this._activeStreams.has(t.id))throw new Error("Cannot transmit an error to an unkown stream with id = "+t.id);this._activeStreams.get(t.id).emit("error",t.payload),this._closeStream(t.id);break;default:throw new Error("Unknown StreamMessage type found in incoming stream message: "+t.type)}}},{key:"_closeStream",value:function(e){if(!this._activeStreams.has(e))throw new Error("Cannot close an unkown stream with id = "+e);this._activeStreams.get(e).push(null),this._activeStreams.delete(e)}}]),e}();e.exports=l},function(e,t,n){"use strict";var r=n(218);e.exports=function(e,t){for(var n,o=0,i="";!n;)i+=e(t>>4*o&15|r()),n=t<Math.pow(16,o+1),o++;return i}},function(e,t,n){"use strict";e.exports=n(220)},function(module,exports,__webpack_require__){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};"object"!==("undefined"==typeof JSON?"undefined":_typeof(JSON))&&(JSON={}),function(){var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta,rep;function f(e){return e<10?"0"+e:e}function this_value(){return this.valueOf()}function quote(e){return rx_escapable.lastIndex=0,rx_escapable.test(e)?'"'+e.replace(rx_escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,o,i,s,a=gap,c=t[e];switch(c&&"object"===(void 0===c?"undefined":_typeof(c))&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),void 0===c?"undefined":_typeof(c)){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(i=c.length,n=0;n<i;n+=1)s[n]=str(n,c)||"null";return o=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,o}if(rep&&"object"===(void 0===rep?"undefined":_typeof(rep)))for(i=rep.length,n=0;n<i;n+=1)"string"==typeof rep[n]&&(o=str(r=rep[n],c))&&s.push(quote(r)+(gap?": ":":")+o);else for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(o=str(r,c))&&s.push(quote(r)+(gap?": ":":")+o);return o=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,o}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value),"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;r<n;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!==(void 0===t?"undefined":_typeof(t))||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){var j;function walk(e,t){var n,r,o=e[t];if(o&&"object"===(void 0===o?"undefined":_typeof(o)))for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(void 0!==(r=walk(o,n))?o[n]=r:delete o[n]);return reviver.call(e,t,o)}if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()},function(e,t,n){"use strict";e.exports=function(){return n(67),{}}},function(e,t,n){"use strict";e.exports={name:"memoryStorage",read:function(e){return r[e]},write:function(e,t){r[e]=t},each:function(e){for(var t in r)r.hasOwnProperty(t)&&e(r[t],t)},remove:function(e){delete r[e]},clearAll:function(e){r={}}};var r={}},function(e,t,n){"use strict";var r=n(6).Global;function o(){return r.sessionStorage}function i(e){return o().getItem(e)}e.exports={name:"sessionStorage",read:i,write:function(e,t){return o().setItem(e,t)},each:function(e){for(var t=o().length-1;t>=0;t--){var n=o().key(t);e(i(n),n)}},remove:function(e){return o().removeItem(e)},clearAll:function(){return o().clear()}}},function(e,t,n){"use strict";var r=n(6),o=r.Global,i=r.trim;e.exports={name:"cookieStorage",read:function(e){if(!e||!u(e))return null;var t="(?:^|.*;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(s.cookie.replace(new RegExp(t),"$1"))},write:function(e,t){if(!e)return;s.cookie=escape(e)+"="+escape(t)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/"},each:a,remove:c,clearAll:function(){a(function(e,t){c(t)})}};var s=o.document;function a(e){for(var t=s.cookie.split(/; ?/g),n=t.length-1;n>=0;n--)if(i(t[n])){var r=t[n].split("="),o=unescape(r[0]);e(unescape(r[1]),o)}}function c(e){e&&u(e)&&(s.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function u(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(s.cookie)}},function(e,t,n){"use strict";var r=n(6).Global;e.exports={name:"oldIE-userDataStorage",write:function(e,t){if(a)return;var n=u(e);s(function(e){e.setAttribute(n,t),e.save(o)})},read:function(e){if(a)return;var t=u(e),n=null;return s(function(e){n=e.getAttribute(t)}),n},each:function(e){s(function(t){for(var n=t.XMLDocument.documentElement.attributes,r=n.length-1;r>=0;r--){var o=n[r];e(t.getAttribute(o.name),o.name)}})},remove:function(e){var t=u(e);s(function(e){e.removeAttribute(t),e.save(o)})},clearAll:function(){s(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(o);for(var n=t.length-1;n>=0;n--)e.removeAttribute(t[n].name);e.save(o)})}};var o="storejs",i=r.document,s=function(){if(!i||!i.documentElement||!i.documentElement.addBehavior)return null;var e,t,n;try{(t=new ActiveXObject("htmlfile")).open(),t.write('<script>document.w=window<\/script><iframe src="/favicon.ico"></iframe>'),t.close(),e=t.w.frames[0].document,n=e.createElement("div")}catch(t){n=i.createElement("div"),e=i.body}return function(t){var r=[].slice.call(arguments,0);r.unshift(n),e.appendChild(n),n.addBehavior("#default#userData"),n.load(o),t.apply(this,r),e.removeChild(n)}}(),a=(r.navigator?r.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./);var c=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function u(e){return e.replace(/^\d/,"___$&").replace(c,"___")}},function(e,t,n){"use strict";var r=n(6).Global;e.exports={name:"oldFF-globalStorage",read:function(e){return o[e]},write:function(e,t){o[e]=t},each:i,remove:function(e){return o.removeItem(e)},clearAll:function(){i(function(e,t){delete o[e]})}};var o=r.globalStorage;function i(e){for(var t=o.length-1;t>=0;t--){var n=o.key(t);e(o[n],n)}}},function(e,t,n){"use strict";var r=n(6).Global;function o(){return r.localStorage}function i(e){return o().getItem(e)}e.exports={name:"localStorage",read:i,write:function(e,t){return o().setItem(e,t)},each:function(e){for(var t=o().length-1;t>=0;t--){var n=o().key(t);e(i(n),n)}},remove:function(e){return o().removeItem(e)},clearAll:function(){return o().clear()}}},function(e,t,n){"use strict";e.exports=[n(74),n(73),n(72),n(71),n(70),n(69)]},function(e,t,n){"use strict";var r=n(6),o=r.slice,i=r.pluck,s=r.each,a=r.bind,c=r.create,u=r.isList,l=r.isFunction,f=r.isObject;e.exports={createStore:p};var h={version:"2.0.12",enabled:!1,get:function(e,t){var n=this.storage.read(this._namespacePrefix+e);return this._deserialize(n,t)},set:function(e,t){return void 0===t?this.remove(e):(this.storage.write(this._namespacePrefix+e,this._serialize(t)),t)},remove:function(e){this.storage.remove(this._namespacePrefix+e)},each:function(e){var t=this;this.storage.each(function(n,r){e.call(t,t._deserialize(n),(r||"").replace(t._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function(e){return this._namespacePrefix=="__storejs_"+e+"_"},createStore:function(){return p.apply(this,arguments)},addPlugin:function(e){this._addPlugin(e)},namespace:function(e){return p(this.storage,this.plugins,e)}};function p(e,t,n){n||(n=""),e&&!u(e)&&(e=[e]),t&&!u(t)&&(t=[t]);var r=n?"__storejs_"+n+"_":"",p=n?new RegExp("^"+r):null;if(!/^[a-zA-Z0-9_\-]*$/.test(n))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var d=c({_namespacePrefix:r,_namespaceRegexp:p,_testStorage:function(e){try{var t="__storejs__test__";e.write(t,t);var n=e.read(t)===t;return e.remove(t),n}catch(e){return!1}},_assignPluginFnProp:function(e,t){var n=this[t];this[t]=function(){var t=o(arguments,0),r=this;var i=[function(){if(n)return s(arguments,function(e,n){t[n]=e}),n.apply(r,t)}].concat(t);return e.apply(r,i)}},_serialize:function(e){return JSON.stringify(e)},_deserialize:function(e,t){if(!e)return t;var n="";try{n=JSON.parse(e)}catch(t){n=e}return void 0!==n?n:t},_addStorage:function(e){this.enabled||this._testStorage(e)&&(this.storage=e,this.enabled=!0)},_addPlugin:function(e){var t=this;if(u(e))s(e,function(e){t._addPlugin(e)});else if(!i(this.plugins,function(t){return e===t})){if(this.plugins.push(e),!l(e))throw new Error("Plugins must be function values that return objects");var n=e.call(this);if(!f(n))throw new Error("Plugins must return an object of function properties");s(n,function(n,r){if(!l(n))throw new Error("Bad plugin property: "+r+" from plugin "+e.name+". Plugins should only return functions.");t._assignPluginFnProp(n,r)})}},addStorage:function(e){!function(){var e="undefined"==typeof console?null:console;e&&(e.warn?e.warn:e.log).apply(e,arguments)}("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(e)}},h,{plugins:[]});return d.raw={},s(d,function(e,t){l(e)&&(d.raw[t]=a(d,e))}),s(e,function(e){d._addStorage(e)}),s(t,function(e){d._addPlugin(e)}),d}},function(e,t,n){"use strict";var r=n(76),o=n(75),i=[n(68)];e.exports=r.createStore(o,i)},function(e,t,n){"use strict";var r,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(i){var s,a,c,u=(s=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|"[^"]*"|'[^']*'/g,a=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,c=/[^-+\dA-Z]/g,function(e,t,n,r){if(1!==arguments.length||"string"!==(null===(i=e)?"null":void 0===i?"undefined":"object"!==(void 0===i?"undefined":o(i))?void 0===i?"undefined":o(i):Array.isArray(i)?"array":{}.toString.call(i).slice(8,-1).toLowerCase())||/\d/.test(e)||(t=e,e=void 0),(e=e||new Date)instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");var i,f=(t=String(u.masks[t]||t||u.masks.default)).slice(0,4);"UTC:"!==f&&"GMT:"!==f||(t=t.slice(4),n=!0,"GMT:"===f&&(r=!0));var h=n?"getUTC":"get",p=e[h+"Date"](),d=e[h+"Day"](),y=e[h+"Month"](),g=e[h+"FullYear"](),v=e[h+"Hours"](),m=e[h+"Minutes"](),b=e[h+"Seconds"](),_=e[h+"Milliseconds"](),w=n?0:e.getTimezoneOffset(),C=function(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());t.setDate(t.getDate()-(t.getDay()+6)%7+3);var n=new Date(t.getFullYear(),0,4);n.setDate(n.getDate()-(n.getDay()+6)%7+3);var r=t.getTimezoneOffset()-n.getTimezoneOffset();t.setHours(t.getHours()-r);var o=(t-n)/6048e5;return 1+Math.floor(o)}(e),k=function(e){var t=e.getDay();return 0===t&&(t=7),t}(e),E={d:p,dd:l(p),ddd:u.i18n.dayNames[d],dddd:u.i18n.dayNames[d+7],m:y+1,mm:l(y+1),mmm:u.i18n.monthNames[y],mmmm:u.i18n.monthNames[y+12],yy:String(g).slice(2),yyyy:g,h:v%12||12,hh:l(v%12||12),H:v,HH:l(v),M:m,MM:l(m),s:b,ss:l(b),l:l(_,3),L:l(Math.round(_/10)),t:v<12?u.i18n.timeNames[0]:u.i18n.timeNames[1],tt:v<12?u.i18n.timeNames[2]:u.i18n.timeNames[3],T:v<12?u.i18n.timeNames[4]:u.i18n.timeNames[5],TT:v<12?u.i18n.timeNames[6]:u.i18n.timeNames[7],Z:r?"GMT":n?"UTC":(String(e).match(a)||[""]).pop().replace(c,""),o:(w>0?"-":"+")+l(100*Math.floor(Math.abs(w)/60)+Math.abs(w)%60,4),S:["th","st","nd","rd"][p%10>3?0:(p%100-p%10!=10)*p%10],W:C,N:k};return t.replace(s,function(e){return e in E?E[e]:e.slice(1,e.length-1)})});function l(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e}u.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},u.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},void 0===(r=function(){return u}.call(t,n,t,e))||(e.exports=r)}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(78);(r=i)&&r.__esModule;var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._editorContainerID=t,this._viewEditor={},this._inputCommentModel=$("#"+this._editorContainerID+" #inputCommentModal"),this._comments=$("#"+this._editorContainerID+" #comments"),this._ql_editor=$("#"+this._editorContainerID+" .ql-editor"),this._editor=$("#"+this._editorContainerID+" .editor"),this._commentInput=$("#"+this._editorContainerID+" #commentInput"),this._currentTimestamp={},this._commentCallback={},this.commentAddClick=this.commentAddClick.bind(this),this.commentsClick=this.commentsClick.bind(this)}return o(e,[{key:"commentAddClick",value:function(e,t){this._commentCallback=e.bind(t),this._inputCommentModel.modal("show")}},{key:"commentServerTimestamp",value:function(){var e=this;return new Promise(function(t,n){e._currentTimestamp=Math.round((new Date).getTime()/1e3),t(e._currentTimestamp)})}},{key:"commentsClick",value:function(){this._comments.is(":visible")?(this._ql_editor.hasClass("ql-comments")&&this._ql_editor.removeClass("ql-comments"),this._comments.hide(),this._comments.css("width","0%"),this._editor.css("width","100%")):(this._comments.addClass("comment"),this._editor.hasClass("ql-comments")||this._editor.addClass("ql-comments"),this._comments.css("width","30%"),this._editor.css("width","70%"),this._comments.show())}},{key:"addCommentToList",value:function(e,t,n,r,o,i){var s=this,a=i,c=new Date,u=dateFormat(c,"dddd, mmmm dS, yyyy, h:MM:ss TT"),l="ql-comment-"+t+"-"+a,f=$("<div class='comment-box "+l+" row' id='comment-box-"+l+"' tabindex=\"1\" title='"+u+"'>\n      <div class='comment-head row'>\n        <div id=\""+l+'"style="background-color:'+o+';width: 40px;" ><img class="imageuser" src="./icons/'+n+'.png" alt="'+r+"\"></div>\n    \n        <div class='comment-details'>\n          <div class='comment-author'>"+r+"</div>\n        </div>\n      </div>\n      <div class='comment-body row' >"+e+"</div>\n  \n    </div>");this._comments.append(f),$("#comment-box-"+l).focusin(function(){s.commentBoxFocus(l)}),$("#comment-box-"+l).focusout(function(){s.commentBoxFocus(l,"out")})}},{key:"saveComment",value:function(){var e=this._commentInput.val();this._commentCallback(e);var t=this._viewEditor.options.modules.comment.commentAddOn,n=this._viewEditor.options.modules.comment.commentAuthorId,r=this._viewEditor.options.modules.comment.color;this.addCommentToList(e,n,t,store.get("myId").pseudo,r,this._currentTimestamp)}},{key:"commentBoxFocus",value:function(e,t){"out"!==t?($(".ql-comments #"+e).addClass("commentFocus"),this._comments.find("."+e).css("border-color","red")):($(".ql-comments #"+e).removeClass("commentFocus"),this._comments.find(".comment-box").css("border-color","#F0F0F0"))}},{key:"viewEditor",get:function(){return this._viewEditor},set:function(e){this._viewEditor=e}}]),e}();t.default=s},function(e,t,n){"use strict";e.exports=function(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return t>>>0}},function(e,t,n){"use strict";
/*!
	unique-random
	Generate random numbers that are consecutively unique
	https://github.com/sindresorhus/unique-random
	by Sindre Sorhus
	MIT License
*/
/*!
	unique-random
	Generate random numbers that are consecutively unique
	https://github.com/sindresorhus/unique-random
	by Sindre Sorhus
	MIT License
*/
!function(){function t(e,t){var n;return function r(){var o=Math.floor(Math.random()*(t-e+1)+e);return n=o===n&&e!==t?r():o}}void 0!==e&&e.exports?e.exports=t:window.uniqueRandom=t}()},function(e){e.exports=["Alligator","Anteater","Armadillo","Auroch","Axolotl","Badger","Bat","Beaver","Buffalo","Camel","Capybara","Chameleon","Cheetah","Chinchilla","Chipmunk","Chupacabra","Cormorant","Coyote","Crow","Dingo","Dinosaur","Dolphin","Duck","Elephant","Ferret","Fox","Frog","Giraffe","Gopher","Grizzly","Hedgehog","Hippo","Hyena","Ibex","Ifrit","Iguana","Jackal","Kangaroo","Koala","Kraken","Lemur","Leopard","Liger","Llama","Manatee","Mink","Monkey","Moose","Narwhal","Nyan Cat","Orangutan","Otter","Panda","Penguin","Platypus","Pumpkin","Python","Quagga","Rabbit","Raccoon","Rhino","Sheep","Shrew","Skunk","Squirrel","Tiger","Turtle","Walrus","Wolf","Wolverine","Wombat"]},function(e,t,n){"use strict";var r=n(82),o=n(81)(0,r.length-1);e.exports=function(){return r[o()]},e.exports.words=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=a(n(30)),i=a(n(79)),s=n(2);function a(e){return e&&e.__esModule?e:{default:e}}var c=n(31)("crate:view:editor");Quill.register("modules/cursors",QuillCursors),Quill.register("modules/comment",QuillComment);var u=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.model=e,o.markers={},o.startTimer={},o.viewEditor={},o._editorContainerID=r,o._comments=new i.default(o._editorContainerID),o._sessionID=n,o.loadDocument(n),o.startPing(5e3),jQuery("#"+o._editorContainerID+" #saveicon").click(function(){o.saveDocument()}),jQuery("#"+o._editorContainerID+" #title").focusout(function(){o.changeTitle(),o.emit("thereAreChanges")}),o.viewEditor.on("selection-change",function(e,t,n){e&&o.model.core.caretMoved(e)}),o.viewEditor.on("text-change",function(e,t,n){o.textChange(e,t,n),o.emit("thereAreChanges")}),o.model.core.on("remoteInsert",function(e,t){o.remoteInsert(e,t),o.emit("thereAreChanges")}),o.model.core.on("remoteRemove",function(e){o.remoteRemove(e),o.emit("thereAreChanges")}),o.model.core.on("remoteCaretMoved",function(e,t){o.remoteCaretMoved(e,t)}),o.model.core.on("remoteCaretMoved",function(e,t){o.remoteCaretMoved(e,t)}),o.model.on("changeTitle",function(e){jQuery("#"+o._editorContainerID+" #title").text(e),o.emit("thereAreChanges")}),o.model.core.on("ping",function(e,t){o.atPing(e,t)}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.EventEmitter),r(t,[{key:"loadDocument",value:function(e){var t=this;if(this.createViewDocument(),store.get("CRATE2-"+e)){var n=store.get("CRATE2-"+e);this.viewEditor.setContents(n.delta,"user"),jQuery("#"+this._editorContainerID+" #title").text(n.title),session.default.openIn()}jQuery("#"+this._editorContainerID+" #title").click(function(){jQuery("#"+t._editorContainerID+" #title").attr("contenteditable","true")}),this.markers={},this.model.markers=this.markers;var r=this.model.uid;this.markers[r]=new o.default(r,{lifeTime:5e3,range:{index:0,length:0},cursor:!1,isItME:!0},this),store.get("myId")?this.markers[r].setPseudo(store.get("myId").pseudo):store.set("myId",{id:r,pseudo:this.markers[r].pseudoName}),this.UpdateComments();var i=this.viewEditor.options.modules.comment;i.commentAddOn=this.markers[r].animal,i.commentAuthorId=this.model.uid,i.color=this.markers[r].colorRGB}},{key:"createViewDocument",value:function(){var e=new Quill("#"+this._editorContainerID+" #editor",{modules:{formula:!0,toolbar:{container:[[{header:[1,2,3,4,5,6,!1]}],[{font:[]}],["bold","italic","underline","strike"],[{align:[]}],[{list:"ordered"},{list:"bullet"}],[{color:[]},{background:[]}],["clean"],["formula","image","link"],["subdocument"],["comments-toggle"],["comments-add"]],handlers:{subdocument:function(e){this.quill.getSelection();var t=window.location.href.split("?")[0]+"?"+session.default.GUID();this.quill.theme.tooltip.edit("link",t)},undo:function(e){this.quill.history.undo()},redo:function(e){this.quill.history.redo()}}},cursors:{autoRegisterListener:!0,hideDelay:500,hideSpeed:0},history:{delay:500,maxStack:1e3},comment:{enabled:!0,commentAuthorId:123,commentAddOn:"Author Name",color:"yellow",commentAddClick:this._comments.commentAddClick,commentsClick:this._comments.commentsClick,commentTimestamp:this._comments.commentServerTimestamp,containerID:this._editorContainerID}},theme:"snow"});$(".ql-subdocument .ql-comments-toggle .ql-comments-add").attr("data-toggle","tooltip"),$(".ql-comments-toggle,.ql-comments-add").css({position:"relative",top:"-5px"}),$(".ql-subdocument").html("<strong>SUB</strong>"),$(".ql-subdocument").attr("title","Add subdocument"),$(".ql-comments-toggle").html('<i class="fa fa-comments"></i>'),$(".ql-comments-toggle").attr("title","Show/hide comments"),$(".ql-comments-add").html('<i class="fa fa-comment"></i>'),$(".ql-comments-add").attr("title","Add comment"),e.theme.tooltip.save2=e.theme.tooltip.save,e.theme.tooltip.save=function(){e.theme.tooltip.save2(),session.default.openIn()},this._comments.viewEditor=e,this.viewEditor=e}},{key:"saveDocument",value:function(){var e={date:(new Date).getTime(),title:jQuery("#"+this._editorContainerID+" #title").text(),delta:this.viewEditor.editor.delta,sequence:this.model.sequence,causality:this.model.causality,name:this.model.name,webRTCOptions:this.model.webRTCOptions,markers:{},signalingOptions:this.model.signalingOptions};store.set("CRATE2-"+this.model.signalingOptions.session,e),alert("Document is saved successfully")}},{key:"textChange",value:function(e,t,n){this.cleanQuill(),this.applyChanges(e,0)}},{key:"applyChanges",value:function(e,t){var n=this,r=t;JSON.parse(JSON.stringify(e,null,2)).ops.forEach(function(e){for(var t=Object.keys(e),o="",i="",s="",a=t.length-1;a>=0;a--){var c=e[t[a]];"attributes"===t[a]?i=c:(o=t[a],s=c)}r=n.sendIt("",i,0,s,o,r,!1)})}},{key:"sendIt",value:function(e,t,n,r,o,i,s){switch(o){case"retain":if(""!=t){this.sendIt("","",i,r,"delete",i,!0);var a=this.viewEditor.editor.delta.slice(i,i+r);this.applyChanges(a,i)}else i+=r;break;case"insert":if(e=r,void 0!=r.formula)t=this.viewEditor.getFormat(i,1),this.model.core.insert({type:"formula",text:r,att:t},i);else if(void 0!=r.video)t=this.viewEditor.getFormat(i,1),this.model.core.insert({type:"video",text:r,att:t},i);else if(void 0!=r.image)t=this.viewEditor.getFormat(i,1),this.model.core.insert({type:"image",text:r,att:t},i);else{for(var u=i;u<i+e.length;++u)t=this.viewEditor.getFormat(u,1),c("Local insert : ",e[u-i],u),this.model.core.insert({type:"char",text:e[u-i],att:t},u);i+=e.length}break;case"delete":var l=r;s||this.UpdateComments(),0==n&&(n=i);for(u=n;u<n+l;++u)this.model.core.remove(n)}return i}},{key:"remoteInsert",value:function(e,t){var n=t-1;if(c("Remote Insert : ",e,n),-1!==n){switch(e.type){case"formula":this.viewEditor.insertEmbed(n,"formula",e.text.formula,"silent");break;case"image":this.viewEditor.insertEmbed(n,"image",e.text.image,"silent");break;case"video":this.viewEditor.insertEmbed(n,"video",e.text.video,"silent");break;case"char":this.viewEditor.insertText(n,e.text,e.att,"silent"),"\n"!=e.text&&this.viewEditor.removeFormat(n,1,"silent")}e.att&&("\n"!=e.text&&(this.viewEditor.formatLine(n,e.att,"silent"),this.viewEditor.formatText(n,1,e.att,"silent")),e.att.commentAuthor&&this.UpdateComments(),e.att.link&&session.default.openIn())}session.default.openIn(),this.cleanQuill()}},{key:"remoteRemove",value:function(e){c("Remote remove : ",e);var t=e-1;-1!==t&&(this.viewEditor.deleteText(t,1,"silent"),this.UpdateComments()),this.cleanQuill()}},{key:"remoteCaretMoved",value:function(e,t){if(t)if(this.markers[t])this.markers[t].update(e,!0);else{var n={lifeTime:5e3,range:e,cursor:!1,isItME:!1};this.markers[t]=new o.default(t,n,this)}}},{key:"cleanQuill",value:function(){}},{key:"changeTitle",value:function(){jQuery("#"+this._editorContainerID+" #title").attr("contenteditable","false"),""==jQuery("#"+this._editorContainerID+" #title").text()&&jQuery("#"+this._editorContainerID+" #title").text("Untitled document"),this.model.name=jQuery("#"+this._editorContainerID+" #title").text(),this.model.core.sendChangeTitle(jQuery("#"+this._editorContainerID+" #title").text())}},{key:"startPing",value:function(e){var t=this;this.startTimer=setInterval(function(){var e="Anonymous";store.get("myId").pseudo&&(e=store.get("myId").pseudo),t.model.core.sendPing(e)},e)}},{key:"stopPing",value:function(){clearInterval(this.startTimer)}},{key:"atPing",value:function(e,t){if(this.markers[e])this.markers[e].update(null,!1),this.markers[e].setPseudo(t);else{this.markers[e]=new o.default(e,{lifeTime:5e3,range:{index:0,length:0},cursor:!1,isItME:!1},this),this.markers[e].setPseudo(t)}}},{key:"UpdateComments",value:function(){var e=this;jQuery("#"+this._editorContainerID+" #comments").empty(),this.viewEditor.editor.delta.ops.forEach(function(t){if(t.insert&&t.attributes&&t.attributes.commentAuthor){var n=t.attributes.commentAuthor,r={},i=(r=e.markers[n]?e.markers[n]:{animal:o.default.getPseudoname(n,null),pseudoName:o.default.getPseudoname(n),colorRGB:o.default.getColor(n,"rgb")}).animal,s=r.pseudoName,a=r.colorRGB;e._comments.addCommentToList(t.attributes.comment,n,i,s,a,t.attributes.commentTimestamp)}})}},{key:"saveComment",value:function(){this._comments.saveComment()}}]),t}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t,n,r,o){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.model=t,this.startSharingText='<i class="fa fa-link fa-2x ficon2"></i>',this.startSharingTooltip="start sharing",this.stopSharingText='<i class="fa fa-unlink fa-2x ficon2"></i>',this.stopSharingTooltip="stop sharing",this.red="#cd2626",this.yellow="#eead0e",this.green="#228b22",this.blue="#00BFFF",this._editorContainerID=o,this.networkState=jQuery("#"+this._editorContainerID+" #state"),this.setNetworkState("connected"),t.rps.on("statechange",function(e){switch(e){case"connected":i.setNetworkState("connected");break;case"partially connected":i.setNetworkState("partiallyConnected");break;case"disconnected":i.setNetworkState("disconnected")}}),r.click(function(){var e=window.location.href.split("?")[0];n.printLink(e+"?"+i.model.signalingOptions.session),jQuery("#"+i._editorContainerID+" #copyButton").click(function(){i.copyLink()})}),n.qrcode.click(function(){var e=window.location.href.split("?")[0];e=e+"?"+i.model.signalingOptions.session,n.qrcodeCanvas.html(""),n.qrcodeCanvas.qrcode({size:400,text:e})})}return r(e,[{key:"copyLink",value:function(){console.log("Copy => #"+this._editorContainerID+" #sessionUrl"),jQuery("#"+this._editorContainerID+" #sessionUrl").select(),document.execCommand("Copy")}},{key:"setNetworkState",value:function(e){switch(e){case"connected":this.networkState.css("color",this.green),this.networkState.attr("data-content","<span class='alert-success'>Congratulations!</span>\n                     You are connected to people, and people are \n                     connected to you. <span class='alert-info'>You can start editing \" \n                     together</span>.");break;case"partiallyConnected":this.networkState.css("color",this.green),this.networkState.attr("data-content","<span class='alert-warning'>Partially connected</span>: \n                     either you are connected to people, or people are connected to you. \n                     This is not great, but you <span class='alert-info'> still can edit.</span>");break;case"disconnected":this.networkState.css("color",this.red),this.networkState.attr("data-content","<span class='alert-danger'>Disconnected</span>:\n                     you are currently editing <span class='alert-info'>on\n                    your own</span>.")}}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.linkContainer=jQuery("<div>").appendTo(t).css("position","relative").css("top","0px").css("width","45vw-25px").css("z-index","0").css("opacity","0.9").attr("id","linkContainer").hide();var r=jQuery("<div>").appendTo(t).attr("id","modalQRCode"+n).attr("tabindex","-1").attr("role","dialog").attr("aria-labelledby","modalQRCodeLabel").attr("aria-hidden","true").addClass("modal"),o=jQuery("<div>").appendTo(r).addClass("modal-dialog"),i=jQuery("<div>").appendTo(o).addClass("modal-content text-center");this.qrcodeCanvas=jQuery("<div>"),i.append(jQuery("<br>")).append(this.qrcodeCanvas).append(jQuery("<br>")),this.alert=jQuery("<div>").appendTo(this.linkContainer),this.dismiss=jQuery("<button>").appendTo(this.alert).attr("type","button").addClass("close").html('<span  aria-hidden="true">&times;</span><span class="sr-only"> Close </span>');var s=jQuery("<div>").appendTo(this.alert).addClass("container"),a=jQuery("<div>").appendTo(s).addClass("input-group").attr("style","margin-left: -16px;");this.input=jQuery("<input>").appendTo(a).attr("type","text").attr("id","sessionUrl").attr("placeholder","Nothing to see here, move along.").addClass("form-control");var c=jQuery("<span>").appendTo(a).addClass("input-group-btn");this.qrcode=jQuery("<button>").appendTo(c).attr("aria-label","QR-code").attr("type","button").attr("data-target","#modalQRCode"+n).attr("data-toggle","modal").addClass("btn btn-default").html('<i class="fa fa-qrcode"></i>'),this.action=jQuery('<button  id="copyButton">').appendTo(c).attr("aria-label","Go!").attr("type","button").addClass("btn btn-default").html("Go!").css("z-index","15");var u=this;this.dismiss.unbind("click").click(function(){u.linkContainer.hide()})}return r(e,[{key:"printLink",value:function(e){this.linkContainer.show(),this.action.html('<i class="fa fa-clipboard"></i>'),this.action.attr("aria-label","Copy to clipboard"),this.input.attr("readonly","readonly"),this.input.val(e),this.qrcode.show()}},{key:"printLaunchLink",value:function(e){return this.printLink(e),this.input.attr("placeholder","A link will appear in this field, give it to your friend!"),this.action.unbind("click"),this.qrcode.hide(),this.action}},{key:"printAnswerLink",value:function(e){return this.printLink(e),this.input.attr("placeholder","A link will appear in this field. Please give it back to your friend."),this.action.unbind("click"),this.qrcode.hide(),this.action}},{key:"askLink",value:function(){this.linkContainer.show(),this.alert.removeClass("alert-warning").addClass("alert-info"),this.action.html("Go!"),this.action.attr("aria-label","Stamp the ticket"),this.input.removeAttr("readonly"),this.input.val(""),this.action.unbind("click"),this.qrcode.hide()}},{key:"askLaunchLink",value:function(){return this.askLink(),this.input.attr("placeholder","Please, copy the ticket of your friend here to stamp it!"),this.qrcode.hide(),this.action}},{key:"askAnswerLink",value:function(){return this.askLink(),this.input.attr("placeholder","Copy the stamped ticket to confirm your arrival in the network"),this.qrcode.hide(),this.action}},{key:"hide",value:function(){this.linkContainer.hide()}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=a(n(86)),i=a(n(85)),s=a(n(84));function a(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t,n,r){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._options=t,this._editorsHolderID=r,this._editorContainerID="container-"+this._options.signalingOptions.room,this.createCRATE(),this._model=n,this._editor=new s.default(n,t.signalingOptions.room,this._editorContainerID),session.config.storageServer&&(this._storageServerState={},this.findremote(!0),this._timerStorageServer=setInterval(function(){return a.findremote()},5e3),this._editor.on("thereAreChanges",function(){2===a._storageServerState&&a.join()}));var c=this._options.signalingOptions.session,u=session.default.getCrateSession(c);u._previous&&(c=u._previous._options.signalingOptions.session),session.default.focusOnSession(c,this._options.signalingOptions.session,this._editor);var l=new o.default(jQuery("#"+this._editorContainerID+" #sharinglink")),f=jQuery("#"+this._editorContainerID+" #shareicon");this._statesHeader=new i.default(n,l,f,this._editorContainerID),jQuery("#"+this._editorContainerID+" #closeDocument").click(function(){var e=session.default.getCrateSession(a._options.signalingOptions.room);session.headSession!==e?(e._previous&&(e._previous._next=e._next),e._next?e._next._previous=e._previous:session.lastSession=e._previous,jQuery("#"+a._editorContainerID).remove(),e.moveToPrevious(),e.close()):console.log("You cannot remove the first document")})}return r(e,[{key:"createCRATE",value:function(){var e=this,t=' \n<div class="col-md-10 editorContainer" id="'+this._editorContainerID+'" >\n \x3c!-- Head --\x3e\n   <div id="head">\n      <div id="firstrow" class="row">\n         <div id="connectionState">\n         </div>\n         <div id="title">\n            '+this._options.name+'\n         </div>\n         <div id="features">\n            <div id="shareicon">\n               <i class="fa fa-link fa-2x ficon2"></i>\n            </div>\n            <div id="saveicon"><i class="fa fa-floppy-o fa-2x ficon2"></i></div>\n            <div id="remotesave" style=" width: 20px;">\n               <i class="fa fa-cloud fa-2x ficon2"></i>\n            </div>\n            <div id="closeDocument" style="\n              float: right;\n             position: relative;\n                ">\n            <i class="fa fa-window-close" aria-hidden="true" ></i>\n            </div>\n         </div>\n      </div>\n      <div id="sharinglink" class="row">\n      </div>\n   </div>\n   \n \x3c!-- Content --\x3e\n   <div id="content" class="content">\n      <div id="users" class="row">\n         <div id="state" style="margin-left: -50px;" ">\n            <i class="fa fa-globe fa-3x ficon "></i>\n         </div>\n      </div>\n      <div id="editorSection">\n         <div id="editor" class="editor">\n         </div>\n         <div id="comments">\n         </div>\n      </div>\n   </div>\n\n\n  <div id="inputCommentModal" class="modal fade" role="dialog" style="display: none;">\n            <div class="modal-dialog">\n        \n                \x3c!-- Modal content--\x3e\n                <div class="modal-content">\n                    <div class="modal-body">\n                    <button type="button" class="close" data-dismiss="modal"></button>\n                    <h4>Comment</h4>\n                    <p><textarea name="commentInput" id="commentInput" style="width: 100%;" rows="5"></textarea></p>\n                    </div>\n                    <div class="modal-footer">\n                    <button type="button" class="btn btn-default" id="saveComment"data-dismiss="modal">Save</button>\n                    </div>\n                </div>\n        \n            </div>\n        </div>\n    ';jQuery("#"+this._editorsHolderID).append(t),jQuery("#"+this._editorContainerID+" #saveComment").click(function(){e.saveComment()}),jQuery("#"+this._editorContainerID+" #remotesave").click(function(){jQuery("#"+e._editorContainerID+" #remotesave").hasClass("PIN")?e.kill():e.join()})}},{key:"saveComment",value:function(){this._editor.saveComment()}},{key:"findremote",value:function(e){var t=this,n=this._options.signalingOptions.room,r=jQuery("#"+this._editorContainerID+" #remotesave");if(session.config.storageServer){var o=session.config.storageServer+"/exist/"+n;fetch(o).then(function(e){return e.json()}).then(function(n){t._storageServerState=n.results,0==n.results?t.unpin(r):1==n.results?t.pin(r,"active"):e?t.join():t.pin(r,"sleep")}).catch(function(e){console.log(e),clearInterval(t._timerStorageServer),t.unpin(r)})}}},{key:"pin",value:function(e,t){"active"===t?e.css("color","green"):e.css("color","gray"),e.removeClass("UNPIN"),e.addClass("PIN")}},{key:"unpin",value:function(e){e.css("color","red"),e.removeClass("PIN"),e.addClass("UNPIN")}},{key:"join",value:function(){var e=this,t=this._options.signalingOptions.room;$.ajax({type:"GET",url:session.config.storageServer+"/join/"+t,success:function(t,n){e.findremote()},error:function(){e.findremote()},async:!0})}},{key:"kill",value:function(){var e=this,t=this._options.signalingOptions.room;1==confirm("Do you want remove document from remote server!")&&$.ajax({type:"GET",url:session.config.storageServer+"/kill/"+t,success:function(n,r){e.findremote(t)},async:!1})}}],[{key:"addMoveShortcuts",value:function(){var e={37:"prev",39:"next"};document.addEventListener&&document.addEventListener("keydown",function(t){var n=e[t.keyCode];if((t.ctrlKey||t.metaKey)&&n){var r=document.createEvent("Event");r.initEvent(n,!0,!1),t.target.dispatchEvent(r),t.preventDefault()}},!1),$(document).on("next",function(){console.log("next"),session.default.actualSession.moveToNext()}),$(document).on("prev",function(){console.log("prev"),session.default.actualSession.moveToPrevious()})}}]),e}();t.default=c,c.addMoveShortcuts()},function(e,t,n){"use strict";var r;function o(e){function n(){if(n.enabled){var e=n,o=+new Date,i=o-(r||o);e.diff=i,e.prev=r,e.curr=o,r=o;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var o=t.formatters[r];if("function"==typeof o){var i=s[c];n=o.call(e,i),s.splice(c,1),c--}return n}),t.formatArgs.call(e,s),(n.log||t.log||console.log.bind(console)).apply(e,s)}}return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),"function"==typeof t.init&&t.init(n),n}(t=e.exports=o.debug=o.default=o).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length,o=0;o<r;o++)n[o]&&("-"===(e=n[o].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(11),t.names=[],t.skips=[],t.formatters={}},function(e,t,n){"use strict";
/*!
 * \brief object that represents the result of an insert operation
 * \param insert the result of the local insert operation
 * \param origin the origin of the insertion
 */
function r(e,t){this.type="MInsertOperation",this.insert=e,this.origin=t}Object.defineProperty(t,"__esModule",{value:!0}),t.MInsertOperation=r,t.MAEInsertOperation=function(e,t){this.type="MAEInsertOperation",this.payload=new r(e,t),this.id={e:t},this.isReady=null},t.MRemoveOperation=
/*!
 * \brief object that represents the result of a delete operation
 * \param remove the result of the local delete operation
 * \param origin the origin of the removal
 */
function(e,t){this.type="MRemoveOperation",this.remove=e,this.origin=t},t.MCaretMovedOperation=
/*!
 * \brief object that represents the result of a caretMoved Operation
 * \param range the selection range
 * \param origin the origin of the selection
 */
function(e,t){this.type="MCaretMovedOperation",this.range=e,this.origin=t},t.MBroadcast=
/*!
 * \brief message containing data to broadcast
 * \param name the name of the protocol, default 'causal'
 * \param id the identifier of the broadcast message
 * \param isReady the identifier(s) that must exist to deliver this message
 * \param payload the broadcasted data
 */
function(e,t,n,r){this.protocol=e,this.id=t,this.isReady=n,this.payload=r},t.MAntiEntropyRequest=
/*!
 * \brief message that request an AntiEntropy 
 * \param causality the causality structure
 */
function(e){this.type="MAntiEntropyRequest",this.causality=e},t.MAntiEntropyResponse=
/*!
 * \brief message responding to the AntiEntropy request
 * \param id the identifier of the response message
 * \param causality the causality structure
 * \param nbElements the number of element to send
 * \param element each element to send 
 */
function(e,t,n,r){this.type="MAntiEntropyResponse",this.id=e,this.causality=t,this.nbElements=n,this.element=r,this.elements=[]}},function(e,t,n){"use strict";e.exports=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.index=t,this.size=n}},function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=91},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(34),i=n(33),s=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._base=t,this._boundary=n}return r(e,[{key:"bPlus",value:function(e,t,n,r,i,s){for(var a=e,c=t,u=Math.min(this._boundary,r),l=o.int2bigInt(0,this._base.getSumBit(n)),f=void 0,h=0;h<=n;++h)f=e&&e.t.p||0,o.addInt_(l,f),h!==n&&o.leftShift_(l,this._base.getBitBase(h+1)),e=e&&!e.isLeaf&&e.child||null;return o.addInt_(l,Math.floor(Math.random()*u+1)),this._getSC(l,a,c,n,i,s)}},{key:"bMinus",value:function(e,t,n,r,i,s){for(var a=e,c=t,u=Math.min(this._boundary,r),l=o.int2bigInt(0,this._base.getSumBit(n)),f=!1,h=!0,p=void 0,d=void 0,y=0;y<=n;++y)p=e&&e.t.p||0,d=t&&t.t.p||0,h&&p!==d&&(h=!1,f=p>d),f&&(d=Math.pow(2,this._base.getBitBase(y))-1),o.addInt_(l,d),y!==n&&o.leftShift_(l,this._base.getBitBase(y+1)),t=t&&!t.isLeaf&&t.child||null,e=e&&!e.isLeaf&&e.child||null;return f?o.addInt_(l,-Math.floor(Math.random()*u)):o.addInt_(l,-Math.floor(Math.random()*u)-1),this._getSC(l,a,c,n,i,s)}},{key:"_getSC",value:function(e,t,n,r,s,a){for(var c=[],u=[],l=0,f=this._base.getSumBit(r),h=void 0,p=void 0;l<=r;)h=o.dup(e),o.rightShift_(h,f-this._base.getSumBit(l)),p=o.modInt(h,Math.pow(2,this._base.getBitBase(l))),c[l]=s,u[l]=a,n&&n.t.p===p&&(c[l]=n.t.s,u[l]=n.t.c),t&&t.t.p===p&&(c[l]=t.t.s,u[l]=t.t.c),n=n&&!n.isLeaf&&n.child||null,t=t&&!t.isLeaf&&t.child||null,++l;return new i(this._base,e,c,u)}}]),e}();e.exports=s},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._b=t}return r(e,[{key:"getBitBase",value:function(e){return this._b+e}},{key:"getSumBit",value:function(e){var t=this.getBitBase(e),n=this._b-1;return t*(t+1)/2-n*(n+1)/2}},{key:"getInterval",value:function(e,t,n){for(var r=0,o=0,i=!1,s=!0,a=0,c=0;o<=e;)a=t&&t.t.p||0,c=n&&n.t.p||0,s&&a!==c&&(s=!1,i=a>c),i&&(c=Math.pow(2,this.getBitBase(o))-1),r+=s||i||o!==e?c-a:c-a-1,o!==e&&(r*=Math.pow(2,this.getBitBase(o+1))),t=t&&t.child||null,n=n&&n.child||null,++o;return r}}]),e}();e.exports=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(1),i=n(93),s=n(92),a=n(33),c=n(21),u=n(32),l=n(90),f=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);this.options=o({boundary:10,base:15},n),this._s=t,this._c=0,this._hash=function(e){return e%2},this._base=new i(this.options.base),this._strategy=new s(this._base,this.options.boundary),this.root=new u,this.root.add(new u([new c(0,0,0)],"")),this.root.add(new u([new c(Math.pow(2,this._base.getBitBase(0))-1,Number.MAX_VALUE,Number.MAX_VALUE)],""))}return r(e,[{key:"get",value:function(e){if(e<0||e>=this.length)throw new l(e,this.length);for(var t=this.root.get(e+1);!t.isLeaf;)t=t.child;return t.e}},{key:"_get",value:function(e){if(e<0||e>=this.length+2)throw new l(e,this.length+2);return this.root.get(e)}},{key:"insert",value:function(e,t){var n=this._get(t),r=this._get(t+1);this._c+=1;var o={elem:e,id:this.alloc(n,r)};return this.applyInsert(o),o}},{key:"remove",value:function(e){var t=this._get(e+1),n=new a(this._base).fromNode(t);return this.applyRemove(t),n}},{key:"alloc",value:function(e,t){for(var n=0,r=0;n<=0;)n=this._base.getInterval(r,e,t),++r;return r-=1,0===this._hash(r)?this._strategy.bPlus(e,t,r,n,this._s,this._c):this._strategy.bMinus(e,t,r,n,this._s,this._c)}},{key:"applyInsert",value:function(e){var t,n,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=void 0;return o=(n=e.id)&&n._d&&n._s&&n._c&&new a(this._base,n._d,n._s,n._c).toNode(e.elem),o=n&&n.t&&n.children&&u.fromJSON(n)||o,t=this.root.add(o),r?t:t?this.root.indexOf(o):-1}},{key:"applyRemove",value:function(e){var t,n=void 0;return n=e&&e._d&&e._s&&e._c&&new a(this._base,e._d,e._s,e._c).toNode(null),n=e&&e.t&&e.children&&u.fromJSON(e)||n,-1!==(t=this.root.indexOf(n))&&this.root.del(n),t}},{key:"fromJSON",value:function(e){var t=this;this._s=e._s,this._c=e._c,this.options=e.options,this._base=new i(this.options.base),this._boundary=new s(this._base,this.options.boundary);for(var n=function e(n,r){var o=new c(n.t.p,n.t.s,n.t.c);r.push(o),null!==n.e&&t.root.add(new u(r.slice(),n.e));for(var i=0;i<n.children.length;++i)e(n.children[i],r);r.pop()},r=0;r<e.root.children.length;++r)n(e.root.children[r],[]);return this}},{key:"length",get:function(){var e=this.root.subCounter-2;return e=this.root._hasElement&&e+1||e}}]),e}();e.exports=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2),i=c(n(62)),s=c(n(94)),a=(n(29),n(89));function c(e){return e&&e.__esModule?e:{default:e}}var u=n(31)("crate:crate-core"),l=function(e){function t(e,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.options=n,a.setLastChangesTime(),a._timer=setInterval(function(){return a.checkIfOutdated()},1e3),a._changesTimeOut=n.changesTimeOut||1e4,a._communication=r,a.No_antientropy=o,a.broadcast=a._communication.broadcast,a.No_antientropy.onBroadcast(function(e,t){switch(t.type){case"MCaretMovedOperation":a.remoteCaretMoved(t.range,t.origin);break;case"Mping":a.ping(t.origin,t.pseudo)}}),a._lastSentId=null,a._communication.onBroadcast(function(e,t){switch(t.type){case"MRemoveOperation":a.remoteRemove(t.remove,t.origin);break;case"MInsertOperation":a.remoteInsert(t.insert,t.origin);break;case"MTitleChanged":a.changeTitle(t.title)}}),a._communication.broadcast.startAntiEntropy(2e3),a._communication.broadcast.on("antiEntropy",function(e,t,n){t=new i.default(null).constructor.fromJSON(t);for(var r=[],o=0;o<n.vector.arr.length;++o){var s=n.vector.arr[o],c=t.vector.indexOf(n.vector.arr[o]),l=1;c>=0&&(l=t.vector.arr[c].v+1);for(var f=l;f<=s.v;++f)s.x.indexOf(f)<0&&r.push({_e:s.e,_c:f});if(c>=0)for(f=0;f<t.vector.arr[c].x.length;++f){var h=t.vector.arr[c].x[f];s.x.indexOf(h)<0&&h<=s.v&&r.push({_e:s.e,_c:h})}}var p=a.getElements(r);0!=p.length&&(u("Receive AntiEntropy And there are differences",e,t,n,p),a._communication.broadcast.sendAntiEntropyResponse(e,n,p),a.emit("sendChangeTitle"))}),a.id=e,a.sequence=new s.default(a.options.editingSessionID),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.EventEmitter),r(t,[{key:"checkIfOutdated",value:function(){var e=(new Date).getTime();this._lastChanges;return e-this._lastChanges>=this._changesTimeOut&&(clearInterval(this._timer),this.emit("outdated"),!0)}
/*!
         * \brief create the core from an existing object
         * \param object the object to initialize the core model of crate containing a 
         * sequence and causality tracking metadata
         */},{key:"init",value:function(e){this.broadcast._causality=this.broadcast._causality.constructor.fromJSON(e.causality);var t=this.broadcast._causality.local;this.No_antientropy.broadcast._causality.local.e=t.e,this.sequence.fromJSON(e.sequence),this.sequence._s=t.e,this.sequence._c=t.v}},{key:"insert",
/*!
         * \brief local insertion of a character inside the sequence structure. It
         * broadcasts the operation to the rest of the network.
         * \param character the character to insert in the sequence
         * \param index the index in the sequence to insert
         * \return the identifier freshly allocated
         */
value:function(e,t){var n=this.sequence.insert(e,t),r=new a.MInsertOperation(n,this.id);try{JSON.parse(JSON.stringify(r))}catch(e){console.error("The object cannot be convert to json ",e,r)}return this._lastSentId=this._communication.sendBroadcast(new a.MInsertOperation(n,this.id),null,this._lastSentId),this.setLastChangesTime(),n}},{key:"remove",
/*!
         * \brief local deletion of a character from the sequence structure. It 
         * broadcasts the operation to the rest of the network.
         * \param index the index of the element to remove
         * \return the identifier freshly removed
         */
value:function(e){var t=this.sequence.remove(e);return this.sequence._c+=1,this._communication.sendBroadcast(new a.MRemoveOperation(t,this.id)),this.setLastChangesTime(),t}},{key:"remoteInsert",
/*!
         * \brief insertion of an element from a remote site. It emits 'remoteInsert' 
         * with the index of the element to insert, -1 if already existing.
         * \param ei the result of the remote insert operation
         * \param origin the origin id of the insert operation
         */
value:function(e,t){var n=this.sequence.applyInsert(e,!1);u("remoteInsert",e," sequence Index ",n),n>=0&&t&&(this.emit("remoteInsert",e.elem,n),this.setLastChangesTime(),e.antientropy||this.emit("remoteCaretMoved",{index:n,length:0},t))}},{key:"remoteRemove",
/*!
         * \brief removal of an element from a remote site.  It emits 'remoteRemove'
         * with the index of the element to remove, -1 if does not exist
         * \param id the result of the remote insert operation
         * \param origin the origin id of the removal
         */
value:function(e,t){var n=this.sequence.applyRemove(e);this.emit("remoteRemove",n),n>=0&&t&&this.emit("remoteCaretMoved",{index:n-1,length:0},t),this.setLastChangesTime()}},{key:"setLastChangesTime",value:function(){var e=(new Date).getTime();this._lastChanges=e}},{key:"remoteCaretMoved",value:function(e,t){this.emit("remoteCaretMoved",e,t)}},{key:"caretMoved",value:function(e){return this.No_antientropy.sendBroadcast(new a.MCaretMovedOperation(e,this.id)),e}},{key:"ping",value:function(e,t){this.emit("ping",e,t)}},{key:"sendPing",value:function(e){return this.No_antientropy.sendBroadcast({type:"Mping",origin:this.id,pseudo:"Anonymous"}),origin}},{key:"changeTitle",value:function(e){this.emit("changeTitle",e)}},{key:"sendChangeTitle",value:function(e){console.log("sendChangeTitle core title ",e),this._communication.sendBroadcast({type:"MTitleChanged",title:e})}},{key:"getElements",
/*!
         * \brief search a set of elements in our sequence and return them
         * \param toSearch the array of elements {_e, _c} to search
         * \returns an array of nodes
         */
value:function(e){for(var t,n,r,o=[],i=this.sequence.length,s=0;e.length>0&&i<=this.sequence.length&&i>0;){for(r=n=this.sequence._get(i);r.children.length>0;)r=r.children[0];for(s=0,t=!1;s<e.length&&!t;)r.t.s===e[s]._e&&r.t.c===e[s]._c?(t=!0,o.push(new a.MAEInsertOperation({elem:r.e,id:n,antientropy:!0},r.t.s.split("-")[0])),e.splice(s,1)):++s;--i}return o.reverse()}}]),t}();
/*!
 * \brief link together all components of the model of the CRATE editor
 * \param id the unique site identifier
 * \param options the webrtc specific options 
 */t.default=l},function(e,t,n){"use strict";(function(t){var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(2),s=n(1),a=n(5),c=n(3)("spa"),u=function(){return{id:a(),initiator:!1,channelConfig:{},channelName:a(),config:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},constraints:{},offerConstraints:{},answerConstraints:{},reconnectTimer:!1,sdpTransform:function(e){return e},stream:!1,streams:[],trickle:!0,wrtc:{},objectMode:!1}},l=new(function(){function e(){o(this,e),this._statistics={message:0},this.manager=new Map,this._options={latency:function(e){setTimeout(e,0)}},c("manager initialized")}return r(e,[{key:"newPeer",value:function(e){c("new peer added. Size:",this.manager.size),this.manager.set(e.id,e)}},{key:"connect",value:function(e,t){c("peer connected from/to: ",e,t),this.manager.get(t)._connectWith(e),this.manager.get(e)._connectWith(t)}},{key:"destroy",value:function(e,t){c("peer disconnected from/to: ",e,t),this.manager.get(e)&&(this.manager.get(e)._close(),this.manager.delete(e)),this.manager.get(t)&&(this.manager.get(t)._close(),this.manager.delete(t))}},{key:"send",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._send(e,t,n,r)}},{key:"_send",value:function(e,t,n){arguments.length>3&&void 0!==arguments[3]&&arguments[3];try{if(!this.manager.has(e)||!this.manager.has(t))throw new Error("need a from and to peer.");this.manager.get(t).emit("data",n),this._statistics.message++}catch(e){throw new Error("cannot send the message. perhaps your destination is not reachable.",e)}}},{key:"stats",get:function(){return this._statistics}}]),e}());e.exports=function(e){function n(e){o(this,n);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r._manager=l,r._options=s(u(),e),r.id=r._options.id,r.WEBRTC_SUPPORT=!0,r._isNegotiating=!1,r.connected=!1,r.disconnected=!1,r.connectedWith=void 0,r.messageBuffer=[],c("peer initiated:",r.id,r._options.initiator),r._options.initiator&&t.nextTick(function(){r._init()}),r._manager.newPeer(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,i),r(n,[{key:"send",value:function(e){this.connectedWith?(this.messageBuffer.length>0&&this._reviewMessageBuffer(),this.connectedWith?this._send(this.connectedWith,e):this.messageBuffer.push(e)):this.messageBuffer.push(e)}},{key:"destroy",value:function(){this._manager.destroy(this.id,this.connectedWith)}},{key:"signal",value:function(e){"init"===e.type?(this._isNegotiating=!0,c("offer-init received:",e),this.emit("signal",this._createAccept(e))):"accept"===e.type&&(c("offer-accept received:",e),this._connect(e))}},{key:"_error",value:function(e){c(e),this.emit("error",e)}},{key:"_close",value:function(){c("[%s] is closed.",this.id),this.emit("close")}},{key:"_init",value:function(){this._isNegotiating=!0;var e=this._createOffer();this.emit("signal",e)}},{key:"_createOffer",value:function(){return{offerId:a(),type:"init",offer:{initiator:this.id}}}},{key:"_createAccept",value:function(e){var t=this._createOffer();return t.type="accept",t.offerId=e.offerId,t.offer.initiator=e.offer.initiator,t.offer.acceptor=this.id,t}},{key:"_reviewMessageBuffer",value:function(){for(c("Review the buffer: ",this.messageBuffer.length);this.connectedWith&&0!==this.messageBuffer.length;)this._send(this.messageBuffer.pop())}},{key:"_send",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.connectedWith,t=arguments[1];if(!e)throw new Error("It must have a destination.");this._manager.send(this.id,e,t)}},{key:"_connect",value:function(e){if(!e.offer.acceptor)throw new Error("It must have an acceptor");this._manager.connect(e.offer.initiator,e.offer.acceptor)}},{key:"_connectWith",value:function(e){this.connected=!0,this._isNegotiating=!1,this.connectedWith=e,this.emit("connect")}}],[{key:"manager",get:function(){return l}}]),n}()}).call(this,n(4))},function(e,t,n){"use strict";e.exports=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.source=t,this.message=n}},function(e,t,n){"use strict";e.exports=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.source=t,this.message=n,this.reason=r}},function(e,t,n){"use strict";e.exports=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type="MRequestDescriptor"}},function(e,t,n){"use strict";e.exports=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.peer=t,this.descriptor=n,this.type="MGiveDescriptor"}},function(e,t,n){"use strict";e.exports=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.peers=t,this.type="MRequire"}},function(e,t,n){"use strict";e.exports=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sample=t,this.type="MSuggestBack"}},function(e,t,n){"use strict";e.exports=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.peer=t,this.descriptor=n,this.sample=r,this.type="MSuggest"}},function(e,t,n){"use strict";e.exports=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.peer=t,this.descriptor=n,this.type="MJoin"}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}var i=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.timeout=e,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o(Map)),r(t,[{key:"add",value:function(e,t){var n=this;this.set(e,t),setTimeout(function(){n.has(e)&&n.delete(e)},this.timeout)}}]),t}();e.exports=i},function(e,t,n){"use strict";e.exports=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.source=t,this.peer=n}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.peer=t,this.ages=[0],this.descriptor=n}return r(e,[{key:"update",value:function(e){this.descriptor=e}},{key:"increment",value:function(){this.ages=this.ages.map(function(e){return e+1})}},{key:"add",value:function(){this.ages.unshift(0)}},{key:"removeOldest",value:function(){return this.ages.pop(),0===this.ages.length}},{key:"removeYoungest",value:function(){return this.ages.shift(),0===this.ages.length}},{key:"oldest",get:function(){return this.ages[this.ages.length-1]}},{key:"count",get:function(){return this.ages.length}}]),e}();e.exports=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}var i=n(107),s=n(106),a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o(Map)),r(t,[{key:"increment",value:function(){this.forEach(function(e,t){e.increment()})}},{key:"addNeighbor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.has(e)?this.get(e).add():this.set(e,new i(e,t))}},{key:"updateNeighbor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.has(e))throw new s("updateNeighbor",e);this.get(e).update(t)}},{key:"removeOldest",value:function(e){if(!this.has(e))throw new s("removeNeighbor",e);this.get(e).removeOldest()&&this.delete(e)}},{key:"removeAllNeighbor",value:function(e){if(this.has(e)){var t=this.get(e).count;return this.delete(e),t}throw new s("removeNeighbor",e)}},{key:"getDescriptor",value:function(e){if(this.has(e))return this.get(e).descriptor;throw new s("getDescriptor",e)}},{key:"oldest",get:function(){if(this.size<=0)throw new s("getOldest");var e=null,t=0;return this.forEach(function(n,r){t<=n.oldest&&(e=n.peer,t=n.oldest)}),e}},{key:"leastFrequent",get:function(){if(this.size<=0)throw new s("getLeastFrequent");var e=[],t=1/0;return this.forEach(function(n,r){n.count<t&&(e=[],t=n.count),n.count===t&&e.push(r)}),e[Math.floor(Math.random()*e.length)]}}]),t}();e.exports=a},function(e,t,n){"use strict";(function(e,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=9007199254740991,i="[object Arguments]",s="[object Function]",a="[object GeneratorFunction]",c="[object Map]",u="[object Set]",l=/^\[object .+?Constructor\]$/,f="object"==(void 0===e?"undefined":r(e))&&e&&e.Object===Object&&e,h="object"==("undefined"==typeof self?"undefined":r(self))&&self&&self.Object===Object&&self,p=f||h||Function("return this")(),d="object"==r(t)&&t&&!t.nodeType&&t,y=d&&"object"==r(n)&&n&&!n.nodeType&&n,g=y&&y.exports===d;var v,m,b,_=Function.prototype,w=Object.prototype,C=p["__core-js_shared__"],k=(v=/[^.]+$/.exec(C&&C.keys&&C.keys.IE_PROTO||""))?"Symbol(src)_1."+v:"",E=_.toString,S=w.hasOwnProperty,O=w.toString,x=RegExp("^"+E.call(S).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),A=g?p.Buffer:void 0,T=w.propertyIsEnumerable,j=A?A.isBuffer:void 0,P=(m=Object.keys,b=Object,function(e){return m(b(e))}),R=W(p,"DataView"),M=W(p,"Map"),I=W(p,"Promise"),F=W(p,"Set"),N=W(p,"WeakMap"),D=!T.call({valueOf:1},"valueOf"),B=H(R),L=H(M),U=H(I),q=H(F),z=H(N);function V(e){return!(!Z(e)||k&&k in e)&&(G(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?x:l).test(H(e))}function W(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return V(n)?n:void 0}var J=function(e){return O.call(e)};function H(e){if(null!=e){try{return E.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function $(e){return function(e){return function(e){return!!e&&"object"==(void 0===e?"undefined":r(e))}(e)&&Q(e)}(e)&&S.call(e,"callee")&&(!T.call(e,"callee")||O.call(e)==i)}(R&&"[object DataView]"!=J(new R(new ArrayBuffer(1)))||M&&J(new M)!=c||I&&"[object Promise]"!=J(I.resolve())||F&&J(new F)!=u||N&&"[object WeakMap]"!=J(new N))&&(J=function(e){var t=O.call(e),n="[object Object]"==t?e.constructor:void 0,r=n?H(n):void 0;if(r)switch(r){case B:return"[object DataView]";case L:return c;case U:return"[object Promise]";case q:return u;case z:return"[object WeakMap]"}return t});var Y=Array.isArray;function Q(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=o}(e.length)&&!G(e)}var X=j||function(){return!1};function G(e){var t=Z(e)?O.call(e):"";return t==s||t==a}function Z(e){var t=void 0===e?"undefined":r(e);return!!e&&("object"==t||"function"==t)}n.exports=function(e){if(Q(e)&&(Y(e)||"string"==typeof e||"function"==typeof e.splice||X(e)||$(e)))return!e.length;var t=J(e);if(t==c||t==u)return!e.size;if(D||function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||w)}(e))return!P(e).length;for(var n in e)if(S.call(e,n))return!1;return!0}}).call(this,n(0),n(15)(e))},function(e,t,n){"use strict";e.exports=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pid=t,this.event=n,this.args=r,this.type="MUnicast"}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=1e3,i=60*o,s=60*i,a=24*s,c=365.25*a;function u(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var n,l=void 0===e?"undefined":r(e);if("string"===l&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*c;case"days":case"day":case"d":return n*a;case"hours":case"hour":case"hrs":case"hr":case"h":return n*s;case"minutes":case"minute":case"mins":case"min":case"m":return n*i;case"seconds":case"second":case"secs":case"sec":case"s":return n*o;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===l&&!1===isNaN(e))return t.long?u(n=e,a,"day")||u(n,s,"hour")||u(n,i,"minute")||u(n,o,"second")||n+" ms":function(e){if(e>=a)return Math.round(e/a)+"d";if(e>=s)return Math.round(e/s)+"h";if(e>=i)return Math.round(e/i)+"m";if(e>=o)return Math.round(e/o)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){"use strict";var r;function o(e){function n(){if(n.enabled){var e=n,o=+new Date,i=o-(r||o);e.diff=i,e.prev=r,e.curr=o,r=o;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var o=t.formatters[r];if("function"==typeof o){var i=s[c];n=o.call(e,i),s.splice(c,1),c--}return n}),t.formatArgs.call(e,s),(n.log||t.log||console.log.bind(console)).apply(e,s)}}return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),"function"==typeof t.init&&t.init(n),n}(t=e.exports=o.debug=o.default=o).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length,o=0;o<r;o++)n[o]&&("-"===(e=n[o].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(111),t.names=[],t.skips=[],t.formatters={}},function(e,t,n){"use strict";(function(r){var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(112)).log=function(){return"object"===("undefined"==typeof console?"undefined":o(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++o)}),e.splice(i,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,n(4))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(113)("unicast-definition"),i=n(2),s=n(1),a=n(110),c=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.options=s({retry:0,pid:"default-unicast"},n),r.psp=e;var i=e._receive;return e._receive=function(t,n){try{i.call(e,t,n)}catch(e){if(!n.type||"MUnicast"!==n.type||n.pid!==r.options.pid)throw e;r._emit.apply(r,[n.event].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(n.args)))}},r._emit=r.emit,r.emit=function(t,n){for(var o=arguments.length,i=Array(o>2?o-2:0),s=2;s<o;s++)i[s-2]=arguments[s];return e.send(n,new a(r.options.pid,t,i),r.options.retry)},o("just initialized on top of %s@%s.",r.psp.PID,r.psp.PEER),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"destroy",value:function(){this.removeAllListener(),this.emit=this._emit}}]),t}();e.exports=c},function(e,t,n){"use strict";function r(e){var n;function r(){if(r.enabled){var e=r,o=+new Date,i=o-(n||o);e.diff=i,e.prev=n,e.curr=o,n=o;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var o=t.formatters[r];if("function"==typeof o){var i=s[c];n=o.call(e,i),s.splice(c,1),c--}return n}),t.formatArgs.call(e,s),(r.log||t.log||console.log.bind(console)).apply(e,s)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),r.destroy=o,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function o(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var i=t.instances[n];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(11),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t,n){"use strict";(function(r){var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(115)).log=function(){return"object"===("undefined"==typeof console?"undefined":o(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++o)}),e.splice(i,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,n(4))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(116)("tman-wrtc"),i=n(22),s=n(114),a=n(1),c=n(109),u=n(108),l=n(105),f=n(104),h=n(103),p=n(102),d=n(101),y=n(100),g=n(99),v=n(98),m=n(97),b=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,a({pid:"tman-wrtc",delta:6e4,timeout:12e4,descriptorTimeout:1e4,retry:5,inview:n&&n.NI,outview:n&&n.NO,descriptor:{x:Math.random()},ranking:function(e){return function(t,n){var r=n.descriptor.x-e.descriptor.x,o=t.descriptor.x-e.descriptor.x;return Math.abs(o)-Math.abs(r)}}},e)));return o("[%s] Initalized with ==> %s ==>",r.PID,r.PEER),r.partialView=new u,r.cache=new l(r.options.timeout),r.state="disconnected",r.periodic=null,r.on("receive",function(e,t){return r._receive(e,t)}),r.on("open",function(e){r._open(e),r._updateState()}),r.on("close",function(e){r._close(e),r._updateState()}),r.on("fail",function(e){r._onArcDown(e),r._updateState()}),r.parent=n||null,r.parent&&(r.unicast=new s(r.parent,{pid:"tman-wrtc-unicast",retry:r.options.retry}),r.parent.on("open",function(e){return!r.cache.has(e)&&r.unicast.emit("requestDescriptor",e,r.getOutviewId()).catch(function(e){console.error(e)})}),r.unicast.on("requestDescriptor",function(e){return r.unicast.emit("giveDescriptor",e,r.getInviewId(),r.options.descriptor).catch(function(e){console.error(e)})}),r.unicast.on("giveDescriptor",function(e,t){r.cache.has(e)||(o("[%s] get %s's descriptor from %s.",r.PID,e,r.parent.PID),r.cache.add(e,t))})),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"join",value:function(e){var t=this;this.parent&&this.parent.join(e);var n=new Promise(function(e,n){"disconnected"!==t.state&&n(new m("join","Already connected."));var r=setTimeout(function(){n(new m("join","Timeout exceeded."))},t.options.timeout);t.once("open",function(o){t.send(o,new f(t.getInviewId(),t.options.descriptor),t.options.retry).then(function(){clearTimeout(r),t._start(),e(o)}).catch(function(){n(new m("join","Could not notify contact."))})})});return this.connect(e),n}},{key:"_onJoin",value:function(e,t){if(this.partialView.size>0){o("[%s] %s ===> join %s; %s neigbhors ===> %s",this.PID,e,this.PEER,this.partialView.size,e);var n=[];this.partialView.forEach(function(e){n.push({peer:e.peer,descriptor:e.descriptor})}),n.push({peer:this.getInviewId(),descriptor:this.options.descriptor}),this.send(e,new p(n),this.options.retry).catch(function(e){console.error(e)})}else o("[%s] %s ===> join %s ===> %s",this.PID,e,this.PEER,e),this.cache.add(t.peer,t.descriptor),this.connect(null,e),this.send(e,new p([{peer:this.getInviewId(),descriptor:this.options.descriptor}]),this.options.retry).catch(function(e){console.error(e)}),this._start()}},{key:"_onArcDown",value:function(e){}},{key:"_onPeerDown",value:function(e){this.partialView.removeAllNeighbor(e)}},{key:"_sampleSize",value:function(e){return Math.min(e.length,2)}},{key:"_partialViewSize",value:function(){return 4}},{key:"_getSample",value:function(e){var t=this,n=[];this.partialView.forEach(function(e,t){e.ages.forEach(function(r){!c(e.descriptor)&&n.push(t)})}),this.parent&&this.parent.partialView.forEach(function(e,r){t.cache.has(r)&&n.indexOf(r)<0&&n.push(r)}),n=n.map(function(n){var r={descriptor:t.options.descriptor};return n===e.peer?r.peer=t.getInviewId():(r.descriptor=t.cache.has(n)&&t.cache.get(n)||t.partialView.getDescriptor(n),r.peer=n),r});var r=this._sampleSize(n);return n.sort(this.options.ranking(e)),n.slice(0,r)}},{key:"_exchange",value:function(){var e=this;if(!(this.partialView.size<=0&&this.parent&&this.parent.partialView.size<=0)){this.partialView.increment();var t=void 0,n=void 0,r=!0;if(this.partialView.size>0)t=this.partialView.oldest,n=this._getSample(this.partialView.get(t));else if(this.parent&&this.parent.partialView.size>0){var i=this.parent.getPeers(),s=!1;for(r=!1;!s&&i.length>0;){var a=Math.floor(Math.random()*i.length);this.cache.has(i[a])?(s=!0,t=i[a],n=this._getSample({peer:t,descriptor:this.cache.get(t)})):i.splice(a,1)}}t&&this.send(t,new h(this.getInviewId(),this.options.descriptor,n)).then(function(){o("[%s] %s ==> suggest %s ==> %s",e.PID,e.PEER,n.length,t)}).catch(function(n){o("[%s] %s =X> suggest =X> %s",e.PID,e.PEER,t),r&&e._onPeerDown(t)})}}},{key:"_onExchange",value:function(e,t){var n=this,r=this._getSample(t);this.send(e,new p(r),this.options.retry).then(function(){o("[%s] %s ==> suggest back %s ==> %s",n.PID,n.PEER,r.length,e)}).catch(function(e){}),this._onExchangeBack(e,t)}},{key:"_onExchangeBack",value:function(e,t){var n=this,r=[];this.partialView.forEach(function(e,t){return r.push(e)}),t.sample.forEach(function(e){return r.indexOf(e)<0&&r.push(e)}),r.sort(this.options.ranking(this.options));var i=[];r.slice(0,this._partialViewSize()).forEach(function(e){n.partialView.has(e.peer)||(i.push(e.peer),n.cache.add(e.peer,e.descriptor))}),i.length>0&&(o("[%s] %s wants to keep %s peers.",this.PID,this.PEER,i.length),this.send(e,new d(i),this.options.retry).catch(function(t){o("[%s] %s =X> request descriptors %s =X> %s",n.PID,n.PEER,i.length,e)}));var s=r.slice(this._partialViewSize(),r.length);s.length>0&&this.partialView.size>this._partialViewSize()&&s.forEach(function(e){n.partialView.has(e.peer)&&n.disconnect(e.peer)})}},{key:"_onRequire",value:function(e,t){var n=this;o("[%s] %s requested to be bridged with %s peers",this.PID,e,t.peers.length),t.peers.forEach(function(t){n.connect(e,t)})}},{key:"_receive",value:function(e,t){if(t.type&&"MSuggest"===t.type)this._onExchange(e,t);else if(t.type&&"MSuggestBack"===t.type)this._onExchangeBack(e,t);else if(t.type&&"MRequire"===t.type)this._onRequire(e,t);else if(t.type&&"MJoin"===t.type)this._onJoin(e,t);else if(t.type&&"MGiveDescriptor"===t.type)this.emit(this.PID+"-"+e,t);else{if(!t.type||"MRequestDescriptor"!==t.type)throw new v("_receive",t,"unhandled");this._onRequestDescriptor(e,t)}}},{key:"_start",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.delta;this.periodic=setInterval(function(){return e._exchange()},t)}},{key:"_stop",value:function(){this.periodic&&clearInterval(this.periodic)}},{key:"_requestDescriptor",value:function(e){var t=this;return new Promise(function(n,r){var o=null;t.send(e,new g,t.options.retry).then(function(){o=setTimeout(function(){t.removeAllListeners(t.PID+"-"+e),r(new Error("timeout"))},t.options.descriptorTimeout)}).catch(function(e){r(e)}),t.once(t.PID+"-"+e,function(e){clearTimeout(o),t.cache.add(e.peer,e.descriptor),n()})})}},{key:"_onRequestDescriptor",value:function(e,t){var n=this;this.send(e,new y(this.getInviewId(),this.options.descriptor),this.options.retry).catch(function(t){return o("[%s] %s =X> give descriptor =X> %s",n.PID,n.PEER,e)})}},{key:"_open",value:function(e){var t=this;o("[%s] %s ===> %s",this.PID,this.PEER,e),this.partialView.has(e)?this.disconnect(e):this.cache.has(e)?this._keep(e):this._requestDescriptor(e).then(function(){t.partialView.has(e)?t.disconnect(e):t._keep(e)}).catch(function(n){t.disconnect(e)})}},{key:"_keep",value:function(e){var t=this,n=[];this.partialView.forEach(function(e,t){return n.push(e)}),n.push({peer:e,descriptor:this.cache.get(e)}),n.sort(this.options.ranking(this.options));n.slice(0,this._partialViewSize());n.splice(0,this._partialViewSize()),(0===n.length||n.indexOf(e)<0)&&this.partialView.addNeighbor(e,this.cache.get(e)),n.forEach(function(e){return t.disconnect(e.peer)})}},{key:"_close",value:function(e){o("[%s] %s ==> %s",this.PID,this.PEER,e),this.partialView.has(e)&&this.partialView.removeOldest(e)}},{key:"_updateState",value:function(){var e=this.state;this.i.size>0&&this.o.size>0&&"connected"!==e?this.state="connected":this.i.size>0&&this.o.size<=0||this.o.size>0&&this.i.size<=0&&"partially connected"!==e?this.state="partially connected":this.i.size<=0&&this.o.size<=0&&"disconnected"!==e&&(this.state="disconnected"),e!==this.state&&this.emit("statechange",this.state)}},{key:"getPeers",value:function(e){var t=[];if(void 0===e)this.partialView.forEach(function(e,n){return t.push(n)});else{var n=[];for(this.partialView.forEach(function(e,t){return n.push(t)});t.length<e&&n.length>0;){var r=Math.floor(Math.random()*n.length);t.push(n[r]),n.splice(r,1)}var i=[];for(this.i.forEach(function(e,t){return i.push(t)});t.length<e&&i.length>0;){var s=Math.floor(Math.random()*i.length);t.push(i[s]),i.splice(s,1)}}return o("[%s] %s provides %s peers",this.PID,this.PEER,t.length),t}}]),t}();e.exports=b},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(12),i=n(117),s=n(1),a=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n.manager=e;var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));return r._manager=e,r._rps.parent.once("open",function(){console.log("SON connected"),r._rps._start()}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"_buildRPS",value:function(e){this.options=s({config:e.webrtc},e);var t=s({descriptor:this._startDescriptor(),descriptorTimeout:this._descriptorTimeout(),ranking:this._rankingFunction()},this.options);return new i(t,e.manager._rps._network._rps)}},{key:"_startDescriptor",value:function(){throw new Error("A valid TMan based overlay must implement a _descriptor method to generate a base descriptor")}},{key:"_descriptorTimeout",value:function(){throw new Error("A valid TMan based overlay must implement a _descriptorTimeout method to give the timeout on descriptors")}},{key:"_rankPeers",value:function(e,t,n,r,o){throw new Error("A valid TMan based overlay must implement a _rankPeers method to rank two peersvariable: "+e.toString()+t.toString()+n.toString()+r.toString()+o.toString())}},{key:"_rankingFunction",value:function(){var e=this;return function(t){return function(n,r){return e._rankPeers(t,n.descriptor,r.descriptor,n,r)}}}},{key:"getNeighbours",value:function(e){return this.rps.getPeers(e)}},{key:"inviewId",get:function(){return this.rps.getInviewId()}},{key:"outviewId",get:function(){return this.rps.getOutviewId()}},{key:"descriptor",get:function(){return this._rps.options.descriptor},set:function(e){this._rps.options.descriptor=e}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=n(12),o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(!e.manager)throw new SyntaxError("Need the manager to access to other networks.");return n.manager=e.manager,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();e.exports=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._callback=t}return r(e,[{key:"apply",value:function(e){e.prototype._init=this._callback}}]),e}();e.exports=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(35),i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"buildService",value:function(e){var t=this.methodName,n=this.beforeSendName,r=this.afterSendName;e.prototype[t]=function(e){n in this&&(e=this[n](e));var o={protocol:this._name,method:t,payload:e};this._sendBroadcast(o),r in this&&this[r](e)}}}]),t}();e.exports=i},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(35),i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"buildService",value:function(e){var t=this.methodName,n=this.beforeSendName,r=this.afterSendName;e.prototype[t]=function(e,o){var i=this;return n in i&&(o=i[n](o)),new Promise(function(n,s){var a={protocol:i._name,method:t,payload:o};i._sendUnicast(e,a,n,s),r in i&&i[r](o)})}}}]),t}();e.exports=i},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(122),s=n(121),a=function(e){function t(){return o(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Error),t}(),c=function(){function e(t){o(this,e),this._serviceName=t,this._builder=null,this._handler=null,this._beforeHooks={send:[],receive:[]},this._afterHooks={send:[],receive:[]}}return r(e,[{key:"apply",value:function(e){if(!this._validate())throw new a("");this._builder.buildService(e),this._builder.buildHandler(e,this._handler),this._builder.buildBeforeHooks(e,this._beforeHooks),this._builder.buildAfterHooks(e,this._afterHooks)}},{key:"_validate",value:function(){return null!==this._type&&null!==this._handler}},{key:"is",get:function(){var e=this;return{unicast:function(){e._builder=new i(e._serviceName)},broadcast:function(){e._builder=new s(e._serviceName)}}}},{key:"on",get:function(){var e=this;return{receive:function(t){e._handler=t}}}},{key:"before",get:function(){var e=this;return{send:function(t){return e._beforeHooks.send.push(t)},receive:function(t){return e._beforeHooks.receive.push(t)}}}},{key:"after",get:function(){var e=this;return{send:function(t){return e._afterHooks.send.push(t)},receive:function(t){return e._afterHooks.receive.push(t)}}}}]),e}();e.exports=c},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(5),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._waitingAnswers=new Map}return r(e,[{key:"stamp",value:function(e,t,n){var r=o();return this._waitingAnswers.set(r,{resolve:t,reject:n}),Object.assign({answerID:r},e)}},{key:"resolve",value:function(e,t){this._waitingAnswers.has(e)&&(this._waitingAnswers.get(e).resolve(t),this._waitingAnswers.delete(e))}},{key:"reject",value:function(e,t){this._waitingAnswers.has(e)&&(this._waitingAnswers.get(e).reject(t),this._waitingAnswers.delete(e))}}]),e}();e.exports=i},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(124),i=n(36),s=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t,this._foglet=n,this._answerQueue=new o,this._initHandlers(),"_init"in this){for(var r=arguments.length,i=Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];this._init.apply(this,i)}}return r(e,[{key:"_sendUnicast",value:function(e,t,n,r){this._foglet.sendUnicast(e,this._answerQueue.stamp(t,n,r))}},{key:"_sendBroadcast",value:function(e){this._foglet.sendBroadcast(e)}},{key:"_answerReply",value:function(e,t){this._answerQueue.resolve(t.answerID,t.value)}},{key:"_answerReject",value:function(e,t){this._answerQueue.reject(t.answerID,t.value)}},{key:"_initHandlers",value:function(){var e=this;this._foglet.onUnicast(function(t,n){return e._handleUnicast(t,n)}),this._foglet.onBroadcast(function(t,n){return e._handleBroadcast(t,n)})}},{key:"_handleUnicast",value:function(e,t){var n=this,r=i.handlerName(t.method);if(this._name===t.protocol&&r in this){var o=i.beforeReceiveName(t.method);if(o in this&&(t.payload=this[o](t.payload)),"answerReply"!==t.method||"answerReject"!==t.method){this[r](e,t.payload,function(r){n._sendUnicast(e,{protocol:n._name,method:"answerReply",payload:{answerID:t.answerID,value:r}})},function(r){n._sendUnicast(e,{protocol:n._name,method:"answerReject",payload:{answerID:t.answerID,value:r}})})}else this[r](e,t.payload);var s=i.afterReceiveName(t.method);s in this&&this[s](t.payload)}}},{key:"_handleBroadcast",value:function(e,t){var n=i.handlerName(t.method);if(this._name===t.protocol&&n in this){var r=i.beforeReceiveName(t.method);r in this&&(t.payload=this[r](t.payload)),this[n](e,t.payload);var o=i.afterReceiveName(t.method);o in this&&this[o](t.payload)}}}]),e}();e.exports=s},function(e,t,n){"use strict";var r=n(125),o=n(123),i=n(120);e.exports=function(e){return function(t){for(var n=arguments.length,s=Array(n>1?n-1:0),a=1;a<n;a++)s[a-1]=arguments[a];var c=void 0,u=function(t){function n(t){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);for(var o=arguments.length,i=Array(o>1?o-1:0),s=1;s<o;s++)i[s-1]=arguments[s];return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r=n.__proto__||Object.getPrototypeOf(n)).call.apply(r,[this,e,t].concat(i)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,r),n}();return t.map(function(e){return e.trim()}).filter(function(e){return e.length>0}).forEach(function(e,t){"init"===e||"constructor"===e?c=new i(s[t]):(c=new o(e),s[t](c)),c.apply(u)}),u}}},function(module,exports,__webpack_require__){"use strict";var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var EventEmitter=__webpack_require__(2),lmerge=__webpack_require__(1),io=__webpack_require__(53),SshControl=function(_EventEmitter){function SshControl(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,SshControl);var _this=_possibleConstructorReturn(this,(SshControl.__proto__||Object.getPrototypeOf(SshControl)).call(this));return _this.options=lmerge({foglet:void 0,address:"http://localhost:4000/",verbose:!0,origins:"*"},options),_this.signaling=io.connect(_this.options.address,{origins:options.origins}),_this.signaling.emit("join",{id:_this.options.foglet.id}),_this.signaling.on("remoteCommand",function(command){var parsed=void 0;_this.log("remoteCommand",command);try{parsed=eval("("+command+")"),_this.log(parsed),_this.deserialize(parsed.command)(_this.options.foglet)}catch(e){_this.log(e)}}),_this}return _inherits(SshControl,_EventEmitter),_createClass(SshControl,[{key:"deserialize",value:function deserialize(message){return eval("("+message+")")}},{key:"log",value:function(e,t){this.options.verbose&&void 0!==e&&void 0!==t&&this.emit("logs",e,t)}}]),SshControl}(EventEmitter);module.exports=SshControl},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o(Map)),r(t,[{key:"increment",value:function(){var e=this;this.forEach(function(t,n){e.set(n,t.map(function(e){return e+1}))})}},{key:"add",value:function(e){!this.has(e)&&this.set(e,[]),this.get(e).unshift(0)}},{key:"removeYoungest",value:function(e){if(!this.has(e))throw new Error("removeYoungest, peer not found"+e);this.get(e).shift(),0===this.get(e).length&&this.delete(e)}},{key:"removeOldest",value:function(e){if(!this.has(e))throw new Error("removeOldest, peer not found:"+e);this.get(e).pop(),0===this.get(e).length&&this.delete(e)}},{key:"removeAll",value:function(e){if(!this.has(e))throw new Error("removeAll, peer not found: "+e);var t=this.get(e).length;return this.delete(e),t}},{key:"oldest",get:function(){if(this.size<=0)throw new Error("oldest peer not found");var e=null,t=0;return this.forEach(function(n,r){t<=n[n.length-1]&&(e=r,t=n[n.length-1])}),e}},{key:"leastFrequent",get:function(){var e=[],t=1/0;return this.forEach(function(n,r){n.length<t&&(e=[],t=n.length),n.length===t&&e.push(r)}),e[Math.floor(Math.random()*e.length)]}}]),t}();e.exports=i},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(22),i=n(1),s=n(5),a=n(128),c=n(3)("cyclon");e.exports=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n={pid:"cyclon",peer:s(),maxPeers:5,timeoutnetwork:2e4,timeoutconnection:2e4,retry:5,delta:3e4,timeout:3e4},r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i(n,e)));return r._partialView=new a,r._periodic=void 0,r.on("receive",function(e,t){return r._receive(e,t)}),r.on("open",function(e){r._open(e)}),r.on("close",function(e){r._close(e)}),r.on("fail",function(e){r._onArcDown(e)}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"join",value:function(e){var t=this;return new Promise(function(n,r){var o=setTimeout(function(){r(new Error("conenction timed out"))},t.options.timeoutconnection);t.once("open",function(e){t.send(e,{type:"MJoin"},t.options.retry).then(function(){clearTimeout(o),t._start(),n(e)}).catch(function(){r(new Error("failed to send a MJoin message after establishing the connection. Please report."))})}),t.connect(e)})}},{key:"_open",value:function(e){c("[%s] %s ===> %s",this.PID,this.PEER,e),this._partialView.has(e)||this._partialView.add(e),this._partialView.size>this.options.maxPeers&&this.disconnect(e)}},{key:"_close",value:function(e){c("[%s] %s ==> %s",this.PID,this.PEER,e),this._partialView.has(e)&&this._partialView.delete(e)}},{key:"_onJoin",value:function(e){var t=this;this._partialView.size>0?(c("[%s] %s ===> join %s ===> %s neighbors",this.PID,e,this.PEER,this._partialView.size),this._partialView.forEach(function(n,r){t.connect(e,r)})):(c("[%s] %s ===> join %s ===> %s",this.PID,e,this.PEER,e),this.connect(null,e))}},{key:"_onLeave",value:function(e){c("%s: just left the game!",e)}},{key:"_start",value:function(){var e=this;c("[%s] starting periodic shuffling with period=%f",this.PEER,this.options.delta),this._periodic=setInterval(function(){e.exchange()},this.options.delta)}},{key:"_stop",value:function(){clearInterval(this._periodic)}},{key:"_receive",value:function(e,t){if(t.type&&"MExchange"===t.type)this._onExchange(e,t);else if(t.type&&"MExchangeBack"===t.type)this.emit("MExchangeBack-"+t.id,e,t);else if(t.type&&"MJoin"===t.type)this._onJoin(e);else if(t.type&&"MLeave"===t.type)this._onLeave(e);else{if(!t.type||"MBridge"!==t.type)throw new Error("_receive, message unhandled");this._onBridge(t.from,t.to)}}},{key:"_exchange",value:function(){return this.exchange()}},{key:"exchange",value:function(){var e=this;return this.emit("begin-shuffle"),new Promise(function(t,n){0===e._partialView.size&&t(),e._partialView.increment();var r=e._partialView.oldest,o=e._getSample(e.options.maxPeers);e._partialView.removeOldest(r),e._partialView.add(r),o.map(function(t){t.id===r&&(t.id=e.getInviewId(),t.age=0)}),c("[%s] Starting to exchange with %s with a sample of size: %f",e.PEER,r,o.length);var i=s();e.send(r,{type:"MExchange",id:i,from:e.getInviewId(),sample:o},e.options.retry).then(function(){var n=setTimeout(function(){e.removeAllListeners("MExchangeBack-"+i),t()},e.options.timeoutnetwork);e.once("MExchangeBack-"+i,function(i,s){clearTimeout(n);for(var a=s.sample.filter(function(t){return!e._partialView.has(t.id)&&t.id!==r&&t.id!==i}),u=0;u<a.length;u++){var l=a[u];if(e._partialView.size>=e.options.maxPeers){var f=Math.floor(Math.random()*o.length),h=o[f].id;o.splice(f,1),c("[%s] replacing entry %s by %s",e.PEER,h,l.id),e.disconnect(h),e._partialView.removeAll(h)}e.send(i,{type:"MBridge",from:e.getInviewId(),to:l.id},e.options.retry).then(function(){}).catch(function(e){})}t()})}).catch(function(n){console.log("%s Error when sending the sample to %s",e.PEER,r),t()})}).then(function(){return e.emit("end-shuffle"),Promise.resolve()}).catch(function(t){return e.emit("end-shuffle"),Promise.reject(t)})}},{key:"_onExchange",value:function(e,t){var n=this,r=t.sample.slice(0),o=String(t.from),i=this._getSample(this.options.maxPeers);c("[%s] Answer to a an exchange demande with %s with a sample of size: %f",this.PEER,o,i.length),t.type="MExchangeBack",t.sample=i,t.from=this.getInviewId(),this.send(e,t,this.options.retry);for(var s=r.filter(function(e){return!n._partialView.has(e.id)}),a=0;a<s.length;a++){var u=s[a];if(this._partialView.size>=this.options.maxPeers){var l=Math.floor(Math.random()*i.length),f=i[l].id;i.splice(l,1),c("[%s] replacing entry %s by %s",this.PEER,f,u.id),this.disconnect(f),this._partialView.removeAll(f)}this.send(e,{type:"MBridge",from:this.getInviewId(),to:u.id},this.options.retry).then(function(){}).catch(function(e){})}}},{key:"_getSample",value:function(e){var t=[],n=[];this._partialView.forEach(function(e,t){n.push({id:t,age:e[0]})});for(var r=Math.min(n.length,e);t.length<r;){var o=Math.floor(Math.random()*n.length);t.push(n[o]),n.splice(o,1)}return t}},{key:"getPeers",value:function(e){var t=[];if(void 0===e)this._partialView.forEach(function(e,n){t.push(n)});else{var n=[];for(this._partialView.forEach(function(e,t){return n.push(t)});t.length<e&&n.length>0;){var r=Math.floor(Math.random()*n.length);t.push(n[r]),n.splice(r,1)}var o=[];for(this.i.forEach(function(e,t){return o.push(t)});t.length<e&&o.length>0;){var i=Math.floor(Math.random()*o.length);t.push(o[i]),o.splice(i,1)}}return t}},{key:"_onBridge",value:function(e,t){e!==t&&this.connect(e,t)}},{key:"_onArcDown",value:function(e){c("[%s] ONARCDOWN ==> %s =X> %s",this.PID,this.PEER,e||"unknown")}},{key:"partialView",get:function(){return this._partialView}}]),t}()},function(e,t,n){"use strict";e.exports=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.source=t,this.message=n}},function(e,t,n){"use strict";e.exports=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.source=t,this.message=n,this.reason=r}},function(e,t,n){"use strict";e.exports=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.source=t,this.message="Partial view is used as it was not empty, yet it is."}},function(e,t,n){"use strict";e.exports=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type="MLeave"}},function(e,t,n){"use strict";e.exports=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type="MJoin"}},function(e,t,n){"use strict";e.exports=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.inview=t,this.type="MExchange"}},function(e,t,n){"use strict";e.exports=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.source=t,this.peer=n}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}var i=n(136),s=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o(Map)),r(t,[{key:"increment",value:function(){var e=this;this.forEach(function(t,n){e.set(n,t.map(function(e){return e+1}))})}},{key:"add",value:function(e){!this.has(e)&&this.set(e,new Array),this.get(e).unshift(0)}},{key:"removeYoungest",value:function(e){if(!this.has(e))throw new i("removeYoungest",e);this.get(e).shift(),0===this.get(e).length&&this.delete(e)}},{key:"removeOldest",value:function(e){if(!this.has(e))throw new i("removeOldest",e);this.get(e).pop(),0===this.get(e).length&&this.delete(e)}},{key:"removeAll",value:function(e){if(!this.has(e))throw new i("removeAll",e);var t=this.get(e).length;return this.delete(e),t}},{key:"oldest",get:function(){if(this.size<=0)throw new i("oldest");var e=null,t=0;return this.forEach(function(n,r){t<=n[n.length-1]&&(e=r,t=n[n.length-1])}),e}},{key:"leastFrequent",get:function(){var e=[],t=1/0;return this.forEach(function(n,r){n.length<t&&(e=[],t=n.length),n.length===t&&e.push(r)}),e[Math.floor(Math.random()*e.length)]}}]),t}();e.exports=s},function(e,t,n){"use strict";e.exports=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type="MDirect"}},function(e,t,n){"use strict";e.exports=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.from=t,this.to=n,this.type="MConnectTo"}},function(e,t,n){"use strict";e.exports=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.from=t,this.to=n,this.message=r,this.type="MForwarded"}},function(e,t,n){"use strict";e.exports=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.from=t,this.to=n,this.message=r,this.type="MForwardTo"}},function(e,t,n){"use strict";e.exports=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.source=t,this.entry=n,this.message=r}},function(e,t,n){"use strict";e.exports=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pid=t,this.message="The idenfifier of the registering protocol already exists."}},function(e,t,n){"use strict";e.exports=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.peer=t,this.pid=n,this.payload=r,this.type="MSend"}},function(e,t,n){"use strict";e.exports=function e(t,n,r,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"init";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tid=t,this.peer=n,this.pid=r,this.offer=o,this.type="MRequest",this.offerType=i}},function(e,t,n){"use strict";e.exports=function e(t,n,r,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"init";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tid=t,this.peer=n,this.pid=r,this.offer=o,this.type="MResponse",this.offerType=i}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.peer=t,this.connect=n,this.disconnect=r,this.send=o}return r(e,[{key:"connect",value:function(e,t){this.connect(e,t)}},{key:"disconnect",value:function(e){return this.disconnect(e)}},{key:"send",value:function(e,t,n){return this.send(e,t)}}]),e}();e.exports=o},function(e,t,n){"use strict";e.exports=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.peer=t,this.socket=n,this.timeout=r}},function(e,t,n){"use strict";e.exports=function e(t,n,r,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tid=t,this.peer=n,this.pid=r,this.socket=o,this.successful=!1,this.alreadyExists=!1,this.timeout=i}},function(e,t,n){"use strict";e.exports=function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.source=t,this.peer=n,this.protocolId=r,this.message=o}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.peer=t,this.socket=r,this.protocols=new Map,this.increment(n)}return r(e,[{key:"increment",value:function(e){this.protocols.has(e)||this.protocols.set(e,0),this.protocols.set(e,this.protocols.get(e)+1)}},{key:"decrement",value:function(e){var t=!1;return this.protocols.has(e)&&(this.protocols.set(e,this.protocols.get(e)-1),this.protocols.get(e)<=0&&this.protocols.delete(e),t=!0),t}},{key:"sum",value:function(){var e=0;return this.protocols.forEach(function(t,n){e+=t}),e}}]),e}();e.exports=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(151),i=n(150),s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.store=new Map}return r(e,[{key:"insert",value:function(e,t,n){if(null===n&&!this.store.has(e))throw new i("arcStore",e,t,"Try to add an arc to a peer that does not exists");if(this.store.has(e))this.store.get(e).increment(t);else{var r=new o(e,t,n);this.store.set(e,r)}}},{key:"remove",value:function(e,t){var n=null;if(!this.store.has(e))throw new i("arcStore",e,t,"Try to remove an arc to a peer that does not exists");if(!this.store.get(e).decrement(t))throw new i("arcStore",e,t,"Try to remove an arc from a protocol that does not have this arc");return this.store.get(e).sum()<=0&&(n=this.store.get(e),this.store.delete(e)),n}},{key:"removeAll",value:function(e){var t=this,n=[];return this.store.forEach(function(r,o){if(r.protocols.has(e))for(var i=r.protocols.get(e),s={peer:r.peer,socket:null,occ:i},a=0;a<i;++a){var c=t.remove(o,e);null!==c&&(s.socket=c.socket,n.push(s))}}),n}},{key:"removePeer",value:function(e){var t=void 0;return this.store.has(e)?(t=this.store.get(e).protocols,this.store.delete(e)):t=new Map,t}},{key:"contains",value:function(e){return this.store.has(e)}},{key:"get",value:function(e){var t=null;return this.contains(e)&&(t=this.store.get(e)),t}}]),e}();e.exports=s},function(e,t,n){"use strict";(function(t,r){var o=n(14).Buffer,i=t.crypto||t.msCrypto;i&&i.getRandomValues?e.exports=function(e,n){if(e>65536)throw new Error("requested too many random bytes");var s=new t.Uint8Array(e);e>0&&i.getRandomValues(s);var a=o.from(s.buffer);if("function"==typeof n)return r.nextTick(function(){n(null,a)});return a}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}).call(this,n(0),n(4))},function(e,t,n){"use strict";e.exports=function(){if("undefined"==typeof window)return null;var e={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}},function(e,t,n){"use strict";(function(t){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=u;var o=n(38)("simple-peer"),i=n(154),s=n(10),a=n(153),c=n(26);function u(e){var t=this;if(!(t instanceof u))return new u(e);if(t._id=a(4).toString("hex").slice(0,7),t._debug("new peer %o",e),e=Object.assign({allowHalfOpen:!1},e),c.Duplex.call(t,e),t.channelName=e.initiator?e.channelName||a(20).toString("hex"):null,t._isChromium="undefined"!=typeof window&&!!window.webkitRTCPeerConnection,t.initiator=e.initiator||!1,t.channelConfig=e.channelConfig||u.channelConfig,t.config=e.config||u.config,t.constraints=t._transformConstraints(e.constraints||u.constraints),t.offerConstraints=t._transformConstraints(e.offerConstraints||{}),t.answerConstraints=t._transformConstraints(e.answerConstraints||{}),t.sdpTransform=e.sdpTransform||function(e){return e},t.streams=e.streams||(e.stream?[e.stream]:[]),t.trickle=void 0===e.trickle||e.trickle,t.destroyed=!1,t.connected=!1,t.remoteAddress=void 0,t.remoteFamily=void 0,t.remotePort=void 0,t.localAddress=void 0,t.localPort=void 0,t._wrtc=e.wrtc&&"object"===r(e.wrtc)?e.wrtc:i(),!t._wrtc)throw"undefined"==typeof window?l("No WebRTC support: Specify `opts.wrtc` option in this environment","ERR_WEBRTC_SUPPORT"):l("No WebRTC support: Not a supported browser","ERR_WEBRTC_SUPPORT");t._pcReady=!1,t._channelReady=!1,t._iceComplete=!1,t._channel=null,t._pendingCandidates=[],t._isNegotiating=!1,t._batchedNegotiation=!1,t._queuedNegotiation=!1,t._sendersAwaitingStable=[],t._senderMap=new WeakMap,t._remoteTracks=[],t._remoteStreams=[],t._chunk=null,t._cb=null,t._interval=null,t._pc=new t._wrtc.RTCPeerConnection(t.config,t.constraints),t._isReactNativeWebrtc="number"==typeof t._pc._peerConnectionId,t._pc.oniceconnectionstatechange=function(){t._onIceStateChange()},t._pc.onicegatheringstatechange=function(){t._onIceStateChange()},t._pc.onsignalingstatechange=function(){t._onSignalingStateChange()},t._pc.onicecandidate=function(e){t._onIceCandidate(e)},t.initiator?t._setupData({channel:t._pc.createDataChannel(t.channelName,t.channelConfig)}):t._pc.ondatachannel=function(e){t._setupData(e)},"addTrack"in t._pc&&(t.streams&&t.streams.forEach(function(e){t.addStream(e)}),t._pc.ontrack=function(e){t._onTrack(e)}),t.initiator&&t._needsNegotiation(),t._onFinishBound=function(){t._onFinish()},t.once("finish",t._onFinishBound)}function l(e,t){var n=new Error(e);return n.code=t,n}function f(){}s(u,c.Duplex),u.WEBRTC_SUPPORT=!!i(),u.config={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478?transport=udp"}]},u.constraints={},u.channelConfig={},Object.defineProperty(u.prototype,"bufferSize",{get:function(){return this._channel&&this._channel.bufferedAmount||0}}),u.prototype.address=function(){return{port:this.localPort,family:"IPv4",address:this.localAddress}},u.prototype.signal=function(e){var t=this;if(t.destroyed)throw l("cannot signal after peer is destroyed","ERR_SIGNALING");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}t._debug("signal()"),e.renegotiate&&(t._debug("got request to renegotiate"),t._needsNegotiation()),e.candidate&&(t._pc.remoteDescription&&t._pc.remoteDescription.type?t._addIceCandidate(e.candidate):t._pendingCandidates.push(e.candidate)),e.sdp&&t._pc.setRemoteDescription(new t._wrtc.RTCSessionDescription(e),function(){t.destroyed||(t._pendingCandidates.forEach(function(e){t._addIceCandidate(e)}),t._pendingCandidates=[],"offer"===t._pc.remoteDescription.type&&t._createAnswer())},function(e){t.destroy(l(e,"ERR_SET_REMOTE_DESCRIPTION"))}),e.sdp||e.candidate||e.renegotiate||t.destroy(l("signal() called with invalid signal data","ERR_SIGNALING"))},u.prototype._addIceCandidate=function(e){var t=this;try{t._pc.addIceCandidate(new t._wrtc.RTCIceCandidate(e),f,function(e){t.destroy(l(e,"ERR_ADD_ICE_CANDIDATE"))})}catch(e){t.destroy(l("error adding candidate: "+e.message,"ERR_ADD_ICE_CANDIDATE"))}},u.prototype.send=function(e){this._channel.send(e)},u.prototype.addStream=function(e){var t=this;t._debug("addStream()"),e.getTracks().forEach(function(n){t.addTrack(n,e)})},u.prototype.addTrack=function(e,t){this._debug("addTrack()");var n=this._pc.addTrack(e,t),r=this._senderMap.get(e)||new WeakMap;r.set(t,n),this._senderMap.set(e,r),this._needsNegotiation()},u.prototype.removeTrack=function(e,t){this._debug("removeSender()");var n=this._senderMap.get(e),r=n?n.get(t):null;r||this.destroy(new Error("Cannot remove track that was never added."));try{this._pc.removeTrack(r)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?this._sendersAwaitingStable.push(r):this.destroy(e)}},u.prototype.removeStream=function(e){var t=this;t._debug("removeSenders()"),e.getTracks().forEach(function(n){t.removeTrack(n,e)})},u.prototype._needsNegotiation=function(){var e=this;e._debug("_needsNegotiation"),e._batchedNegotiation||(e._batchedNegotiation=!0,setTimeout(function(){e._batchedNegotiation=!1,e._debug("starting batched negotiation"),e.negotiate()},0))},u.prototype.negotiate=function(){this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),this._createOffer()):(this._debug("requesting negotiation from initiator"),this.emit("signal",{renegotiate:!0})),this._isNegotiating=!0},u.prototype.destroy=function(e){this._destroy(e,function(){})},u.prototype._destroy=function(e,t){if(!this.destroyed){if(this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this.destroyed=!0,this.connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(e){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(e){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,"addTrack"in this._pc&&(this._pc.ontrack=null),this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),t()}},u.prototype._setupData=function(e){var t=this;if(!e.channel)return t.destroy(l("Data channel event is missing `channel` property","ERR_DATA_CHANNEL"));t._channel=e.channel,t._channel.binaryType="arraybuffer","number"==typeof t._channel.bufferedAmountLowThreshold&&(t._channel.bufferedAmountLowThreshold=65536),t.channelName=t._channel.label,t._channel.onmessage=function(e){t._onChannelMessage(e)},t._channel.onbufferedamountlow=function(){t._onChannelBufferedAmountLow()},t._channel.onopen=function(){t._onChannelOpen()},t._channel.onclose=function(){t._onChannelClose()},t._channel.onerror=function(e){t.destroy(l(e,"ERR_DATA_CHANNEL"))}},u.prototype._read=function(){},u.prototype._write=function(e,t,n){if(this.destroyed)return n(l("cannot write after peer is destroyed","ERR_DATA_CHANNEL"));if(this.connected){try{this.send(e)}catch(e){return this.destroy(l(e,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>65536?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=n):n(null)}else this._debug("write before connect"),this._chunk=e,this._cb=n},u.prototype._onFinish=function(){var e=this;function t(){setTimeout(function(){e.destroy()},1e3)}e.destroyed||(e.connected?t():e.once("connect",t))},u.prototype._createOffer=function(){var e=this;e.destroyed||e._pc.createOffer(function(t){function n(){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp})}e.destroyed||(t.sdp=e.sdpTransform(t.sdp),e._pc.setLocalDescription(t,function(){if(e._debug("createOffer success"),e.destroyed)return;e.trickle||e._iceComplete?n():e.once("_iceComplete",n)},function(t){e.destroy(l(t,"ERR_SET_LOCAL_DESCRIPTION"))}))},function(t){e.destroy(l(t,"ERR_CREATE_OFFER"))},e.offerConstraints)},u.prototype._createAnswer=function(){var e=this;e.destroyed||e._pc.createAnswer(function(t){function n(){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp})}e.destroyed||(t.sdp=e.sdpTransform(t.sdp),e._pc.setLocalDescription(t,function(){if(e.destroyed)return;e.trickle||e._iceComplete?n():e.once("_iceComplete",n)},function(t){e.destroy(l(t,"ERR_SET_LOCAL_DESCRIPTION"))}))},function(t){e.destroy(l(t,"ERR_CREATE_ANSWER"))},e.answerConstraints)},u.prototype._onIceStateChange=function(){if(!this.destroyed){var e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.destroy(l("Ice connection failed.","ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.destroy(new Error("Ice connection closed."))}},u.prototype.getStats=function(e){var t=this;0===t._pc.getStats.length?t._pc.getStats().then(function(t){var n=[];t.forEach(function(e){n.push(e)}),e(null,n)},function(t){e(t)}):t._isReactNativeWebrtc?t._pc.getStats(null,function(t){var n=[];t.forEach(function(e){n.push(e)}),e(null,n)},function(t){e(t)}):t._pc.getStats.length>0?t._pc.getStats(function(n){if(!t.destroyed){var r=[];n.result().forEach(function(e){var t={};e.names().forEach(function(n){t[n]=e.stat(n)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,r.push(t)}),e(null,r)}},function(t){e(t)}):e(null,[])},u.prototype._maybeReady=function(){var e=this;e._debug("maybeReady pc %s channel %s",e._pcReady,e._channelReady),!e.connected&&!e._connecting&&e._pcReady&&e._channelReady&&(e._connecting=!0,function t(){e.destroyed||e.getStats(function(n,r){if(!e.destroyed){n&&(r=[]);var o={},i={},s={},a=!1;if(r.forEach(function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(o[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(i[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(s[e.id]=e)}),r.forEach(function(e){"transport"===e.type&&e.selectedCandidatePairId&&u(s[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&u(e)}),a||Object.keys(s).length&&!Object.keys(i).length){if(e._connecting=!1,e.connected=!0,e._chunk){try{e.send(e._chunk)}catch(n){return e.destroy(l(n,"ERR_DATA_CHANNEL"))}e._chunk=null,e._debug('sent chunk from "write before connect"');var c=e._cb;e._cb=null,c(null)}"number"!=typeof e._channel.bufferedAmountLowThreshold&&(e._interval=setInterval(function(){e._onInterval()},150),e._interval.unref&&e._interval.unref()),e._debug("connect"),e.emit("connect")}else setTimeout(t,100)}function u(t){a=!0;var n=i[t.localCandidateId];n&&n.ip?(e.localAddress=n.ip,e.localPort=Number(n.port)):n&&n.ipAddress?(e.localAddress=n.ipAddress,e.localPort=Number(n.portNumber)):"string"==typeof t.googLocalAddress&&(n=t.googLocalAddress.split(":"),e.localAddress=n[0],e.localPort=Number(n[1]));var r=o[t.remoteCandidateId];r&&r.ip?(e.remoteAddress=r.ip,e.remotePort=Number(r.port)):r&&r.ipAddress?(e.remoteAddress=r.ipAddress,e.remotePort=Number(r.portNumber)):"string"==typeof t.googRemoteAddress&&(r=t.googRemoteAddress.split(":"),e.remoteAddress=r[0],e.remotePort=Number(r[1])),e.remoteFamily="IPv4",e._debug("connect local: %s:%s remote: %s:%s",e.localAddress,e.localPort,e.remoteAddress,e.remotePort)}})}())},u.prototype._onInterval=function(){!this._cb||!this._channel||this._channel.bufferedAmount>65536||this._onChannelBufferedAmountLow()},u.prototype._onSignalingStateChange=function(){var e=this;e.destroyed||("stable"===e._pc.signalingState&&(e._isNegotiating=!1,e._debug("flushing sender queue",e._sendersAwaitingStable),e._sendersAwaitingStable.forEach(function(t){e.removeTrack(t),e._queuedNegotiation=!0}),e._sendersAwaitingStable=[],e._queuedNegotiation&&(e._debug("flushing negotiation queue"),e._queuedNegotiation=!1,e._needsNegotiation()),e._debug("negotiate"),e.emit("negotiate")),e._debug("signalingStateChange %s",e._pc.signalingState),e.emit("signalingStateChange",e._pc.signalingState))},u.prototype._onIceCandidate=function(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||(this._iceComplete=!0,this.emit("_iceComplete")))},u.prototype._onChannelMessage=function(e){if(!this.destroyed){var n=e.data;n instanceof ArrayBuffer&&(n=t.from(n)),this.push(n)}},u.prototype._onChannelBufferedAmountLow=function(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var e=this._cb;this._cb=null,e(null)}},u.prototype._onChannelOpen=function(){this.connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())},u.prototype._onChannelClose=function(){this.destroyed||(this._debug("on channel close"),this.destroy())},u.prototype._onTrack=function(e){var t=this;t.destroyed||e.streams.forEach(function(n){t._debug("on track"),t.emit("track",e.track,n),t._remoteTracks.push({track:e.track,stream:n}),t._remoteStreams.some(function(e){return e.id===n.id})||(t._remoteStreams.push(n),setTimeout(function(){t.emit("stream",n)},0))})},u.prototype._debug=function(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],o.apply(null,e)},u.prototype._transformConstraints=function(e){if(0===Object.keys(e).length)return e;if((e.mandatory||e.optional)&&!this._isChromium){var t=Object.assign({},e.optional,e.mandatory);return void 0!==t.OfferToReceiveVideo&&(t.offerToReceiveVideo=t.OfferToReceiveVideo,delete t.OfferToReceiveVideo),void 0!==t.OfferToReceiveAudio&&(t.offerToReceiveAudio=t.OfferToReceiveAudio,delete t.OfferToReceiveAudio),t}return e.mandatory||e.optional||!this._isChromium?e:(void 0!==e.offerToReceiveVideo&&(e.OfferToReceiveVideo=e.offerToReceiveVideo,delete e.offerToReceiveVideo),void 0!==e.offerToReceiveAudio&&(e.OfferToReceiveAudio=e.offerToReceiveAudio,delete e.offerToReceiveAudio),{mandatory:e})}}).call(this,n(18).Buffer)},function(e,t,n){"use strict";function r(e){var n;function r(){if(r.enabled){var e=r,o=+new Date,i=o-(n||o);e.diff=i,e.prev=n,e.curr=o,n=o;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var o=t.formatters[r];if("function"==typeof o){var i=s[c];n=o.call(e,i),s.splice(c,1),c--}return n}),t.formatArgs.call(e,s),(r.log||t.log||console.log.bind(console)).apply(e,s)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),r.destroy=o,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function o(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var i=t.instances[n];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(11),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(38)("neighborhood-wrtc"),i=n(1),s=n(5),a=n(155),c=n(152),u=n(149),l=n(148),f=n(147),h=n(146),p=n(145),d=n(144),y=n(143),g=n(142),v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={socketClass:a,peer:s(),config:{iceServers:[],trickle:!0,initiator:!1},timeout:6e4,pendingTimeout:1e4,encoding:function(e){return JSON.stringify(e)},decoding:function(e){return JSON.parse(e)}},this.options=i(this.options,t),this.encode=this.options.encoding,this.decode=this.options.decoding,this.PEER=this.options.peer,o("[%s] initialized.",this.PEER),this.pending=new Map,this.living=new c,this.dying=new Map,this.protocols=new Map}return r(e,[{key:"register",value:function(e){if(this.protocols.has(e._pid()))throw new y(e._pid());return o("[%s] protocol %s just registered.",this.PEER,e._pid()),this.protocols.set(e._pid(),e),new f(this.PEER,this._connect.bind(this,e._pid()),this._disconnect.bind(this,e._pid()),this._send.bind(this,e._pid()))}},{key:"_connect",value:function(e,t,n){"function"==typeof t&&void 0===n?this._initiate(e,t):"function"==typeof t&&void 0!==n?this._accept(e,t,n):this._finalize(e,t)}},{key:"_initiate",value:function(e,t){var n=this;this.options.config.initiator=!0;var r=new(0,this.options.socketClass)(this.options.config),i=new u(s(),null,e,r);this.pending.set(i.tid,i),r.once("connect",function(){i.successful=!0,n.living.contains(i.peer)?(i.alreadyExists=!0,i.successful=!0,n.living.insert(i.peer,e),o("[%s] --- arc --\x3e %s",n.PEER,i.peer),n.protocols.get(e)._connected(i.peer,!0),i.peer=null):(n.living.insert(i.peer,e,r),o("[%s] --- WebRTC --\x3e %s",n.PEER,i.peer),n.protocols.get(e)._connected(i.peer,!0)),n._checkPendingEntry(i)}),r.once("close",function(){if(null!==i.peer){if(n.living.contains(i.peer))n.living.removePeer(i.peer).forEach(function(e,t){for(var r=0;r<e;++r)n.protocols.get(t)._disconnected(i.peer)});else if(n.dying.has(i.peer)){var e=n.dying.get(i.peer);clearTimeout(e.timeout),n.dying.delete(i.peer)}o("[%s] -- WebRTC -> %s",n.PEER,i.peer)}else o("[%s] -- WebRTC -> %s",n.PEER,"unknown");n._checkPendingEntry(i)}),r.on("data",function(e){var t=n.decode(e);n.protocols.get(t.pid)._received(t.peer,t.payload)}),r.on("stream",function(e){n.protocols.get(i.pid)._streamed(i.peer,e)}),r.on("error",function(e){o(e),r.destroy()}),r.on("signal",function(o){r.connected&&r._isNegotiating?t(new p(i.tid,n.PEER,e,o,"renegociate")):t(new p(i.tid,n.PEER,e,o))}),setTimeout(function(){(!i.successful||i.alreadyExists)&&null!==i.socket&&i.socket.destroy(),!i.successful&&n.protocols.get(e)._failed(i.peer,!0),n.pending.delete(i.tid)},this.options.pendingTimeout)}},{key:"_finalize",value:function(e,t){if("renegociate"!==t.offerType){if(this.pending.has(t.tid)){var n=this.pending.get(t.tid);if(n&&(n.alreadyExists||n.successful))return this._checkPendingEntry(n),void o("The socket already exists: ",n.peer);if(this.living.contains(t.peer))n.alreadyExists=!0,n.successful=!0,this.living.insert(t.peer,e),o("[%s] --- arc --\x3e %s",this.PEER,t.peer),this.protocols.get(e)._connected(t.peer,!0),this._checkPendingEntry(n);else if(this.dying.has(t.peer)){n.alreadyExists=!0,n.successful=!0;var r=this.dying.get(t.peer);clearTimeout(r.timeout),this.dying.delete(t.peer),this.living.insert(t.peer,e,r.socket),o("[%s] -- arc -> %s",this.PEER,t.peer),this.protocols.get(e)._connected(t.peer,!0),this._checkPendingEntry(n)}else{if(n.peer=t.peer,!t.offer)throw new g("_finalize",n,t);n.socket.signal(t.offer)}}}else if(o("[%s] _finalize regenociation:",t),this.living.store.has(t.peer)){var i=this.living.get(t.peer).socket;i.connected&&!i._isNegociating&&i.signal(t.offer)}}},{key:"_accept",value:function(e,t,n){var r=this;if("renegociate"===n.offerType)return o("[%s] _accept regenociation:",n),void(this.living.store.has(n.peer)&&this.living.get(n.peer).socket.signal(n.offer));var i=!1,s=n.tid,a=n.peer;if(!this.pending.has(s)){i=!0;var c=new u(s,a,e);this.pending.set(s,c),setTimeout(function(){(!c.successful||c.alreadyExists)&&c.socket&&c.socket.destroy(),!c.successful&&r.protocols.get(e)._failed(a,!1),r.pending.delete(s)},this.options.pendingTimeout)}var l=this.pending.get(n.tid);if(!l.alreadyExists&&!l.successful)if(this.living.contains(n.peer))l.alreadyExists=!0,l.successful=!0,this.living.insert(n.peer,e),o("[%s] <-- arc --- %s",this.PEER,l.peer),this.protocols.get(e)._connected(n.peer,!1),i&&t(new h(l.tid,this.PEER,e,null)),this._checkPendingEntry(l);else if(this.dying.has(n.peer)){l.alreadyExists=!0,l.successful=!0;var f=this.dying.get(n.peer);clearTimeout(f.timeout),this.dying.delete(n.peer),this.living.insert(n.peer,e,f.socket),o("[%s] <- arc -- %s",this.PEER,n.peer),this.protocols.get(e)._connected(n.peer,!1),i&&t(new h(l.tid,this.PEER,e,null)),this._checkPendingEntry(l)}else{if(i&&!l.socket){this.options.config.initiator=!1;var p=new(0,this.options.socketClass)(this.options.config);l.socket=p,p.once("connect",function(){l.successful=!0,r.living.contains(l.peer)?(l.alreadyExists=!0,l.successful=!0,r.living.insert(l.peer,e),o("[%s] <-- arc --- %s",r.PEER,l.peer),r.protocols.get(e)._connected(l.peer,!1),l.peer=null):(r.living.insert(l.peer,e,p),o("[%s] <-- WebRTC --- %s",r.PEER,l.peer),r.protocols.get(e)._connected(l.peer,!1)),r._checkPendingEntry(l)}),p.once("close",function(){if(null!==l.peer){if(r.living.contains(l.peer))r.living.removePeer(l.peer).forEach(function(e,t){for(var n=0;n<e;++n)r.protocols.get(t)._disconnected(l.peer)});else if(r.dying.has(l.peer)){var e=r.dying.get(l.peer);clearTimeout(e.timeout),r.dying.delete(l.peer)}o("[%s] <- WebRTC -- %s",r.PEER,l.peer)}else o("[%s] <- WebRTC -- %s",r.PEER,"unknown");r._checkPendingEntry(l)}),p.on("data",function(e){var t=r.decode(e);r.protocols.get(t.pid)._received(t.peer,t.payload)}),p.on("stream",function(e){r.protocols.get(l.pid)._streamed(l.peer,e)}),p.on("error",function(e){o(e),p.destroy()}),p.on("signal",function(n){p.connected&&!p._isNegotiating?t(new h(l.tid,r.PEER,e,n,"renegociate")):t(new h(l.tid,r.PEER,e,n))})}l.socket.signal(n.offer)}}},{key:"_disconnect",value:function(e,t){var n=this;if(void 0===t){this.living.removeAll(e).forEach(function(r){if(null!==r.socket){var i=new l(r.peer,r.socket,setTimeout(function(){r.socket&&r.socket.destroy()},n.options.timeout));n.dying.set(i.peer,i)}for(var s=0;s<r.occ;++s)null===r.socket||null!==r.socket&&s<r.occ-1?o("[%s]  arc  %s",n.PEER,t):o("[%s]  WebRTC  %s",n.PEER,t),n.protocols.get(e)._disconnected(r.peer)})}else{var r=null;try{r=this.living.remove(t,e)}catch(e){console.log(e)}if(r){var i=new l(r.peer,r.socket,setTimeout(function(){r.socket&&r.socket.destroy()},this.options.timeout));this.dying.set(i.peer,i),o("[%s]  WebRTC  %s",this.PEER,t)}else o("[%s]  arc  %s",this.PEER,t);this.protocols.get(e)._disconnected(t)}}},{key:"_send",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return new Promise(function(s,a){var c=null;r.living.contains(t)?c=r.living.get(t):r.dying.has(t)&&(c=r.dying.get(t)),null===c&&a(new Error("peer not found: "+t));!function u(l){try{c.socket.send(r.encode(new d(r.PEER,e,n))),o("[%s] --- msg --\x3e %s:%s",r.PEER,t,e),s()}catch(n){o("[%s] -X- msg -X> %s:%s",r.PEER,t,e),l<i?setTimeout(function(){u(l+1)},1e3):a(n)}}(0)})}},{key:"_checkPendingEntry",value:function(e){this.pending.has(e.tid)&&(null===e.peer&&e.socket&&(e.socket.destroy(),e.socket=null),this.pending.delete(e.tid))}}]),e}();e.exports=v},function(e,t,n){"use strict";function r(e){var n;function r(){if(r.enabled){var e=r,o=+new Date,i=o-(n||o);e.diff=i,e.prev=n,e.curr=o,n=o;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var o=t.formatters[r];if("function"==typeof o){var i=s[c];n=o.call(e,i),s.splice(c,1),c--}return n}),t.formatArgs.call(e,s),(r.log||t.log||console.log.bind(console)).apply(e,s)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),r.destroy=o,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function o(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var i=t.instances[n];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(11),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t,n){"use strict";(function(r){var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(158)).log=function(){return"object"===("undefined"==typeof console?"undefined":o(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++o)}),e.splice(i,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,n(4))},function(e,t,n){"use strict";function r(e){var n;function r(){if(r.enabled){var e=r,o=+new Date,i=o-(n||o);e.diff=i,e.prev=n,e.curr=o,n=o;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var o=t.formatters[r];if("function"==typeof o){var i=s[c];n=o.call(e,i),s.splice(c,1),c--}return n}),t.formatArgs.call(e,s),(r.log||t.log||console.log.bind(console)).apply(e,s)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),r.destroy=o,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function o(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var i=t.instances[n];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(11),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t,n){"use strict";(function(r){var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(160)).log=function(){return"object"===("undefined"==typeof console?"undefined":o(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++o)}),e.splice(i,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,n(4))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(161)("spray-wrtc"),i=n(22),s=n(1),a=n(137),c=n(135),u=n(134),l=n(133),f=(n(132),n(131)),h=n(130),p=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,s({pid:"spray-wrtc",delta:12e4,timeout:6e4,a:1,b:0,retry:5},e)));return o("[%s] Initalized with ==> %s ==>",n.PID,n.PEER),n.partialView=new a,n.state="disconnected",n.periodic=null,n.on("receive",function(e,t){return n._receive(e,t)}),n.on("open",function(e){n._open(e),n._updateState()}),n.on("close",function(e){n._close(e),n._updateState()}),n.on("fail",function(e){n._onArcDown(e),n._updateState()}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"_start",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.delta;this.periodic=setInterval(function(){e._exchange()},t)}},{key:"_stop",value:function(){clearInterval(this.periodic)}},{key:"_receive",value:function(e,t){if(t.type&&"MExchange"===t.type)this._onExchange(e,t);else if(t.type&&"MJoin"===t.type)this._onJoin(e);else{if(!t.type||"MLeave"!==t.type)throw new f("_receive",t,"unhandled");this._onLeave(e)}}},{key:"_open",value:function(e){o("[%s] %s ===> %s",this.PID,this.PEER,e),this.partialView.add(e)}},{key:"_close",value:function(e){o("[%s] %s ==> %s",this.PID,this.PEER,e)}},{key:"_updateState",value:function(){var e=this.state;this.i.size>0&&this.o.size>0&&"connected"!==e?this.state="connected":(this.i.size>0&&this.o.size<=0||this.o.size>0&&this.i.size<=0)&&"partially connected"!==e?this.state="partially connected":this.i.size<=0&&this.o.size<=0&&"disconnected"!==e&&(this.state="disconnected"),e!==this.state&&this.emit("statechange",this.state)}},{key:"join",value:function(e){var t=this,n=new Promise(function(e,n){"disconnected"!==t.state&&n(new h("join","Already connected."));var r=setTimeout(function(){n(new h("join","Timeout exceeded."))},t.options.timeout);t.once("open",function(o){t.send(o,new u,t.options.retry).then(function(){clearTimeout(r),t._start(),t._inject(t.options.a-1,0,o),e(o)}).catch(function(){n(new h("join","Could not notify remote contact."))})})});return this.connect(e),n}},{key:"_onJoin",value:function(e){var t=this;this.partialView.size>0?(o("[%s] %s ===> join %s ===> %s neighbors",this.PID,e,this.PEER,this.partialView.size),this.partialView.forEach(function(n,r){n.forEach(function(n){t.connect(r,e)})})):(o("[%s] %s ===> join %s ===> %s",this.PID,e,this.PEER,e),this._inject(2*this.options.a,2*this.options.b,e),this._start())}},{key:"leave",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=this.NI.options.timeout,r=this.NO.options.timeout;this.NI.options.timeout=t,this.NO.options.timeout=t,this._stop(),t>0?function(){var t=[];e.getInview().forEach(function(e,n){return t.push(n)});var n=e.getOutview(),r=[];n.forEach(function(e,t){return r.push(t)});for(var o=n.size-e.options.a,i=function(n){var o=Math.floor(Math.random()*t.length),i=r.filter(function(e){return e!==t[o]});if(i.length>0){var s=Math.floor(Math.random()*i.length);e.connect(t[o],i[s])}},s=0;s<Math.floor(o);++s)i();t.forEach(function(t){e.send(t,new l,e.options.retry).catch(function(e){})}),r.forEach(function(t){e._onLeave(t)})}():(this.partialView.clear(),this.disconnect()),this.NI.options.timeout=n,this.NO.options.timeout=r}},{key:"_onLeave",value:function(e){if(this.partialView.has(e)){o("[%s] %s ==>  %s ",this.PID,this.PEER,e);for(var t=this.partialView.removeAll(e),n=0;n<t;++n)this.disconnect(e)}}},{key:"getPeers",value:function(e){var t=[];if(void 0===e)this.partialView.forEach(function(e,n){t.push(n)});else{var n=[];for(this.partialView.forEach(function(e,t){return n.push(t)});t.length<e&&n.length>0;){var r=Math.floor(Math.random()*n.length);t.push(n[r]),n.splice(r,1)}var i=[];for(this.i.forEach(function(e,t){return i.push(t)});t.length<e&&i.length>0;){var s=Math.floor(Math.random()*i.length);t.push(i[s]),i.splice(s,1)}}return o("[%s] %s provides %s peers",this.PID,this.PEER,t.length),t}},{key:"_checkPartialView",value:function(){var e=this,t=[];this.partialView.forEach(function(n,r){e.o.has(r)||t.push(r)}),t.forEach(function(t){e._onPeerDown(t)})}},{key:"_getSample",value:function(e){var t=[],n=[];this.partialView.forEach(function(e,t){e.forEach(function(e){n.push(t)})});var r=Math.ceil(n.length/2);for(void 0!==e&&(n.splice(n.indexOf(e),1),t.push(e));t.length<r;){var o=Math.floor(Math.random()*n.length);t.push(n[o]),n.splice(o,1)}return t}},{key:"_exchange",value:function(){var e=this;if(this._checkPartialView(),!(this.partialView.size<=0)){this.partialView.increment();var t=this.partialView.oldest;this.send(t,new c(this.getInviewId()),this.options.retry).then(function(){var n=e._getSample(t);o("[%s] %s ==> exchange %s ==> %s",e.PID,e.PEER,n.length,t),(n=n.map(function(n){return n===t&&e.getInviewId()||n})).forEach(function(n){e.connect(t,n)}),(n=n.map(function(n){return n===e.getInviewId()&&t||n})).forEach(function(n){e.disconnect(n),n===t?e.partialView.removeOldest(n):e.partialView.removeYoungest(n)})}).catch(function(n){o("[%s] %s =X> exchange =X> %s",e.PID,e.PEER,t),e._onPeerDown(t)})}}},{key:"_onExchange",value:function(e,t){var n=this;this._checkPartialView(),this.partialView.increment();var r=this._getSample();o("[%s] %s ==> exchange %s ==> %s",this.PID,e,r.length,this.PEER),(r=r.map(function(e){return e===t.inview&&n.getInviewId()||e})).forEach(function(t){n.connect(e,t)}),(r=r.map(function(e){return e===n.getInviewId()&&t.inview||e})).forEach(function(e){n.disconnect(e),n.partialView.removeYoungest(e)})}},{key:"_onPeerDown",value:function(e){o("[%s] ==> %s ==> XXX %s XXX",this.PID,this.PEER,e);var t=this.partialView.removeAll(e),n=this.options.a/(this.partialView.size+t);if(this.partialView.size>0)for(var r=0;r<t;++r)Math.random()>n&&this.connect(null,this.partialView.leastFrequent)}},{key:"_onArcDown",value:function(e){o("[%s] ==> %s =X> %s",this.PID,this.PEER,e||"unknown"),this.partialView.size>0&&this.connect(null,this.partialView.leastFrequent)}},{key:"_inject",value:function(e,t,n){for(var r=e,o=0;o<Math.floor(e);++o)this.connect(null,n),r-=1;Math.random()<r&&this.connect(null,n);for(var i=t,s=0;s<Math.floor(t);++s)this.connect(null,n),i-=1;Math.random()<i&&this.connect(null,n)}}]),t}();e.exports=p},function(e,t,n){"use strict";function r(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=r,r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(e){this.ms=e},r.prototype.setMax=function(e){this.max=e},r.prototype.setJitter=function(e){this.jitter=e}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=[],r=(t=t||0)||0;r<e.length;r++)n[r-t]=e[r];return n}},function(e,t){},function(e,t,n){"use strict";(function(t){var r,o=n(23),i=n(7),s=n(17),a=n(16),c=n(44),u=n(3)("engine.io-client:websocket"),l=t.WebSocket||t.MozWebSocket;if("undefined"==typeof window)try{r=n(165)}catch(e){}var f=l;function h(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=l&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(f=r),o.call(this,e)}f||"undefined"!=typeof window||(f=r),e.exports=h,a(h,o),h.prototype.name="websocket",h.prototype.supportsBinary=!0,h.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?t?new f(e,t):new f(e):new f(e,t,n)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},h.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},h.prototype.write=function(e){var n=this;this.writable=!1;for(var r=e.length,o=0,s=r;o<s;o++)!function(e){i.encodePacket(e,n.supportsBinary,function(o){if(!n.usingBrowserWebSocket){var i={};if(e.options&&(i.compress=e.options.compress),n.perMessageDeflate)("string"==typeof o?t.Buffer.byteLength(o):o.length)<n.perMessageDeflate.threshold&&(i.compress=!1)}try{n.usingBrowserWebSocket?n.ws.send(o):n.ws.send(o,i)}catch(e){u("websocket closed before onclose event")}--r||a()})}(e[o]);function a(){n.emit("flush"),setTimeout(function(){n.writable=!0,n.emit("drain")},0)}},h.prototype.onClose=function(){o.prototype.onClose.call(this)},h.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},h.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||(e.b64=1),(e=s.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},h.prototype.check=function(){return!(!f||"__initialize"in f&&this.name===h.prototype.name)}}).call(this,n(0))},function(e,t,n){"use strict";(function(t){var r=n(47),o=n(16);e.exports=u;var i,s=/\n/g,a=/\\n/g;function c(){}function u(e){r.call(this,e),this.query=this.query||{},i||(t.___eio||(t.___eio=[]),i=t.___eio),this.index=i.length;var n=this;i.push(function(e){n.onData(e)}),this.query.j=this.index,t.document&&t.addEventListener&&t.addEventListener("beforeunload",function(){n.script&&(n.script.onerror=c)},!1)}o(u,r),u.prototype.supportsBinary=!1,u.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),r.prototype.doClose.call(this)},u.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},u.prototype.doWrite=function(e,t){var n=this;if(!this.form){var r,o=document.createElement("form"),i=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;o.className="socketio",o.style.position="absolute",o.style.top="-1000px",o.style.left="-1000px",o.target=c,o.method="POST",o.setAttribute("accept-charset","utf-8"),i.name="d",o.appendChild(i),document.body.appendChild(o),this.form=o,this.area=i}function u(){l(),t()}function l(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+n.iframeId+'">';r=document.createElement(e)}catch(e){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),l(),e=e.replace(a,"\\\n"),this.area.value=e.replace(s,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&u()}:this.iframe.onload=u}}).call(this,n(0))},function(e,t,n){"use strict";(function(t){var n=t.BlobBuilder||t.WebKitBlobBuilder||t.MSBlobBuilder||t.MozBlobBuilder,r=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),o=r&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),i=n&&n.prototype.append&&n.prototype.getBlob;function s(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.buffer instanceof ArrayBuffer){var r=n.buffer;if(n.byteLength!==r.byteLength){var o=new Uint8Array(n.byteLength);o.set(new Uint8Array(r,n.byteOffset,n.byteLength)),r=o.buffer}e[t]=r}}}function a(e,t){t=t||{};var r=new n;s(e);for(var o=0;o<e.length;o++)r.append(e[o]);return t.type?r.getBlob(t.type):r.getBlob()}function c(e,t){return s(e),new Blob(e,t||{})}e.exports=r?o?t.Blob:c:i?a:void 0}).call(this,n(0))},function(e,t,n){"use strict";!function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<e.length;r++)n[e.charCodeAt(r)]=r;t.encode=function(t){var n,r=new Uint8Array(t),o=r.length,i="";for(n=0;n<o;n+=3)i+=e[r[n]>>2],i+=e[(3&r[n])<<4|r[n+1]>>4],i+=e[(15&r[n+1])<<2|r[n+2]>>6],i+=e[63&r[n+2]];return o%3==2?i=i.substring(0,i.length-1)+"=":o%3==1&&(i=i.substring(0,i.length-2)+"=="),i},t.decode=function(e){var t,r,o,i,s,a=.75*e.length,c=e.length,u=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var l=new ArrayBuffer(a),f=new Uint8Array(l);for(t=0;t<c;t+=4)r=n[e.charCodeAt(t)],o=n[e.charCodeAt(t+1)],i=n[e.charCodeAt(t+2)],s=n[e.charCodeAt(t+3)],f[u++]=r<<2|o>>4,f[u++]=(15&o)<<4|i>>2,f[u++]=(3&i)<<6|63&s;return l}}()},function(e,t,n){"use strict";(function(e,r){var o,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(s){var a="object"==i(t)&&t,c="object"==i(e)&&e&&e.exports==a&&e,u="object"==(void 0===r?"undefined":i(r))&&r;u.global!==u&&u.window!==u||(s=u);var l,f,h,p=String.fromCharCode;function d(e){for(var t,n,r=[],o=0,i=e.length;o<i;)(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<i?56320==(64512&(n=e.charCodeAt(o++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),o--):r.push(t);return r}function y(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function g(e,t){return p(e>>t&63|128)}function v(e,t){if(0==(4294967168&e))return p(e);var n="";return 0==(4294965248&e)?n=p(e>>6&31|192):0==(4294901760&e)?(y(e,t)||(e=65533),n=p(e>>12&15|224),n+=g(e,6)):0==(4292870144&e)&&(n=p(e>>18&7|240),n+=g(e,12),n+=g(e,6)),n+=p(63&e|128)}function m(){if(h>=f)throw Error("Invalid byte index");var e=255&l[h];if(h++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function b(e){var t,n;if(h>f)throw Error("Invalid byte index");if(h==f)return!1;if(t=255&l[h],h++,0==(128&t))return t;if(192==(224&t)){if((n=(31&t)<<6|m())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&t)){if((n=(15&t)<<12|m()<<6|m())>=2048)return y(n,e)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(n=(7&t)<<18|m()<<12|m()<<6|m())>=65536&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}var _={version:"2.1.2",encode:function(e,t){for(var n=!1!==(t=t||{}).strict,r=d(e),o=r.length,i=-1,s="";++i<o;)s+=v(r[i],n);return s},decode:function(e,t){var n=!1!==(t=t||{}).strict;l=d(e),f=l.length,h=0;for(var r,o=[];!1!==(r=b(n));)o.push(r);return function(e){for(var t,n=e.length,r=-1,o="";++r<n;)(t=e[r])>65535&&(o+=p((t-=65536)>>>10&1023|55296),t=56320|1023&t),o+=p(t);return o}(o)}};if("object"==i(n(45))&&n(45))void 0===(o=function(){return _}.call(t,n,t,e))||(e.exports=o);else if(a&&!a.nodeType)if(c)c.exports=_;else{var w={}.hasOwnProperty;for(var C in _)w.call(_,C)&&(a[C]=_[C])}else s.utf8=_}(void 0)}).call(this,n(15)(e),n(0))},function(e,t,n){"use strict";function r(){}e.exports=function(e,t,n){var o=!1;return n=n||r,i.count=e,0===e?t():i;function i(e,r){if(i.count<=0)throw new Error("after called too many times");--i.count,e?(o=!0,t(e),t=n):0!==i.count||o||t(null,r)}}},function(e,t,n){"use strict";e.exports=function(e,t,n){var r=e.byteLength;if(t=t||0,n=n||r,e.slice)return e.slice(t,n);if(t<0&&(t+=r),n<0&&(n+=r),n>r&&(n=r),t>=r||t>=n||0===r)return new ArrayBuffer(0);for(var o=new Uint8Array(e),i=new Uint8Array(n-t),s=t,a=0;s<n;s++,a++)i[a]=o[s];return i.buffer}},function(e,t,n){"use strict";var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,n){"use strict";e.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t}},function(e,t,n){"use strict";(function(t){var r=n(24),o=n(47),i=n(8),s=n(16),a=n(3)("engine.io-client:polling-xhr");function c(){}function u(e){if(o.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,t.location){var n="https:"===location.protocol,r=location.port;r||(r=n?443:80),this.xd=e.hostname!==t.location.hostname||r!==e.port,this.xs=e.secure!==n}}function l(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function f(){for(var e in l.requests)l.requests.hasOwnProperty(e)&&l.requests[e].abort()}e.exports=u,e.exports.Request=l,s(u,o),u.prototype.supportsBinary=!0,u.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new l(e)},u.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:n}),o=this;r.on("success",t),r.on("error",function(e){o.onError("xhr post error",e)}),this.sendXhr=r},u.prototype.doPoll=function(){a("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},i(l.prototype),l.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var n=this.xhr=new r(e),o=this;try{a("xhr open %s: %s",this.method,this.uri),n.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var i in n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&n.setRequestHeader(i,this.extraHeaders[i])}catch(e){}if("POST"===this.method)try{this.isBinary?n.setRequestHeader("Content-type","application/octet-stream"):n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{n.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in n&&(n.withCredentials=!0),this.requestTimeout&&(n.timeout=this.requestTimeout),this.hasXDR()?(n.onload=function(){o.onLoad()},n.onerror=function(){o.onError(n.responseText)}):n.onreadystatechange=function(){if(2===n.readyState)try{var e=n.getResponseHeader("Content-Type");o.supportsBinary&&"application/octet-stream"===e&&(n.responseType="arraybuffer")}catch(e){}4===n.readyState&&(200===n.status||1223===n.status?o.onLoad():setTimeout(function(){o.onError(n.status)},0))},a("xhr data %s",this.data),n.send(this.data)}catch(e){return void setTimeout(function(){o.onError(e)},0)}t.document&&(this.index=l.requestsCount++,l.requests[this.index]=this)},l.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},l.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},l.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},l.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,e)try{this.xhr.abort()}catch(e){}t.document&&delete l.requests[this.index],this.xhr=null}},l.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},l.prototype.hasXDR=function(){return void 0!==t.XDomainRequest&&!this.xs&&this.enablesXDR},l.prototype.abort=function(){this.cleanup()},l.requestsCount=0,l.requests={},t.document&&(t.attachEvent?t.attachEvent("onunload",f):t.addEventListener&&t.addEventListener("beforeunload",f,!1))}).call(this,n(0))},function(e,t,n){"use strict";try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},function(e,t,n){"use strict";(function(t){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(48),i=n(8),s=n(3)("engine.io-client:socket"),a=n(43),c=n(7),u=n(52),l=n(17);function f(e,n){if(!(this instanceof f))return new f(e,n);n=n||{},e&&"object"===(void 0===e?"undefined":r(e))&&(n=e,e=null),e?(e=u(e),n.hostname=e.host,n.secure="https"===e.protocol||"wss"===e.protocol,n.port=e.port,e.query&&(n.query=e.query)):n.host&&(n.hostname=u(n.host).host),this.secure=null!=n.secure?n.secure:t.location&&"https:"===location.protocol,n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.agent=n.agent||!1,this.hostname=n.hostname||(t.location?location.hostname:"localhost"),this.port=n.port||(t.location&&location.port?location.port:this.secure?443:80),this.query=n.query||{},"string"==typeof this.query&&(this.query=l.decode(this.query)),this.upgrade=!1!==n.upgrade,this.path=(n.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!n.forceJSONP,this.jsonp=!1!==n.jsonp,this.forceBase64=!!n.forceBase64,this.enablesXDR=!!n.enablesXDR,this.timestampParam=n.timestampParam||"t",this.timestampRequests=n.timestampRequests,this.transports=n.transports||["polling","websocket"],this.transportOptions=n.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=n.policyPort||843,this.rememberUpgrade=n.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=n.onlyBinaryUpgrades,this.perMessageDeflate=!1!==n.perMessageDeflate&&(n.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=n.pfx||null,this.key=n.key||null,this.passphrase=n.passphrase||null,this.cert=n.cert||null,this.ca=n.ca||null,this.ciphers=n.ciphers||null,this.rejectUnauthorized=void 0===n.rejectUnauthorized||n.rejectUnauthorized,this.forceNode=!!n.forceNode;var o="object"===(void 0===t?"undefined":r(t))&&t;o.global===o&&(n.extraHeaders&&Object.keys(n.extraHeaders).length>0&&(this.extraHeaders=n.extraHeaders),n.localAddress&&(this.localAddress=n.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}e.exports=f,f.priorWebsocketSuccess=!1,i(f.prototype),f.protocol=c.protocol,f.Socket=f,f.Transport=n(23),f.transports=n(48),f.parser=n(7),f.prototype.createTransport=function(e){s('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);t.EIO=c.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new o[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0})},f.prototype.open=function(){var e;if(this.rememberUpgrade&&f.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},f.prototype.setTransport=function(e){s("setting transport %s",e.name);var t=this;this.transport&&(s("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},f.prototype.probe=function(e){s('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,r=this;function o(){if(r.onlyBinaryUpgrades){var o=!this.supportsBinary&&r.transport.supportsBinary;n=n||o}n||(s('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(o){if(!n)if("pong"===o.type&&"probe"===o.data){if(s('probe transport "%s" pong',e),r.upgrading=!0,r.emit("upgrading",t),!t)return;f.priorWebsocketSuccess="websocket"===t.name,s('pausing current transport "%s"',r.transport.name),r.transport.pause(function(){n||"closed"!==r.readyState&&(s("changing transport and sending upgrade packet"),h(),r.setTransport(t),t.send([{type:"upgrade"}]),r.emit("upgrade",t),t=null,r.upgrading=!1,r.flush())})}else{s('probe transport "%s" failed',e);var i=new Error("probe error");i.transport=t.name,r.emit("upgradeError",i)}}))}function i(){n||(n=!0,h(),t.close(),t=null)}function a(n){var o=new Error("probe error: "+n);o.transport=t.name,i(),s('probe transport "%s" failed because of error: %s',e,n),r.emit("upgradeError",o)}function c(){a("transport closed")}function u(){a("socket closed")}function l(e){t&&e.name!==t.name&&(s('"%s" works - aborting "%s"',e.name,t.name),i())}function h(){t.removeListener("open",o),t.removeListener("error",a),t.removeListener("close",c),r.removeListener("close",u),r.removeListener("upgrading",l)}f.priorWebsocketSuccess=!1,t.once("open",o),t.once("error",a),t.once("close",c),this.once("close",u),this.once("upgrading",l),t.open()},f.prototype.onOpen=function(){if(s("socket open"),this.readyState="open",f.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){s("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},f.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(s('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else s('packet received with socket readyState "%s"',this.readyState)},f.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},f.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},f.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){s("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},f.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},f.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},f.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(s("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},f.prototype.write=f.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},f.prototype.sendPacket=function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var o={type:e,data:t,options:n};this.emit("packetCreate",o),this.writeBuffer.push(o),r&&this.once("flush",r),this.flush()}},f.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():t()}):this.upgrading?r():t()}function t(){e.onClose("forced close"),s("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function r(){e.once("upgrade",n),e.once("upgradeError",n)}return this},f.prototype.onError=function(e){s("socket error %j",e),f.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},f.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){s('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},f.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;n<r;n++)~a(this.transports,e[n])&&t.push(e[n]);return t}}).call(this,n(0))},function(e,t,n){"use strict";e.exports=n(177),e.exports.parser=n(7)},function(e,t,n){"use strict";(function(e){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(51),i=n(50),s=Object.prototype.toString,a="function"==typeof e.Blob||"[object BlobConstructor]"===s.call(e.Blob),c="function"==typeof e.File||"[object FileConstructor]"===s.call(e.File);t.deconstructPacket=function(e){var t=[],n=e.data,s=e;return s.data=function e(t,n){if(!t)return t;if(i(t)){var s={_placeholder:!0,num:n.length};return n.push(t),s}if(o(t)){for(var a=new Array(t.length),c=0;c<t.length;c++)a[c]=e(t[c],n);return a}if("object"===(void 0===t?"undefined":r(t))&&!(t instanceof Date)){var a={};for(var u in t)a[u]=e(t[u],n);return a}return t}(n,t),s.attachments=t.length,{packet:s,buffers:t}},t.reconstructPacket=function(e,t){return e.data=function e(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(o(t))for(var i=0;i<t.length;i++)t[i]=e(t[i],n);else if("object"===(void 0===t?"undefined":r(t)))for(var s in t)t[s]=e(t[s],n);return t}(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(e,t){var n=0,s=e;!function e(u,l,f){if(!u)return u;if(a&&u instanceof Blob||c&&u instanceof File){n++;var h=new FileReader;h.onload=function(){f?f[l]=this.result:s=this.result,--n||t(s)},h.readAsArrayBuffer(u)}else if(o(u))for(var p=0;p<u.length;p++)e(u[p],p,u);else if("object"===(void 0===u?"undefined":r(u))&&!i(u))for(var d in u)e(u[d],d,u)}(s),n||t(s)}}).call(this,n(0))},function(e,t,n){"use strict";(function(t){var r=n(52),o=n(3)("socket.io-client:url");e.exports=function(e,n){var i=e;n=n||t.location,null==e&&(e=n.protocol+"//"+n.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(o("protocol-less url %s",e),e=void 0!==n?n.protocol+"//"+e:"https://"+e),o("parse %s",e),i=r(e));i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443"));i.path=i.path||"/";var s=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+s+":"+i.port,i.href=i.protocol+"://"+s+(n&&n.port===i.port?"":":"+i.port),i}}).call(this,n(0))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(27),i=n(3)("foglet-core:media"),s=n(63),a=n(28),c=n(5),u=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"foglet-media-unicast-protocol-"+n));return r.options={retry:1},r._activeMedia=new Map,r._broadcast=new s(e,n+"-stream-broadcast-internal"),r._broadcast.on("receive",function(e,t){r._receiveBroadcast(e,t)}),r._unicast=new a(e,n+"-stream-unicast-internal"),r._unicast.on("receive",function(e,t){r._receiveUnicast(e,t)}),r.NI=r._source.rps.NI,r.NO=r._source.rps.NO,r._source.rps.on("open",function(e){r._checkStreamConnect(e)}),r._source.rps.on("close",function(e){r._checkStreamDisconnect(e)}),r.i=r._source.rps.i,r.o=r._source.rps.o,r._source.rps.on("stream",function(e,t){r._receive(e,t)}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"_checkStreamConnect",value:function(e){}},{key:"_checkStreamDisconnect",value:function(e){}},{key:"_receiveUnicast",value:function(e,t){}},{key:"_receiveBroadcast",value:function(e,t){}},{key:"sendUnicast",value:function(e,t){return t.id||(t.id=c()),this._activeMedia.has(t.id)||(this._activeMedia.set(t.id,t),this._setListeners(t)),this._send(e,t,this.options.retry)}},{key:"sendBroadcast",value:function(e,t){return console.log(t),t.id||(t.id=c()),this._activeMedia.has(t.id)||(this._activeMedia.set(t.id,t),this._setListeners(t)),this._send(e,t,this.options.retry)}},{key:"_send",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.retry;return this.i.has(e)?this._sendBis(this.pid,e,t,r,this.NI):this.o.has(e)?this._sendBis(this.pid,e,t,r,this.NO):new Promise(function(o,i){!function s(a){n._sendBis(n.pid,e,t,r,n.NO).then(function(){o()}).catch(function(c){n._sendBis(n.pid,e,t,r,n.NI).then(function(){o()}).catch(function(e){a<r?setTimeout(function(){s(a+1)},1e3):i(e)})})}(0)})}},{key:"_sendBis",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments[4];return new Promise(function(s,a){var c=null;o.living.contains(t)?c=o.living.get(t):o.dying.has(t)&&(c=o.dying.get(t));!function u(l){try{console.log("sending:",c.socket,n),c.socket.addStream(n),i("[%s][%s] --- MEDIA msg --\x3e %s:%s",e,o.PEER,t,e),s()}catch(n){i("[%s][%s] -X- MEDIA msg -X> %s:%s",e,o.PEER,t,e),l<r?setTimeout(function(){u(l+1)},1e3):a(n)}}(0)})}},{key:"_receive",value:function(e,t){i("Receive a media stream: ",e,t),t.id||(t.id=c()),this._activeMedia.has(t.id)||(this._activeMedia.set(t.id,{peer:e,stream:t}),this._setListeners(t)),this.emit("receive",e,t)}},{key:"_setListeners",value:function(e){var t=this;e.onactive=function(){console.log("Media %s is active...",e.id)},e.oninactive=function(){console.log("Media %s is inactive...",e.id),t._sendRequest(e.id)},e.onended=function(){console.log("Media %s is finished...",e.id)}}},{key:"pid",get:function(){return this._source.rps._pid()}}]),t}();e.exports=u},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(26).PassThrough,i=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{objectMode:!0}));return e._trailers=null,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"trailers",get:function(){return this._trailers}}]),t}();e.exports=i},function(e,t,n){"use strict";var r=function(e){return function(t,n){return{id:t,type:e,payload:n}}},o=r("chunk"),i=r("trailers"),s=r("end"),a=r("error");e.exports={StreamMessageChunk:o,StreamMessageTrailers:i,StreamMessageEnd:s,StreamMessageError:a}},function(e,t,n){"use strict";e.exports=i;var r=n(55),o=n(13);function i(e){if(!(this instanceof i))return new i(e);r.call(this,e)}o.inherits=n(10),o.inherits(i,r),i.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){"use strict";(function(t){function n(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(this,n(0))},function(e,t,n){"use strict";(function(e,t){!function(e,n){if(!e.setImmediate){var r,o,i,s,a,c=1,u={},l=!1,f=e.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(e);h=h&&h.setTimeout?h:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick(function(){d(e)})}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((i=new MessageChannel).port1.onmessage=function(e){d(e.data)},r=function(e){i.port2.postMessage(e)}):f&&"onreadystatechange"in f.createElement("script")?(o=f.documentElement,r=function(e){var t=f.createElement("script");t.onreadystatechange=function(){d(e),t.onreadystatechange=null,o.removeChild(t),t=null},o.appendChild(t)}):r=function(e){setTimeout(d,0,e)}:(s="setImmediate$"+Math.random()+"$",a=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(s)&&d(+t.data.slice(s.length))},e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),r=function(t){e.postMessage(s+t,"*")}),h.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var o={callback:e,args:t};return u[c]=o,r(c),c++},h.clearImmediate=p}function p(e){delete u[e]}function d(e){if(l)setTimeout(d,0,e);else{var t=u[e];if(t){l=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}(t)}finally{p(e),l=!1}}}}}("undefined"==typeof self?void 0===e?void 0:e:self)}).call(this,n(0),n(4))},function(e,t,n){"use strict";(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,o=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(o.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new i(o.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(186),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||void 0,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||void 0}).call(this,n(0))},function(e,t){},function(e,t,n){"use strict";var r=n(14).Buffer,o=n(188);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t,n,o,i=r.allocUnsafe(e>>>0),s=this.head,a=0;s;)t=s.data,n=i,o=a,t.copy(n,o),a+=s.data.length,s=s.next;return i},e}(),o&&o.inspect&&o.inspect.custom&&(e.exports.prototype[o.inspect.custom]=function(){var e=o.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,n){"use strict";t.read=function(e,t,n,r,o){var i,s,a=8*o-r-1,c=(1<<a)-1,u=c>>1,l=-7,f=n?o-1:0,h=n?-1:1,p=e[t+f];for(f+=h,i=p&(1<<-l)-1,p>>=-l,l+=a;l>0;i=256*i+e[t+f],f+=h,l-=8);for(s=i&(1<<-l)-1,i>>=-l,l+=r;l>0;s=256*s+e[t+f],f+=h,l-=8);if(0===i)i=1-u;else{if(i===c)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),i-=u}return(p?-1:1)*s*Math.pow(2,i-r)},t.write=function(e,t,n,r,o,i){var s,a,c,u=8*i-o-1,l=(1<<u)-1,f=l>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:i-1,d=r?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+f>=1?h/c:h*Math.pow(2,1-f))*c>=2&&(s++,c/=2),s+f>=l?(a=0,s=l):s+f>=1?(a=(t*c-1)*Math.pow(2,o),s+=f):(a=t*Math.pow(2,f-1)*Math.pow(2,o),s=0));o>=8;e[n+p]=255&a,p+=d,a/=256,o-=8);for(s=s<<o|a,u+=o;u>0;e[n+p]=255&s,p+=d,s/=256,u-=8);e[n+p-d]|=128*y}},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){for(var t,n=u(e),r=n[0],s=n[1],a=new i(function(e,t,n){return 3*(t+n)/4-n}(0,r,s)),c=0,l=s>0?r-4:r,f=0;f<l;f+=4)t=o[e.charCodeAt(f)]<<18|o[e.charCodeAt(f+1)]<<12|o[e.charCodeAt(f+2)]<<6|o[e.charCodeAt(f+3)],a[c++]=t>>16&255,a[c++]=t>>8&255,a[c++]=255&t;2===s&&(t=o[e.charCodeAt(f)]<<2|o[e.charCodeAt(f+1)]>>4,a[c++]=255&t);1===s&&(t=o[e.charCodeAt(f)]<<10|o[e.charCodeAt(f+1)]<<4|o[e.charCodeAt(f+2)]>>2,a[c++]=t>>8&255,a[c++]=255&t);return a},t.fromByteArray=function(e){for(var t,n=e.length,o=n%3,i=[],s=0,a=n-o;s<a;s+=16383)i.push(l(e,s,s+16383>a?a:s+16383));1===o?(t=e[n-1],i.push(r[t>>2]+r[t<<4&63]+"==")):2===o&&(t=(e[n-2]<<8)+e[n-1],i.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return i.join("")};for(var r=[],o=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)r[a]=s[a],o[s.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var o,i,s=[],a=t;a<n;a+=3)o=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[(i=o)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(5),i=n(26).Writable,s=n(183),a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{objectMode:!0}));return n._id=o(),n._send=e,n._trailers=[],n._last_id=void 0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"addTrailer",value:function(e){this._trailers.push(e)}},{key:"destroy",value:function(e){this._last_id=this._send(s.StreamMessageError(this._id,e),null,this._last_id),function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this,e)}},{key:"_write",value:function(e,t,n){return this._last_id=this._send(s.StreamMessageChunk(this._id,e),null,this._last_id),n(),this._last_id}},{key:"_final",value:function(e){this._trailers.length>0&&(this._last_id=this._send(s.StreamMessageTrailers(this._id,this._trailers),null,this._last_id)),this._last_id=this._send(s.StreamMessageEnd(this._id),null,this._last_id),e()}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._middlewares=[]}return r(e,[{key:"register",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!("in"in e||"out"in e))throw new Error('A middleware must contains two functions: "in" and "out"');this._middlewares.push({middleware:e,priority:t}),this._middlewares.sort(function(e,t){return e.priority-t.priority})}},{key:"in",value:function(e){var t=void 0;return this._middlewares.reduce(function(e,n){return void 0!==(t=n.middleware.in(e))||null!==t?t:e},e)}},{key:"out",value:function(e){var t=void 0;return this._middlewares.reduce(function(e,n){return void 0!==(t=n.middleware.out(e))||null!==t?t:e},e)}}]),e}();e.exports=o},function(e,t,n){"use strict";function r(e){var n;function r(){if(r.enabled){var e=r,o=+new Date,i=o-(n||o);e.diff=i,e.prev=n,e.curr=o,n=o;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var o=t.formatters[r];if("function"==typeof o){var i=s[c];n=o.call(e,i),s.splice(c,1),c--}return n}),t.formatArgs.call(e,s),(r.log||t.log||console.log.bind(console)).apply(e,s)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),r.destroy=o,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function o(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var i=t.instances[n];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(11),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t,n){"use strict";(function(e,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=200,i="Expected a function",s="__lodash_hash_undefined__",a=1,c=2,u=1/0,l=9007199254740991,f=4294967294,h="[object Arguments]",p="[object Array]",d="[object Boolean]",y="[object Date]",g="[object Error]",v="[object Function]",m="[object GeneratorFunction]",b="[object Map]",_="[object Number]",w="[object Object]",C="[object RegExp]",k="[object Set]",E="[object String]",S="[object Symbol]",O="[object ArrayBuffer]",x="[object DataView]",A=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,T=/^\w*$/,j=/^\./,P=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,R=/\\(\\)?/g,M=/^\[object .+?Constructor\]$/,I=/^(?:0|[1-9]\d*)$/,F={};F["[object Float32Array]"]=F["[object Float64Array]"]=F["[object Int8Array]"]=F["[object Int16Array]"]=F["[object Int32Array]"]=F["[object Uint8Array]"]=F["[object Uint8ClampedArray]"]=F["[object Uint16Array]"]=F["[object Uint32Array]"]=!0,F[h]=F[p]=F[O]=F[d]=F[x]=F[y]=F[g]=F[v]=F[b]=F[_]=F[w]=F[C]=F[k]=F[E]=F["[object WeakMap]"]=!1;var N="object"==(void 0===e?"undefined":r(e))&&e&&e.Object===Object&&e,D="object"==("undefined"==typeof self?"undefined":r(self))&&self&&self.Object===Object&&self,B=N||D||Function("return this")(),L="object"==r(t)&&t&&!t.nodeType&&t,U=L&&"object"==r(n)&&n&&!n.nodeType&&n,q=U&&U.exports===L&&N.process,z=function(){try{return q&&q.binding("util")}catch(e){}}(),V=z&&z.isTypedArray;function W(e,t){for(var n=-1,r=e?e.length:0;++n<r;)if(t(e[n],n,e))return!0;return!1}function J(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function H(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function $(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var Y,Q,X,G=Array.prototype,Z=Function.prototype,K=Object.prototype,ee=B["__core-js_shared__"],te=(Y=/[^.]+$/.exec(ee&&ee.keys&&ee.keys.IE_PROTO||""))?"Symbol(src)_1."+Y:"",ne=Z.toString,re=K.hasOwnProperty,oe=K.toString,ie=RegExp("^"+ne.call(re).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),se=B.Symbol,ae=B.Uint8Array,ce=K.propertyIsEnumerable,ue=G.splice,le=Math.floor,fe=(Q=Object.keys,X=Object,function(e){return Q(X(e))}),he=Math.min,pe=Ve(B,"DataView"),de=Ve(B,"Map"),ye=Ve(B,"Promise"),ge=Ve(B,"Set"),ve=Ve(B,"WeakMap"),me=Ve(Object,"create"),be=Ge(pe),_e=Ge(de),we=Ge(ye),Ce=Ge(ge),ke=Ge(ve),Ee=se?se.prototype:void 0,Se=Ee?Ee.valueOf:void 0,Oe=Ee?Ee.toString:void 0;function xe(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ae(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Te(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function je(e){var t=-1,n=e?e.length:0;for(this.__data__=new Te;++t<n;)this.add(e[t])}function Pe(e){this.__data__=new Ae(e)}function Re(e,t){var n=tt(e)||et(e)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],r=n.length,o=!!r;for(var i in e)!t&&!re.call(e,i)||o&&("length"==i||Je(i,r))||n.push(i);return n}function Me(e,t){for(var n=e.length;n--;)if(Ke(e[n][0],t))return n;return-1}function Ie(e,t){for(var n=0,r=(t=He(t,e)?[t]:Ue(t)).length;null!=e&&n<r;)e=e[Xe(t[n++])];return n&&n==r?e:void 0}function Fe(e,t){return null!=e&&t in Object(e)}function Ne(e,t,n,r,o){return e===t||(null==e||null==t||!it(e)&&!st(t)?e!=e&&t!=t:function(e,t,n,r,o,i){var s=tt(e),u=tt(t),l=p,f=p;s||(l=(l=We(e))==h?w:l);u||(f=(f=We(t))==h?w:f);var v=l==w&&!J(e),m=f==w&&!J(t),A=l==f;if(A&&!v)return i||(i=new Pe),s||ct(e)?qe(e,t,n,r,o,i):function(e,t,n,r,o,i,s){switch(n){case x:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case O:return!(e.byteLength!=t.byteLength||!r(new ae(e),new ae(t)));case d:case y:case _:return Ke(+e,+t);case g:return e.name==t.name&&e.message==t.message;case C:case E:return e==t+"";case b:var u=H;case k:var l=i&c;if(u||(u=$),e.size!=t.size&&!l)return!1;var f=s.get(e);if(f)return f==t;i|=a,s.set(e,t);var h=qe(u(e),u(t),r,o,i,s);return s.delete(e),h;case S:if(Se)return Se.call(e)==Se.call(t)}return!1}(e,t,l,n,r,o,i);if(!(o&c)){var T=v&&re.call(e,"__wrapped__"),j=m&&re.call(t,"__wrapped__");if(T||j){var P=T?e.value():e,R=j?t.value():t;return i||(i=new Pe),n(P,R,r,o,i)}}if(!A)return!1;return i||(i=new Pe),function(e,t,n,r,o,i){var s=o&c,a=ut(e),u=a.length,l=ut(t).length;if(u!=l&&!s)return!1;for(var f=u;f--;){var h=a[f];if(!(s?h in t:re.call(t,h)))return!1}var p=i.get(e);if(p&&i.get(t))return p==t;var d=!0;i.set(e,t),i.set(t,e);for(var y=s;++f<u;){h=a[f];var g=e[h],v=t[h];if(r)var m=s?r(v,g,h,t,e,i):r(g,v,h,e,t,i);if(!(void 0===m?g===v||n(g,v,r,o,i):m)){d=!1;break}y||(y="constructor"==h)}if(d&&!y){var b=e.constructor,_=t.constructor;b!=_&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof _&&_ instanceof _)&&(d=!1)}return i.delete(e),i.delete(t),d}(e,t,n,r,o,i)}(e,t,Ne,n,r,o))}function De(e){return!(!it(e)||te&&te in e)&&(rt(e)||J(e)?ie:M).test(Ge(e))}function Be(e){return"function"==typeof e?e:null==e?lt:"object"==(void 0===e?"undefined":r(e))?tt(e)?function(e,t){if(He(e)&&$e(t))return Ye(Xe(e),t);return function(n){var r=function(e,t,n){var r=null==e?void 0:Ie(e,t);return void 0===r?n:r}(n,e);return void 0===r&&r===t?function(e,t){return null!=e&&function(e,t,n){var r,o=-1,i=(t=He(t,e)?[t]:Ue(t)).length;for(;++o<i;){var s=Xe(t[o]);if(!(r=null!=e&&n(e,s)))break;e=e[s]}if(r)return r;return!!(i=e?e.length:0)&&ot(i)&&Je(s,i)&&(tt(e)||et(e))}(e,t,Fe)}(n,e):Ne(t,r,void 0,a|c)}}(e[0],e[1]):function(e){var t=function(e){var t=ut(e),n=t.length;for(;n--;){var r=t[n],o=e[r];t[n]=[r,o,$e(o)]}return t}(e);if(1==t.length&&t[0][2])return Ye(t[0][0],t[0][1]);return function(n){return n===e||function(e,t,n,r){var o=n.length,i=o,s=!r;if(null==e)return!i;for(e=Object(e);o--;){var u=n[o];if(s&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++o<i;){var l=(u=n[o])[0],f=e[l],h=u[1];if(s&&u[2]){if(void 0===f&&!(l in e))return!1}else{var p=new Pe;if(r)var d=r(f,h,l,e,t,p);if(!(void 0===d?Ne(h,f,r,a|c,p):d))return!1}}return!0}(n,e,t)}}(e):He(t=e)?(n=Xe(t),function(e){return null==e?void 0:e[n]}):function(e){return function(t){return Ie(t,e)}}(t);var t,n}function Le(e){if(n=(t=e)&&t.constructor,r="function"==typeof n&&n.prototype||K,t!==r)return fe(e);var t,n,r,o=[];for(var i in Object(e))re.call(e,i)&&"constructor"!=i&&o.push(i);return o}function Ue(e){return tt(e)?e:Qe(e)}function qe(e,t,n,r,o,i){var s=o&c,u=e.length,l=t.length;if(u!=l&&!(s&&l>u))return!1;var f=i.get(e);if(f&&i.get(t))return f==t;var h=-1,p=!0,d=o&a?new je:void 0;for(i.set(e,t),i.set(t,e);++h<u;){var y=e[h],g=t[h];if(r)var v=s?r(g,y,h,t,e,i):r(y,g,h,e,t,i);if(void 0!==v){if(v)continue;p=!1;break}if(d){if(!W(t,function(e,t){if(!d.has(t)&&(y===e||n(y,e,r,o,i)))return d.add(t)})){p=!1;break}}else if(y!==g&&!n(y,g,r,o,i)){p=!1;break}}return i.delete(e),i.delete(t),p}function ze(e,t){var n,o,i=e.__data__;return("string"==(o=void 0===(n=t)?"undefined":r(n))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function Ve(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return De(n)?n:void 0}xe.prototype.clear=function(){this.__data__=me?me(null):{}},xe.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},xe.prototype.get=function(e){var t=this.__data__;if(me){var n=t[e];return n===s?void 0:n}return re.call(t,e)?t[e]:void 0},xe.prototype.has=function(e){var t=this.__data__;return me?void 0!==t[e]:re.call(t,e)},xe.prototype.set=function(e,t){return this.__data__[e]=me&&void 0===t?s:t,this},Ae.prototype.clear=function(){this.__data__=[]},Ae.prototype.delete=function(e){var t=this.__data__,n=Me(t,e);return!(n<0||(n==t.length-1?t.pop():ue.call(t,n,1),0))},Ae.prototype.get=function(e){var t=this.__data__,n=Me(t,e);return n<0?void 0:t[n][1]},Ae.prototype.has=function(e){return Me(this.__data__,e)>-1},Ae.prototype.set=function(e,t){var n=this.__data__,r=Me(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},Te.prototype.clear=function(){this.__data__={hash:new xe,map:new(de||Ae),string:new xe}},Te.prototype.delete=function(e){return ze(this,e).delete(e)},Te.prototype.get=function(e){return ze(this,e).get(e)},Te.prototype.has=function(e){return ze(this,e).has(e)},Te.prototype.set=function(e,t){return ze(this,e).set(e,t),this},je.prototype.add=je.prototype.push=function(e){return this.__data__.set(e,s),this},je.prototype.has=function(e){return this.__data__.has(e)},Pe.prototype.clear=function(){this.__data__=new Ae},Pe.prototype.delete=function(e){return this.__data__.delete(e)},Pe.prototype.get=function(e){return this.__data__.get(e)},Pe.prototype.has=function(e){return this.__data__.has(e)},Pe.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Ae){var r=n.__data__;if(!de||r.length<o-1)return r.push([e,t]),this;n=this.__data__=new Te(r)}return n.set(e,t),this};var We=function(e){return oe.call(e)};function Je(e,t){return!!(t=null==t?l:t)&&("number"==typeof e||I.test(e))&&e>-1&&e%1==0&&e<t}function He(e,t){if(tt(e))return!1;var n=void 0===e?"undefined":r(e);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!at(e))||(T.test(e)||!A.test(e)||null!=t&&e in Object(t))}function $e(e){return e==e&&!it(e)}function Ye(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}}(pe&&We(new pe(new ArrayBuffer(1)))!=x||de&&We(new de)!=b||ye&&"[object Promise]"!=We(ye.resolve())||ge&&We(new ge)!=k||ve&&"[object WeakMap]"!=We(new ve))&&(We=function(e){var t=oe.call(e),n=t==w?e.constructor:void 0,r=n?Ge(n):void 0;if(r)switch(r){case be:return x;case _e:return b;case we:return"[object Promise]";case Ce:return k;case ke:return"[object WeakMap]"}return t});var Qe=Ze(function(e){var t;e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(at(e))return Oe?Oe.call(e):"";var t=e+"";return"0"==t&&1/e==-u?"-0":t}(t);var n=[];return j.test(e)&&n.push(""),e.replace(P,function(e,t,r,o){n.push(r?o.replace(R,"$1"):t||e)}),n});function Xe(e){if("string"==typeof e||at(e))return e;var t=e+"";return"0"==t&&1/e==-u?"-0":t}function Ge(e){if(null!=e){try{return ne.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ze(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError(i);var n=function n(){var r=arguments,o=t?t.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var s=e.apply(this,r);return n.cache=i.set(o,s),s};return n.cache=new(Ze.Cache||Te),n}function Ke(e,t){return e===t||e!=e&&t!=t}function et(e){return function(e){return st(e)&&nt(e)}(e)&&re.call(e,"callee")&&(!ce.call(e,"callee")||oe.call(e)==h)}Ze.Cache=Te;var tt=Array.isArray;function nt(e){return null!=e&&ot(e.length)&&!rt(e)}function rt(e){var t=it(e)?oe.call(e):"";return t==v||t==m}function ot(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=l}function it(e){var t=void 0===e?"undefined":r(e);return!!e&&("object"==t||"function"==t)}function st(e){return!!e&&"object"==(void 0===e?"undefined":r(e))}function at(e){return"symbol"==(void 0===e?"undefined":r(e))||st(e)&&oe.call(e)==S}var ct=V?function(e){return function(t){return e(t)}}(V):function(e){return st(e)&&ot(e.length)&&!!F[oe.call(e)]};function ut(e){return nt(e)?Re(e):Le(e)}function lt(e){return e}n.exports=function(e,t,n){return function(e,t,n,r){t=n(t);for(var o=0,i=e?e.length:0,s=t!=t,a=null===t,c=at(t),u=void 0===t;o<i;){var l=le((o+i)/2),h=n(e[l]),p=void 0!==h,d=null===h,y=h==h,g=at(h);if(s)var v=r||y;else v=u?y&&(r||p):a?y&&p&&(r||!d):c?y&&p&&!d&&(r||!g):!d&&!g&&(r?h<=t:h<t);v?o=l+1:i=l}return he(i,f)}(e,t,Be(n))}}).call(this,n(0),n(15)(e))},function(e,t,n){"use strict";e.exports={BroadcastMessage:function(e,t,n,r){return{protocol:e,id:t,isReady:n,payload:r}},MAntiEntropyRequest:function(e){return{type:"MAntiEntropyRequest",causality:e}},MAntiEntropyResponse:function(e,t,n,r){return{type:"MAntiEntropyResponse",id:e,causality:t,nbElements:n,element:r,elements:[]}}}},function(e,t,n){"use strict";e.exports=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.e=t,this.c=n}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.e=t,this.v=0,this.x=[]}return r(e,[{key:"increment",value:function(){this.v+=1}},{key:"incrementFrom",value:function(e){if(e<this.v){var t=this.x.indexOf(e);t>=0&&this.x.splice(t,1)}if(e===this.v+1&&(this.v+=1),e>this.v+1){for(var n=this.v+1;n<e;++n)this.x.push(n);this.v=e}}}],[{key:"comparator",value:function(e,t){var n=e.e||e,r=t.e||t;return n<r?-1:n>r?1:0}}]),e}();e.exports=o},function(e,t,n){"use strict";e.exports=function(e,t,n,r,o){var i,s;if(void 0===r)r=0;else if((r|=0)<0||r>=e.length)throw new RangeError("invalid lower bound");if(void 0===o)o=e.length-1;else if((o|=0)<r||o>=e.length)throw new RangeError("invalid upper bound");for(;r<=o;)if((s=+n(e[i=r+(o-r>>1)],t))<0)r=i+1;else{if(!(s>0))return i;o=i-1}return~r}},function(e,t,n){"use strict";e.exports=o;var r=n(200);function o(e,t){if("function"!=typeof e)throw new TypeError("comparator must be a function");this.arr=t||[],this.cmp=e}o.prototype.insert=function(e){var t=r(this.arr,e,this.cmp);t<0&&(t=~t),this.arr.splice(t,0,e)},o.prototype.indexOf=function(e){var t=r(this.arr,e,this.cmp);return t>=0?t:-1},o.prototype.remove=function(e){var t=r(this.arr,e,this.cmp);return!(t<0)&&(this.arr.splice(t,1),!0)}},function(e,t,n){"use strict";var r=n(27),o=n(28),i=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"foglet-broadcast-protocol-"+n));return r._unicast=new o(r._source,r._protocol),r._unicast.on("receive",function(e,t){r._receive(e,t)}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();e.exports=i},function(e,t,n){"use strict";e.exports=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pid=t,this.event=n,this.args=r,this.type="MUnicast"}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=1e3,i=60*o,s=60*i,a=24*s,c=365.25*a;function u(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var n,l=void 0===e?"undefined":r(e);if("string"===l&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*c;case"days":case"day":case"d":return n*a;case"hours":case"hour":case"hrs":case"hr":case"h":return n*s;case"minutes":case"minute":case"mins":case"min":case"m":return n*i;case"seconds":case"second":case"secs":case"sec":case"s":return n*o;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===l&&!1===isNaN(e))return t.long?u(n=e,a,"day")||u(n,s,"hour")||u(n,i,"minute")||u(n,o,"second")||n+" ms":function(e){if(e>=a)return Math.round(e/a)+"d";if(e>=s)return Math.round(e/s)+"h";if(e>=i)return Math.round(e/i)+"m";if(e>=o)return Math.round(e/o)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){"use strict";var r;function o(e){function n(){if(n.enabled){var e=n,o=+new Date,i=o-(r||o);e.diff=i,e.prev=r,e.curr=o,r=o;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var o=t.formatters[r];if("function"==typeof o){var i=s[c];n=o.call(e,i),s.splice(c,1),c--}return n}),t.formatArgs.call(e,s),(n.log||t.log||console.log.bind(console)).apply(e,s)}}return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),"function"==typeof t.init&&t.init(n),n}(t=e.exports=o.debug=o.default=o).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length,o=0;o<r;o++)n[o]&&("-"===(e=n[o].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(204),t.names=[],t.skips=[],t.formatters={}},function(e,t,n){"use strict";(function(r){var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(205)).log=function(){return"object"===("undefined"==typeof console?"undefined":o(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++o)}),e.splice(i,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,n(4))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(206)("unicast-definition"),i=n(2),s=n(1),a=n(203),c=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.options=s({retry:0,pid:"default-unicast"},n),r.psp=e;var i=e._receive;return e._receive=function(t,n){try{i.call(e,t,n)}catch(e){if(!n.type||"MUnicast"!==n.type||n.pid!==r.options.pid)throw e;r._emit.apply(r,[n.event].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(n.args)))}},r._emit=r.emit,r.emit=function(t,n){for(var o=arguments.length,i=Array(o>2?o-2:0),s=2;s<o;s++)i[s-2]=arguments[s];return e.send(n,new a(r.options.pid,t,i),r.options.retry)},o("just initialized on top of %s@%s.",r.psp.PID,r.psp.PEER),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"destroy",value:function(){this.removeAllListener(),this.emit=this._emit}}]),t}();e.exports=c},function(e,t,n){"use strict";var r=n(27),o=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"foglet-unicast-protocol-"+n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();e.exports=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(64),i=n(54),s=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._network=t,this._signaling=new i(t,n),this._communication=new o(t,r)}return r(e,[{key:"use",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.communication.use(e,t)}},{key:"network",get:function(){return this._network}},{key:"signaling",get:function(){return this._signaling}},{key:"communication",get:function(){return this._communication}}]),e}();e.exports=s},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(2),s=n(1),a=n(209),c=n(39),u=n(37),l=n(3)("foglet-core:network-manager"),f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._options=s({rps:{type:"spray-wrtc",options:{protocol:"spray-wrtc-communication"}},overlays:[]},e),n._rps=n._buildRPS(n._options.rps.type,n._options.rps.options),n._overlays=new Map,n._buildOverlays(n._options.overlays),l("Networks (Rps and overlays) initialized."),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),o(t,[{key:"overlay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===e?this._rps:this._overlays.get(e)}},{key:"registerMiddleware",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._rps.use(e,t),this._overlays.forEach(function(n){return n.use(e,t)})}},{key:"_buildRPS",value:function(e,t){var n=new(this._chooseRps(e,t))(t);return new a(n,t.signaling,t.protocol)}},{key:"_chooseRps",value:function(e,t){var n=null;switch(e){case"spray-wrtc":n=c;break;case"cyclon":n=u;break;case"custom":n=t.class;break;default:n=c}return n}},{key:"_buildOverlays",value:function(e){var t=this;0===e.length&&l("No overlays added, only the base RPS is available"),e.forEach(function(e){t._buildOverlay(e)})}},{key:"_buildOverlay",value:function(e){if(!("object"===(void 0===e?"undefined":r(e))&&"name"in e&&"class"in e))throw new SyntaxError("An overlay is a configuration object {name: [string], class: [function], options: [Object]}");var t=e.options;if(!("protocol"in t))throw new SyntaxError("An overlay configuration requires a protocol name, e;g. { protocol: [string] }");if("signaling"in t||l('[WARNING] no signaling server given for overlay "'+e.name+'"! Only connections from inside the same app will be allowed!'),this._overlays.has(e.name))throw new Error('An overlay with the name "'+e.name+'" has already been registered!');var n=new e.class(this,t);this._overlays.set(e.name,new a(n,t.signaling,t.protocol))}}]),t}();e.exports=f},function(e,t,n){"use strict";for(var r=[],o=0;o<256;++o)r[o]=(o+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,o=r;return o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]}},function(e,t,n){"use strict";var r="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(r){var o=new Uint8Array(16);e.exports=function(){return r(o),o}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(2),i=n(5),s=n(1),a=n(210),c=n(127),u=function(){return{verbose:!0,rps:{type:"spray-wrtc",options:{protocol:"foglet-example-rps",webrtc:{trickle:!0,iceServers:[]},timeout:6e4,pendingTimeout:6e4,delta:6e4,maxPeers:5,a:1,b:5,signaling:{address:"https://signaling.herokuapp.com/",room:"best-room-for-foglet-rps"}}},overlays:[],ssh:void 0}},l=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._options=s(u(),e),n._options.id||(n._options.id=i()),n._options.rps.options.peer=n._options.id,n._id=n._options.id,n._networkManager=new a(n._options),n._options.ssh&&n._options.ssh.address&&(n._ssh=new c({foglet:n,address:n._options.ssh.address})),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"connection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._options.pendingTimeout;return new Promise(function(o,i){null!==e?t.overlay(n).signaling.connection(e.overlay(n).network,r).then(function(e){t.emit("connect"),o(e.connected)}).catch(function(e){i(e)}):t.overlay(n).signaling.connection(null,r).then(function(e){t.emit("connect"),o(e.connected)}).catch(function(e){i(e)})})}},{key:"share",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.overlay(e).signaling.signaling()}},{key:"unshare",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.overlay(e).signaling.unsignaling()}},{key:"overlay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._networkManager.overlay(e)}},{key:"use",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._networkManager.registerMiddleware(e,t)}},{key:"onBroadcast",value:function(e){this.overlay().communication.onBroadcast(e)}},{key:"onStreamBroadcast",value:function(e){this.overlay().communication.onStreamBroadcast(e)}},{key:"sendBroadcast",value:function(e){return this.overlay().communication.sendBroadcast(e)}},{key:"streamBroadcast",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return this.overlay().communication.streamBroadcast(e)}},{key:"onUnicast",value:function(e){this.overlay().communication.onUnicast(e)}},{key:"onStreamUnicast",value:function(e){this.overlay().communication.onStreamUnicast(e)}},{key:"sendUnicast",value:function(e,t){return this.overlay().communication.sendUnicast(e,t)}},{key:"streamUnicast",value:function(e){return this.overlay().communication.streamUnicast(e)}},{key:"sendMulticast",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];return this.overlay().communication.sendMulticast(e,t)}},{key:"getRandomNeighbourId",value:function(){var e=this.overlay().network.getNeighbours();if(0===e.length)return null;try{return e[Math.floor(Math.random()*e.length)]}catch(e){return console.err(e),null}}},{key:"getNeighbours",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return this.overlay().network.getNeighbours(e)}},{key:"id",get:function(){return this._id}},{key:"inViewID",get:function(){return this.overlay().network.inviewId}},{key:"outViewID",get:function(){return this.overlay().network.outviewId}}]),t}();e.exports=l},function(e,t,n){"use strict";e.exports=0},function(e,t,n){"use strict";var r=n(20);e.exports=function(e){if(!e||"string"!=typeof e||e.length<6)return!1;for(var t=r.characters(),n=e.length,o=0;o<n;o++)if(-1===t.indexOf(e[o]))return!1;return!0}},function(e,t,n){"use strict";var r,o,i=n(65),s=n(20),a=1459707606518,c=6;e.exports=function(e){var t="",n=Math.floor(.001*(Date.now()-a));return n===o?r++:(r=0,o=n),t+=i(s.lookup,c),t+=i(s.lookup,e),r>0&&(t+=i(s.lookup,r)),t+=i(s.lookup,n)}},function(e,t,n){"use strict";var r=n(20);e.exports=function(e){var t=r.shuffled();return{version:15&t.indexOf(e.substr(0,1)),worker:15&t.indexOf(e.substr(1,1))}}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o="object"===("undefined"==typeof window?"undefined":r(window))&&(window.crypto||window.msCrypto);e.exports=function(){if(!o||!o.getRandomValues)return 48&Math.floor(256*Math.random());var e=new Uint8Array(1);return o.getRandomValues(e),48&e[0]}},function(e,t,n){"use strict";var r=1;e.exports={nextValue:function(){return(r=(9301*r+49297)%233280)/233280},seed:function(e){r=e}}},function(e,t,n){"use strict";var r=n(20),o=(n(65),n(217)),i=n(216),s=n(215),a=n(214)||0;function c(){return i(a)}e.exports=c,e.exports.generate=c,e.exports.seed=function(t){return r.seed(t),e.exports},e.exports.worker=function(t){return a=t,e.exports},e.exports.characters=function(e){return void 0!==e&&r.characters(e),r.shuffled()},e.exports.decode=o,e.exports.isValid=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=(c(n(66)),n(29)),i=c(n(95)),s=n(2),a=c(n(87));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._foglet=n,r._options=e,r.name=e.name,r.date=new Date,r.user=e.user,r.uid=r.user.id,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.EventEmitter),r(t,[{key:"init",value:function(){var e=this,t=this._options;return new Promise(function(n,r){var s=void 0;t.foglet?s=e._foglet.connection(t.foglet):(e._foglet.share(),s=e._foglet.connection()),s.then(function(){console.log("application connected!"),e._data_comm=new o.communication(e._foglet.overlay().network,"anti-entropy"),e._behaviours_comm=new o.communication(e._foglet.overlay().network,"No-anti-entropy"),e.core=new i.default(e.uid,{webrtc:t.webRTCOptions,signalingOptions:t.signalingOptions,editingSessionID:t.editingSessionID},e._data_comm,e._behaviours_comm),e.core.on("sendChangeTitle",function(){e.core.sendChangeTitle(e.name)}),e.core.on("changeTitle",function(t){e.title=t,e.name=t,e.emit("changeTitle",t)}),t.importFromJSON&&e.core.init(t.importFromJSON),e.broadcast=e._data_comm.broadcast,e.broadcastCaret=e._behaviours_comm.broadcast,e.rps=e._data_comm.network.rps,e.sequence=e.core.sequence,e.causality=e.broadcast._causality,e.signalingOptions=t.signalingOptions,t.display&&(e._view=new a.default(t,e,t.containerID)),e._foglet.emit("connected"),e.emit("connected"),n()})})}}]),t}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=h(n(221)),s=n(29),a=h(n(66)),c=h(n(1)),u=h(n(77)),l=n(2),f=h(n(30));function h(e){return e&&e.__esModule?e:{default:e}}
/*!
 * \brief transform the selected division into a distributed and decentralized 
 * collaborative editor.
 * \param options {
 *   signalingOptions: configure the signaling service to join or share the
 *     document. {address: http://example.of.signaling.service.address,
 *                session: the-session-unique-identifier,
 *                connect: true|false}
 *   webRTCOptions: configure the STUN/TURN server to establish WebRTC
 *     connections.
 *   styleOptions: change the default styling options of the editor.
 *   name: the name of the document
 *   importFromJSON: the json object containing the aformentionned options plus
 *     the saved sequence. If any of the other above options are specified, the
 *     option in the json object are erased by them.
 * }
 */
var p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._defaultOptions=r({},e),n._options=r({},e),e.foglet?n.justDoIt():n.init(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.EventEmitter),o(t,[{key:"init",value:function(){var e=this;console.log(this._options);var t=this._options.signalingServer+"/ice";fetch(t).then(function(e){return e.json()}).then(function(t){e._options.webRTCOptions=(0,c.default)({config:{iceServers:[{url:e._options.stun,urls:e._options.stun}]}},{config:{iceServers:t.ice},trickle:!0}),e._options.webRTCOptions.config.iceServers.forEach(function(e){e.urls=e.url}),console.log(e._options.webRTCOptions),e.justDoIt()})}},{key:"justDoIt",value:function(){var e=this;this._options.editingSession&&(this._options.signalingOptions={server:this._options.signalingServer,session:this._options.editingSession},u.default.get("CRATE2-"+this._options.editingSession)&&(this._options.signalingOptions={},this._options.importFromJSON=u.default.get("CRATE2-"+this._options.editingSession),this._options.signalingOptions.connect=!0));var t=this.GUID();this._options.user={id:t,pseudo:"Anonymous"},this._options.display&&u.default.get("myId")&&(this._options.user=u.default.get("myId")),this._previous=null,this._next=null;var n=this.constructor;n.actualSession&&null!=n.actualSession?(n.lastSession._next=this,this._previous=n.lastSession,n.lastSession=this,n.actualSession=this):(n.actualSession=this,n.lastSession=this,n.headSession=this);var r=this._options.webRTCOptions;this._options.wrtc&&(r.wrtc=this._options.wrtc);var o=this._options&&this._options.storageServer||"",a=this.constructor.GUID(),l=(0,c.default)({address:this._options.signalingServer,session:a},this._options&&this._options.importFromJSON&&this._options.importFromJSON.signalingOptions,this._options&&this._options.signalingOptions||{});l.room=l.session,this._editingSessionID=this._options.user.id+"-"+this.constructor.GUID();var f={id:this._editingSessionID,verbose:!0,rps:{type:"spray-wrtc",options:{protocol:l.sessionId,webrtc:r,timeout:3e4,pendingTimeout:3e4,delta:3e4,signaling:l}}};this._options.name=this._options&&this._options.name||this._options&&this._options.importFromJSON&&this._options.importFromJSON.title||"Untitled document",this._options=(0,c.default)(this._options,{webRTCOptions:r,storageServer:o,signalingOptions:l,fogletOptions:f}),this._options.editingSessionID=this._editingSessionID,this._options.foglet||(this._options.webRTCOptions.trickle=!0),this._foglet=new s.Foglet(f),this._documents=[];var h=new i.default(this._options,this._foglet);this._documents.push(h),h.init().then(function(){e.emit("new_document",h)})}},{key:"GUID",value:function(){return a.default.generate()}},{key:"getNext",value:function(){return _next}},{key:"getId",value:function(){return this._options.signalingOptions.session}},{key:"getPrevious",value:function(){return _previous}},{key:"moveToNext",value:function(){null!=this._next&&(this.constructor.actualSession=this._next,this.goTo(this.constructor.actualSession.getId()))}},{key:"moveToPrevious",value:function(){null!=this._previous&&(this.constructor.actualSession=this._previous,this.goTo(this.constructor.actualSession.getId()))}},{key:"goTo",value:function(e){var t=this.constructor.getCrateSession(e);t._previous&&(e=t._previous.getId()),this.constructor.focusOnSession(e,t.getId())}},{key:"close",value:function(){var e=this;for(var t in this._foglet.unshare(),this._foglet._networkManager._rps.network._rps.disconnect(),this._documents[0]._view._editor.stopPing(),clearInterval(this._documents[0]._view._timerStorageServer),this._documents[0]._view._editor.markers)clearInterval(t.timer);setTimeout(function(){e._foglet._networkManager._rps.network._rps.disconnect(),e._document=null,e._foglet=null},2e3)}}],[{key:"getCrateSession",value:function(e){for(var t=this.headSession;null!==t;){if(e===t.getId())return t;t=t._next}return!1}},{key:"GUID",value:function(){return a.default.generate()}},{key:"focusOnSession",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;jQuery('*[id^="container"]').removeClass("activeEditor"),jQuery("#container-"+n).addClass("activeEditor");var o=void 0;r?r.viewEditor.focus():(o=t.getCrateSession(n))._documents[0]._view?o._documents[0]._view._editor.viewEditor.focus():console.warn("There is no view for the following session"+o),jQuery("html, body").animate({scrollLeft:jQuery("#container-"+e).offset().left-40},"slow")}},{key:"openIn",value:function(){var e=$("#content-default a"),n=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var c=s.value;c.href.includes(window.location.href.split("?")[0])&&(c.onclick=function(){var e=this.href.split("?")[1],n=t.getCrateSession(e);if(n._previous&&(e=n._previous.getId()),jQuery("#container-"+e).length)t.focusOnSession(e,this.href.split("?")[1]);else new t(Object.assign(r({},t.actualSession._defaultOptions),{editingSession:e}))})}}catch(e){o=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw i}}}}]),t}();t.default=p,p.Marker=f.default}]);
//# sourceMappingURL=jquery-crate.bundle.js.map