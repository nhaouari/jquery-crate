{"version":3,"sources":["webpack://session/./src/view.js","webpack://session/./node_modules/dateformat/lib/dateformat.js","webpack://session/./src/view/comments.js","webpack://session/./src/view/editor.js","webpack://session/./src/view/statesheader.js","webpack://session/./src/view/link.js"],"names":["__webpack_require__","view","options","model","editorsContainerID","_this","this","_classCallCheck","_options","_editorsHolderID","_editorContainerID","signalingOptions","room","createCRATE","_model","_editor","CEditor","session","config","storageServer","_storageServerState","findremote","_timerStorageServer","setInterval","on","join","sessionID","s","default","getCrateSession","_previous","focusOnSession","sharingLinkContainer","VLink","jQuery","shareButton","_statesHeader","CStatesHeader","click","crateSession","headSession","_next","lastSession","remove","moveToPrevious","close","console","log","_this2","html","name","append","saveComment","hasClass","kill","firsttime","_this3","remotesave","url","fetch","then","resp","json","data","results","unpin","pin","catch","thrownError","clearInterval","type","css","removeClass","addClass","_this4","$","ajax","success","status","error","async","_this5","confirm","codes","37","39","document","addEventListener","e","code","keyCode","ctrlKey","metaKey","evt","createEvent","initEvent","target","dispatchEvent","preventDefault","actualSession","moveToNext","addMoveShortcuts","global","token","timezone","timezoneClip","dateFormat","date","mask","utc","gmt","arguments","length","val","undefined","_typeof","Array","isArray","toString","call","slice","toLowerCase","test","Date","isNaN","TypeError","maskSlice","String","masks","_","d","D","m","y","H","M","L","o","getTimezoneOffset","W","targetThursday","getFullYear","getMonth","getDate","setDate","getDay","firstThursday","ds","setHours","getHours","weekDiff","Math","floor","getWeek","N","dow","getDayOfWeek","flags","dd","pad","ddd","i18n","dayNames","dddd","mm","mmm","monthNames","mmmm","yy","yyyy","h","hh","HH","MM","ss","l","round","t","timeNames","tt","T","TT","Z","match","pop","replace","abs","S","len","shortDate","mediumDate","longDate","fullDate","shortTime","mediumTime","longTime","isoDate","isoTime","isoDateTime","isoUtcDateTime","expiresHeaderFormat","__WEBPACK_AMD_DEFINE_RESULT__","exports","module","_dateformat","Comments","editorContainerID","_viewEditor","_inputCommentModel","_comments","_ql_editor","_commentInput","_currentTimestamp","_commentCallback","commentAddClick","bind","commentsClick","cb","self","modal","Promise","resolve","reject","getTime","is","hide","show","comment","idAuthor","pseudo","color","currentTimestamp","utcSeconds","id","cmtbox","focusin","commentBoxFocus","focusout","modules","commentAddOn","commentAuthorId","addCommentToList","store","get","find","Editor","_events","debug","Quill","register","QuillCursors","QuillComment","EditorController","_possibleConstructorReturn","__proto__","Object","getPrototypeOf","markers","startTimer","viewEditor","_sessionID","loadDocument","startPing","saveDocument","changeTitle","emit","range","oldRange","source","core","caretMoved","delta","oldDelta","textChange","element","indexp","remoteInsert","index","remoteRemove","origin","remoteCaretMoved","title","text","atPing","EventEmitter","createViewDocument","doc","setContents","openIn","attr","uid","Marker","lifeTime","cursor","isItME","setPseudo","set","pseudoName","UpdateComments","commentOpt","animal","colorRGB","quill","formula","toolbar","container","header","font","align","list","background","handlers","subdocument","value","getSelection","preview","window","location","href","split","GUID","theme","tooltip","edit","undo","history","redo","cursors","autoRegisterListener","hideDelay","hideSpeed","delay","maxStack","enabled","commentTimestamp","commentServerTimestamp","containerID","position","top","save2","save","editor","sequence","causality","webRTCOptions","alert","cleanQuill","applyChanges","iniRetain","retain","JSON","parse","stringify","ops","forEach","op","operation","keys","oper","att","i","v","sendIt","start","isItInsertWithAtt","Deltat","getFormat","insert","video","image","insertEmbed","insertText","removeFormat","formatLine","formatText","commentAuthor","link","removedIndex","deleteText","update","sendChangeTitle","interval","sendPing","empty","attributes","getPseudoname","getColor","StatesHeader","linkView","shareView","startSharingText","startSharingTooltip","stopSharingText","stopSharingTooltip","red","yellow","green","blue","networkState","setNetworkState","rps","state","address","printLink","copyLink","qrcode","qrcodeCanvas","size","select","execCommand","connectedString","partiallyConnectedString","disconnectedString","LinkView","linkContainer","appendTo","qrCodeModal","qrCodeModalDialog","qrCodeModalContent","dismiss","rowContainer","inputGroup","input","inputGroup2","action","unbind","removeAttr","askLink"],"mappings":"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","file":"build/0.jquery-crate.bundle.js","sourcesContent":["import VLink from \"./view/link.js\"\r\nimport CStatesHeader from \"./view/statesheader.js\"\r\nimport CEditor from \"./view/editor\"\r\n\r\n\r\nexport default class view {\r\n  constructor(options, model, editorsContainerID) {\r\n\r\n\r\n    this._options = options\r\n    this._editorsHolderID = editorsContainerID\r\n    this._editorContainerID = `container-${this._options.signalingOptions.room}`\r\n    this.createCRATE()\r\n\r\n    this._model = model;\r\n    this._editor = new CEditor(model, options.signalingOptions.room, this._editorContainerID)\r\n\r\n    if (session.config.storageServer) {\r\n      this._storageServerState = {}\r\n      this.findremote(true) // join if it is in the sleeping mode to download the last version of the document\r\n      this._timerStorageServer = setInterval(() => this.findremote(), 5000);\r\n\r\n\r\n\r\n      /**\r\n       * if there are any changes local or remote then we have to wake up the storageServer\r\n       * @param  {[type]} \"thereAreChanges\" [description]\r\n       * @param  {[type]} (                 [description]\r\n       * @return {[type]}                   [description]\r\n       */\r\n      this._editor.on(\"thereAreChanges\", () => {\r\n        if (this._storageServerState === 2) {\r\n          this.join()\r\n        }\r\n      })\r\n    }\r\n\r\n    let sessionID = this._options.signalingOptions.session\r\n    let s = session.default.getCrateSession(sessionID)\r\n    if (s._previous) {\r\n      sessionID = s._previous._options.signalingOptions.session\r\n    }\r\n\r\n    session.default.focusOnSession(sessionID, this._options.signalingOptions.session, this._editor)\r\n\r\n\r\n    const sharingLinkContainer = new VLink(jQuery(`#${this._editorContainerID} #sharinglink`))\r\n\r\n    const shareButton = jQuery(`#${this._editorContainerID} #shareicon`)\r\n\r\n    this._statesHeader = new CStatesHeader(model, sharingLinkContainer, shareButton, this._editorContainerID)\r\n\r\n    jQuery(`#${this._editorContainerID} #closeDocument`).click(() => {\r\n      // Get object of the list for this session\r\n      let crateSession = session.default.getCrateSession(this._options.signalingOptions.room)\r\n\r\n      if (session.headSession !== crateSession) {\r\n\r\n        // remove the crateSession for the list \r\n        if (crateSession._previous) {\r\n          crateSession._previous._next = crateSession._next\r\n        }\r\n\r\n        if (crateSession._next) {\r\n          crateSession._next._previous = crateSession._previous\r\n        } else {\r\n          session.lastSession = crateSession._previous\r\n        }\r\n\r\n        // remove it from the browser   \r\n        jQuery(`#${this._editorContainerID}`).remove()\r\n\r\n        //  disconnect and remove the model\r\n\r\n        crateSession.moveToPrevious()\r\n        crateSession.close()\r\n      } else {\r\n        console.log('You cannot remove the first document')\r\n      }\r\n\r\n    })\r\n\r\n  }\r\n\r\n  createCRATE() {\r\n    const html = ` \r\n<div class=\"col-md-10 editorContainer\" id=\"${this._editorContainerID}\" >\r\n <!-- Head -->\r\n   <div id=\"head\">\r\n      <div id=\"firstrow\" class=\"row\">\r\n         <div id=\"connectionState\">\r\n         </div>\r\n         <div id=\"title\">\r\n            ${this._options.name}\r\n         </div>\r\n         <div id=\"features\">\r\n            <div id=\"shareicon\">\r\n               <i class=\"fa fa-link fa-2x ficon2\"></i>\r\n            </div>\r\n            <div id=\"saveicon\"><i class=\"fa fa-floppy-o fa-2x ficon2\"></i></div>\r\n            <div id=\"remotesave\" style=\" width: 20px;\">\r\n               <i class=\"fa fa-cloud fa-2x ficon2\"></i>\r\n            </div>\r\n            <div id=\"closeDocument\" style=\"\r\n              float: right;\r\n             position: relative;\r\n                \">\r\n            <i class=\"fa fa-window-close\" aria-hidden=\"true\" ></i>\r\n            </div>\r\n         </div>\r\n      </div>\r\n      <div id=\"sharinglink\" class=\"row\">\r\n      </div>\r\n   </div>\r\n   \r\n <!-- Content -->\r\n   <div id=\"content\" class=\"content\">\r\n      <div id=\"users\" class=\"row\">\r\n         <div id=\"state\" style=\"margin-left: -50px;\" \">\r\n            <i class=\"fa fa-globe fa-3x ficon \"></i>\r\n         </div>\r\n      </div>\r\n      <div id=\"editorSection\">\r\n         <div id=\"editor\" class=\"editor\">\r\n         </div>\r\n         <div id=\"comments\">\r\n         </div>\r\n      </div>\r\n   </div>\r\n\r\n\r\n  <div id=\"inputCommentModal\" class=\"modal fade\" role=\"dialog\" style=\"display: none;\">\r\n            <div class=\"modal-dialog\">\r\n        \r\n                <!-- Modal content-->\r\n                <div class=\"modal-content\">\r\n                    <div class=\"modal-body\">\r\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\">Ã—</button>\r\n                    <h4>Comment</h4>\r\n                    <p><textarea name=\"commentInput\" id=\"commentInput\" style=\"width: 100%;\" rows=\"5\"></textarea></p>\r\n                    </div>\r\n                    <div class=\"modal-footer\">\r\n                    <button type=\"button\" class=\"btn btn-default\" id=\"saveComment\"data-dismiss=\"modal\">Save</button>\r\n                    </div>\r\n                </div>\r\n        \r\n            </div>\r\n        </div>\r\n    `\r\n    jQuery(`#${this._editorsHolderID}`).append(html);\r\n\r\n    jQuery(`#${this._editorContainerID} #saveComment`).click(() => {\r\n      this.saveComment()\r\n    })\r\n\r\n    jQuery(`#${this._editorContainerID} #remotesave`).click(() => {\r\n\r\n      if (jQuery(`#${this._editorContainerID} #remotesave`).hasClass('PIN')) {\r\n        this.kill();\r\n      } else {\r\n        this.join();\r\n      }\r\n    });\r\n\r\n\r\n  }\r\n\r\n  static addMoveShortcuts() {\r\n    // custom prev next page event \r\n\r\n\r\n    let codes = {\r\n      37: \"prev\",\r\n      39: \"next\"\r\n    }\r\n\r\n    document.addEventListener && // Modern browsers only\r\n      document.addEventListener(\"keydown\", function(e) {\r\n        const code = codes[e.keyCode];\r\n        if ((e.ctrlKey || e.metaKey) && code) {\r\n          const evt = document.createEvent(\"Event\")\r\n          evt.initEvent(code, true, false);\r\n          e.target.dispatchEvent(evt); // dispatch on current target. Event will bubble up to window\r\n          e.preventDefault(); // opera defaut fix\r\n        }\r\n      }, false);\r\n\r\n\r\n\r\n    // or using jQuery\r\n\r\n    $(document).on('next', () => {\r\n       console.log('next')\r\n      session.default.actualSession.moveToNext()\r\n    })\r\n\r\n    $(document).on('prev', () => {\r\n      console.log('prev')\r\n      session.default.actualSession.moveToPrevious()\r\n    })  \r\n\r\n  }\r\n\r\n  saveComment() {\r\n    this._editor.saveComment()\r\n  }\r\n\r\n\r\n  // Remote session \r\n  findremote(firsttime) {\r\n    let sessionID = this._options.signalingOptions.room\r\n    let remotesave = jQuery(`#${this._editorContainerID} #remotesave`)\r\n    // There is a configured server\r\n    if (session.config.storageServer) {\r\n      \r\n      const url =session.config.storageServer + \"/exist/\" + sessionID\r\n      fetch(url)\r\n      .then((resp) => resp.json()) // Transform the data into json\r\n      .then((data)=> {\r\n          this._storageServerState = data.results\r\n          if (data.results == 0) {\r\n            this.unpin(remotesave);\r\n          } else if (data.results == 1) { // the session is active on the server\r\n            this.pin(remotesave, \"active\");\r\n          } else {\r\n            if (firsttime) {\r\n              this.join()\r\n            } else {\r\n              this.pin(remotesave, \"sleep\");\r\n            }\r\n          }\r\n\r\n\r\n\r\n        })\r\n        .catch((thrownError)=> {\r\n          console.log(thrownError);\r\n          clearInterval(this._timerStorageServer);\r\n          this.unpin(remotesave);\r\n        })\r\n\r\n  }\r\n}\r\n\r\n  pin(remotesave, type) {\r\n    if (type === \"active\") {\r\n      remotesave.css('color', 'green');\r\n    } else {\r\n      remotesave.css('color', 'gray');\r\n    }\r\n    remotesave.removeClass('UNPIN');\r\n    remotesave.addClass('PIN');\r\n  }\r\n\r\n  unpin(remotesave) {\r\n    remotesave.css('color', 'red');\r\n    remotesave.removeClass('PIN');\r\n    remotesave.addClass('UNPIN');\r\n  }\r\n\r\n\r\n  join() {\r\n    let sessionID = this._options.signalingOptions.room\r\n    $.ajax({\r\n      type: \"GET\",\r\n      url: session.config.storageServer + \"/join/\" + sessionID,\r\n      success: (data, status) => {\r\n        this.findremote();\r\n      },\r\n      error: () => {\r\n        this.findremote();\r\n      },\r\n      async: true\r\n    });\r\n  }\r\n\r\n  kill() {\r\n    let sessionID = this._options.signalingOptions.room\r\n    var r = confirm(\"Do you want remove document from remote server!\");\r\n    if (r == true) {\r\n      $.ajax({\r\n        type: \"GET\",\r\n        url: session.config.storageServer + \"/kill/\" + sessionID,\r\n        success: (data, status) => {\r\n          this.findremote(sessionID);\r\n        },\r\n        async: false\r\n      });\r\n\r\n    }\r\n  }\r\n\r\n}\r\n\r\nview.addMoveShortcuts() ","/*\n * Date Format 1.2.3\n * (c) 2007-2009 Steven Levithan <stevenlevithan.com>\n * MIT license\n *\n * Includes enhancements by Scott Trenda <scott.trenda.net>\n * and Kris Kowal <cixar.com/~kris.kowal/>\n *\n * Accepts a date, a mask, or a date and a mask.\n * Returns a formatted version of the given date.\n * The date defaults to the current date/time.\n * The mask defaults to dateFormat.masks.default.\n */\n\n(function(global) {\n  'use strict';\n\n  var dateFormat = (function() {\n      var token = /d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\\1?|[LloSZWN]|\"[^\"]*\"|'[^']*'/g;\n      var timezone = /\\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\\d{4})?)\\b/g;\n      var timezoneClip = /[^-+\\dA-Z]/g;\n  \n      // Regexes and supporting functions are cached through closure\n      return function (date, mask, utc, gmt) {\n  \n        // You can't provide utc if you skip other args (use the 'UTC:' mask prefix)\n        if (arguments.length === 1 && kindOf(date) === 'string' && !/\\d/.test(date)) {\n          mask = date;\n          date = undefined;\n        }\n  \n        date = date || new Date;\n  \n        if(!(date instanceof Date)) {\n          date = new Date(date);\n        }\n  \n        if (isNaN(date)) {\n          throw TypeError('Invalid date');\n        }\n  \n        mask = String(dateFormat.masks[mask] || mask || dateFormat.masks['default']);\n  \n        // Allow setting the utc/gmt argument via the mask\n        var maskSlice = mask.slice(0, 4);\n        if (maskSlice === 'UTC:' || maskSlice === 'GMT:') {\n          mask = mask.slice(4);\n          utc = true;\n          if (maskSlice === 'GMT:') {\n            gmt = true;\n          }\n        }\n  \n        var _ = utc ? 'getUTC' : 'get';\n        var d = date[_ + 'Date']();\n        var D = date[_ + 'Day']();\n        var m = date[_ + 'Month']();\n        var y = date[_ + 'FullYear']();\n        var H = date[_ + 'Hours']();\n        var M = date[_ + 'Minutes']();\n        var s = date[_ + 'Seconds']();\n        var L = date[_ + 'Milliseconds']();\n        var o = utc ? 0 : date.getTimezoneOffset();\n        var W = getWeek(date);\n        var N = getDayOfWeek(date);\n        var flags = {\n          d:    d,\n          dd:   pad(d),\n          ddd:  dateFormat.i18n.dayNames[D],\n          dddd: dateFormat.i18n.dayNames[D + 7],\n          m:    m + 1,\n          mm:   pad(m + 1),\n          mmm:  dateFormat.i18n.monthNames[m],\n          mmmm: dateFormat.i18n.monthNames[m + 12],\n          yy:   String(y).slice(2),\n          yyyy: y,\n          h:    H % 12 || 12,\n          hh:   pad(H % 12 || 12),\n          H:    H,\n          HH:   pad(H),\n          M:    M,\n          MM:   pad(M),\n          s:    s,\n          ss:   pad(s),\n          l:    pad(L, 3),\n          L:    pad(Math.round(L / 10)),\n          t:    H < 12 ? dateFormat.i18n.timeNames[0] : dateFormat.i18n.timeNames[1],\n          tt:   H < 12 ? dateFormat.i18n.timeNames[2] : dateFormat.i18n.timeNames[3],\n          T:    H < 12 ? dateFormat.i18n.timeNames[4] : dateFormat.i18n.timeNames[5],\n          TT:   H < 12 ? dateFormat.i18n.timeNames[6] : dateFormat.i18n.timeNames[7],\n          Z:    gmt ? 'GMT' : utc ? 'UTC' : (String(date).match(timezone) || ['']).pop().replace(timezoneClip, ''),\n          o:    (o > 0 ? '-' : '+') + pad(Math.floor(Math.abs(o) / 60) * 100 + Math.abs(o) % 60, 4),\n          S:    ['th', 'st', 'nd', 'rd'][d % 10 > 3 ? 0 : (d % 100 - d % 10 != 10) * d % 10],\n          W:    W,\n          N:    N\n        };\n  \n        return mask.replace(token, function (match) {\n          if (match in flags) {\n            return flags[match];\n          }\n          return match.slice(1, match.length - 1);\n        });\n      };\n    })();\n\n  dateFormat.masks = {\n    'default':               'ddd mmm dd yyyy HH:MM:ss',\n    'shortDate':             'm/d/yy',\n    'mediumDate':            'mmm d, yyyy',\n    'longDate':              'mmmm d, yyyy',\n    'fullDate':              'dddd, mmmm d, yyyy',\n    'shortTime':             'h:MM TT',\n    'mediumTime':            'h:MM:ss TT',\n    'longTime':              'h:MM:ss TT Z',\n    'isoDate':               'yyyy-mm-dd',\n    'isoTime':               'HH:MM:ss',\n    'isoDateTime':           'yyyy-mm-dd\\'T\\'HH:MM:sso',\n    'isoUtcDateTime':        'UTC:yyyy-mm-dd\\'T\\'HH:MM:ss\\'Z\\'',\n    'expiresHeaderFormat':   'ddd, dd mmm yyyy HH:MM:ss Z'\n  };\n\n  // Internationalization strings\n  dateFormat.i18n = {\n    dayNames: [\n      'Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat',\n      'Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'\n    ],\n    monthNames: [\n      'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec',\n      'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'\n    ],\n    timeNames: [\n      'a', 'p', 'am', 'pm', 'A', 'P', 'AM', 'PM'\n    ]\n  };\n\nfunction pad(val, len) {\n  val = String(val);\n  len = len || 2;\n  while (val.length < len) {\n    val = '0' + val;\n  }\n  return val;\n}\n\n/**\n * Get the ISO 8601 week number\n * Based on comments from\n * http://techblog.procurios.nl/k/n618/news/view/33796/14863/Calculate-ISO-8601-week-and-year-in-javascript.html\n *\n * @param  {Object} `date`\n * @return {Number}\n */\nfunction getWeek(date) {\n  // Remove time components of date\n  var targetThursday = new Date(date.getFullYear(), date.getMonth(), date.getDate());\n\n  // Change date to Thursday same week\n  targetThursday.setDate(targetThursday.getDate() - ((targetThursday.getDay() + 6) % 7) + 3);\n\n  // Take January 4th as it is always in week 1 (see ISO 8601)\n  var firstThursday = new Date(targetThursday.getFullYear(), 0, 4);\n\n  // Change date to Thursday same week\n  firstThursday.setDate(firstThursday.getDate() - ((firstThursday.getDay() + 6) % 7) + 3);\n\n  // Check if daylight-saving-time-switch occurred and correct for it\n  var ds = targetThursday.getTimezoneOffset() - firstThursday.getTimezoneOffset();\n  targetThursday.setHours(targetThursday.getHours() - ds);\n\n  // Number of weeks between target Thursday and first Thursday\n  var weekDiff = (targetThursday - firstThursday) / (86400000*7);\n  return 1 + Math.floor(weekDiff);\n}\n\n/**\n * Get ISO-8601 numeric representation of the day of the week\n * 1 (for Monday) through 7 (for Sunday)\n * \n * @param  {Object} `date`\n * @return {Number}\n */\nfunction getDayOfWeek(date) {\n  var dow = date.getDay();\n  if(dow === 0) {\n    dow = 7;\n  }\n  return dow;\n}\n\n/**\n * kind-of shortcut\n * @param  {*} val\n * @return {String}\n */\nfunction kindOf(val) {\n  if (val === null) {\n    return 'null';\n  }\n\n  if (val === undefined) {\n    return 'undefined';\n  }\n\n  if (typeof val !== 'object') {\n    return typeof val;\n  }\n\n  if (Array.isArray(val)) {\n    return 'array';\n  }\n\n  return {}.toString.call(val)\n    .slice(8, -1).toLowerCase();\n};\n\n\n\n  if (typeof define === 'function' && define.amd) {\n    define(function () {\n      return dateFormat;\n    });\n  } else if (typeof exports === 'object') {\n    module.exports = dateFormat;\n  } else {\n    global.dateFormat = dateFormat;\n  }\n})(this);\n","import dateformat from \"dateformat\"\r\n/**\r\n * This class is for managing the comments for quill\r\n */\r\nexport default class Comments {\r\n\t/**\r\n\t * [constructor description]\r\n\t * @param  {[type]} editorContainerID [description]\r\n\t * @return {[type]}                   [description]\r\n\t */\r\n\r\n\tconstructor(editorContainerID) {\r\n\t\t// Selectors\r\n\t\tthis._editorContainerID = editorContainerID\r\n\t\tthis._viewEditor = {}\r\n\t\tthis._inputCommentModel = $(`#${this._editorContainerID} #inputCommentModal`)\r\n\t\tthis._comments = $(`#${this._editorContainerID} #comments`)\r\n\t\tthis._ql_editor = $(`#${this._editorContainerID} .ql-editor`)\r\n\t\tthis._editor = $(`#${this._editorContainerID} .editor`)\r\n\t\tthis._commentInput = $(`#${this._editorContainerID} #commentInput`)\r\n\t\tthis._currentTimestamp = {}\r\n\t\tthis._commentCallback = {}\r\n\t\tthis.commentAddClick = this.commentAddClick.bind(this)\r\n\t\tthis.commentsClick = this.commentsClick.bind(this)\r\n\t}\r\n\r\n\tget viewEditor() {\r\n\t\treturn this._viewEditor\r\n\t}\r\n\r\n\tset viewEditor(Editor) {\r\n\t\tthis._viewEditor = Editor\r\n\t}\r\n\r\n\tcommentAddClick(cb,self) {\r\n\t\tthis._commentCallback = cb.bind(self);\r\n\t\tthis._inputCommentModel.modal('show');\r\n\t}\r\n\r\n\tcommentServerTimestamp() {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis._currentTimestamp = Math.round((new Date()).getTime() / 1000); // call from server\r\n\t\t\tresolve(this._currentTimestamp);\r\n\t\t});\r\n\t}\r\n\r\n\tcommentsClick() {\r\n\t\tif (this._comments.is(\":visible\")) {\r\n\r\n\t\t\tif (this._ql_editor.hasClass('ql-comments')) {\r\n\t\t\t\tthis._ql_editor.removeClass('ql-comments');\r\n\t\t\t}\r\n\r\n\t\t\tthis._comments.hide();\r\n\t\t\tthis._comments.css('width', '0%');\r\n\t\t\tthis._editor.css('width', '100%');\r\n\r\n\t\t} else {\r\n\t\t\tthis._comments.addClass('comment');\r\n\t\t\tif (!this._editor.hasClass('ql-comments')) {\r\n\t\t\t\tthis._editor.addClass('ql-comments');\r\n\t\t\t}\r\n\r\n\t\t\tthis._comments.css('width', '30%');\r\n\t\t\tthis._editor.css('width', '70%');\r\n\t\t\tthis._comments.show();\r\n\t\t}\r\n\t}\r\n\r\n\taddCommentToList(comment, idAuthor, pseudo, name, color, currentTimestamp) {\r\n\t\tlet utcSeconds = currentTimestamp;\r\n\t\tlet d = new Date(); // The 0 there is the key, which sets the date to the epoch\r\n\t\tlet date = dateFormat(d, \"dddd, mmmm dS, yyyy, h:MM:ss TT\");\r\n\r\n\t\tlet id = 'ql-comment-' + idAuthor + '-' + utcSeconds;\r\n\r\n\t\tlet cmtbox = $(\r\n\t\t\t`<div class='comment-box ${id} row' id='comment-box-${id}' tabindex=\"1\" title='${date}'>\r\n      <div class='comment-head row'>\r\n        <div id=\"${id}\"style=\"background-color:${color};width: 40px;\" ><img class=\"imageuser\" src=\"./icons/${pseudo}.png\" alt=\"${name}\"></div>\r\n    \r\n        <div class='comment-details'>\r\n          <div class='comment-author'>${name}</div>\r\n        </div>\r\n      </div>\r\n      <div class='comment-body row' >${comment}</div>\r\n  \r\n    </div>`\r\n\t\t);\r\n\r\n\t\tthis._comments.append(cmtbox);\r\n\r\n\t\t$('#comment-box-' + id).focusin(() => {\r\n\t\tthis.commentBoxFocus(id)\r\n\t\r\n\t\t})\r\n\r\n\t\t$('#comment-box-' + id).focusout(() => {\r\n\t\t\tthis.commentBoxFocus(id, 'out')\r\n\t\t})\r\n\r\n\t\t\r\n\r\n\t\t\r\n\t}\r\n\r\n\r\n\tsaveComment() {\r\n\t\tlet comment = this._commentInput.val();\r\n\t\tthis._commentCallback(comment);\r\n\r\n\t\tlet name = this._viewEditor.options.modules.comment.commentAddOn;\r\n\r\n\t\tlet id = this._viewEditor.options.modules.comment.commentAuthorId;\r\n\r\n\t\tlet color = this._viewEditor.options.modules.comment.color;\r\n\r\n\t\tthis.addCommentToList(comment, id, name, store.get('myId').pseudo, color, this._currentTimestamp)\r\n\t}\r\n\r\n\tcommentBoxFocus(id, type) {\r\n\t\tif (type !== 'out') {\r\n\t\t\t$('.ql-comments #' + id).addClass('commentFocus');\r\n\t\t\tthis._comments.find('.' + id).css('border-color', 'red');\r\n\r\n\t\t} else {\r\n\t\t\t$('.ql-comments #' + id).removeClass('commentFocus');\r\n\t\t\tthis._comments.find('.comment-box').css('border-color', '#F0F0F0');\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\n","import Marker from \"../view/marker\";\r\nimport Comments from \"../view/comments\";\r\nimport {EventEmitter} from \"events\"\r\n\r\nvar debug = require('debug')('crate:view:editor')\r\n\r\n\r\n\r\n\r\nQuill.register('modules/cursors', QuillCursors);\r\nQuill.register('modules/comment', QuillComment);\r\n\r\n/**\r\n * EditorController this the link between the core functions and the interface.\r\n */\r\n\r\nexport default class EditorController extends EventEmitter {\r\n\r\n\r\n  /**\r\n   * [constructor description]\r\n   * @param  {[doc]} model  this is the object that contains all proprieties of a document.    \r\n   * @param  {[string]} sessionID [description]\r\n   */\r\n  constructor(model, sessionID, editorContainerID) {\r\n    super()\r\n    /**\r\n     * this is the object that contains all proprieties of a document.\r\n     * @type {[doc]}\r\n     */\r\n    this.model = model\r\n\r\n    /**\r\n     * markers contains all marks of the users: carets, avatars...\r\n     * @type {Marker[]}\r\n     */\r\n    this.markers = {}\r\n    /**\r\n     * startimer A timer used for sending pings\r\n     * @type {Timer}\r\n     */\r\n    this.startTimer = {}\r\n    /**\r\n     *  ViewEditor the used editor, here it is Quill editor \r\n     *  @see  https://quilljs.com/\r\n     * @type {Quill}\r\n     */\r\n    this.viewEditor = {};\r\n\r\n    this._editorContainerID = editorContainerID\r\n\r\n    this._comments = new Comments(this._editorContainerID)\r\n    this._sessionID = sessionID\r\n\r\n    this.loadDocument(sessionID)\r\n\r\n\r\n    this.startPing(5000)\r\n\r\n    jQuery(`#${this._editorContainerID} #saveicon`).click(() => {\r\n      this.saveDocument()\r\n    })\r\n\r\n    jQuery(`#${this._editorContainerID} #title`).focusout(() => {\r\n      this.changeTitle()\r\n      this.emit('thereAreChanges')\r\n    })\r\n\r\n\r\n    // EDITOR listeners \r\n    this.viewEditor.on('selection-change', (range, oldRange, source) => {\r\n      if (range) {\r\n        this.model.core.caretMoved(range)\r\n      }\r\n    })\r\n\r\n    this.viewEditor.on('text-change', (delta, oldDelta, source) => {\r\n      this.textChange(delta, oldDelta, source)\r\n      this.emit('thereAreChanges')\r\n\r\n    })\r\n\r\n\r\n    // Core listeners \r\n    this.model.core.on('remoteInsert', (element, indexp) => {\r\n      this.remoteInsert(element, indexp)\r\n      this.emit('thereAreChanges')\r\n    })\r\n\r\n    this.model.core.on('remoteRemove', (index) => {\r\n      this.remoteRemove(index)\r\n      this.emit('thereAreChanges')\r\n    })\r\n\r\n    this.model.core.on('remoteCaretMoved', (range, origin) => {\r\n      this.remoteCaretMoved(range, origin)\r\n    })\r\n\r\n    this.model.core.on('remoteCaretMoved', (range, origin) => {\r\n      this.remoteCaretMoved(range, origin)\r\n    })\r\n\r\n    //At the reception of Title changed operation \r\n    this.model.on('changeTitle', (title) => {\r\n      jQuery(`#${this._editorContainerID} #title`).text(title)\r\n      this.emit('thereAreChanges')\r\n    })\r\n\r\n    this.model.core.on('ping', (origin, pseudo) => {\r\n      this.atPing(origin, pseudo)\r\n    })\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * loadDocument load the document if it exist in the local storage\r\n   * @param {string} sessionID the session ID of the document\r\n   * @return {[type]} [description]\r\n   */\r\n  loadDocument(sessionID) {\r\n    this.createViewDocument()\r\n    //jQuery(`#${this._editorContainerID} #editor`).attr('id', 'crate-' + id)\r\n    // Initilise the the editor content \r\n    //this.editor.setText('')\r\n\r\n    if (store.get(\"CRATE2-\" + sessionID)) {\r\n      var doc = store.get(\"CRATE2-\" + sessionID)\r\n      this.viewEditor.setContents(doc.delta, \"user\")\r\n      jQuery(`#${this._editorContainerID} #title`).text(doc.title)\r\n      session.default.openIn(); // this is to convert the links to inside links\r\n    }\r\n\r\n    // make title editable\r\n    jQuery(`#${this._editorContainerID} #title`).click(() => {\r\n      jQuery(`#${this._editorContainerID} #title`).attr('contenteditable', 'true')\r\n    })\r\n\r\n\r\n    /* if (store.get(\"CRATE2-\" + this.model.signalingOptions.session)) {\r\n       this.markers = store.get(\"CRATE2-\" + this.model.signalingOptions.session).markers\r\n\r\n       // convert the json objects to Marker object with functions \r\n       for (var property in this.markers) {\r\n         if (this.markers.hasOwnProperty(property)) {\r\n           this.markers[property] = Object.assign(new Marker(property), this.markers[property])\r\n           this.markers[property].cursor = false\r\n         }\r\n       }\r\n\r\n     } else {*/\r\n    this.markers = {}\r\n    // }\r\n\r\n\r\n    this.model.markers = this.markers\r\n\r\n    //if (!this.markers[id]) { \r\n    //     console.log(\"Add mythis\")\r\n    //this.markers.push(id)\r\n    let id = this.model.uid\r\n\r\n    let options = {\r\n      lifeTime: 5 * 1000,\r\n      range: {\r\n        index: 0,\r\n        length: 0\r\n      },\r\n      cursor: false,\r\n      isItME: true\r\n    }\r\n\r\n\r\n\r\n    this.markers[id] = new Marker(id, options, this)\r\n\r\n    if (store.get('myId')) {\r\n      this.markers[id].setPseudo(store.get('myId').pseudo)\r\n    } else {\r\n      store.set('myId', {\r\n        id: id,\r\n        pseudo: this.markers[id].pseudoName\r\n      })\r\n    }\r\n    this.UpdateComments()\r\n\r\n    //comment module initialization\r\n    let commentOpt = this.viewEditor.options.modules.comment\r\n    commentOpt.commentAddOn = this.markers[id].animal\r\n    commentOpt.commentAuthorId = this.model.uid\r\n    commentOpt.color = this.markers[id].colorRGB\r\n  }\r\n\r\n  /**\r\n   * createViewDocument  Create quill editor options for the editor that we wan to create\r\n   * @param  {[type]} containerID [description]\r\n   * @return {[type]}             [description]\r\n   */\r\n  createViewDocument() {\r\n\r\n    const toolbarOptions = [\r\n      [{\r\n        'header': [1, 2, 3, 4, 5, 6, false]\r\n      }],\r\n      [{\r\n        'font': []\r\n      }],\r\n      ['bold', 'italic', 'underline', 'strike'], // toggled buttons\r\n      // custom button values\r\n      [{\r\n        'align': []\r\n      }],\r\n      [{\r\n        'list': 'ordered'\r\n      }, {\r\n        'list': 'bullet'\r\n      }],\r\n      //  [{ 'script': 'sub'}, { 'script': 'super' }],      // superscript/subscript\r\n      // [{ 'indent': '-1'}, { 'indent': '+1' }],          // outdent/indent\r\n      /* [{\r\n         'direction': 'rtl'\r\n       }], // text direction\r\n\r\n       [{\r\n         'size': ['small', false, 'large', 'huge']\r\n       }], // custom dropdown*/\r\n\r\n      [{\r\n        'color': []\r\n      }, {\r\n        'background': []\r\n      }], // dropdown with defaults from theme\r\n      ['clean'], // remove formatting button\r\n      /*['blockquote', 'code-block'],*/\r\n      ['formula', 'image', 'link'],\r\n      ['subdocument'],\r\n      ['comments-toggle'], // comment color on/off\r\n      ['comments-add'] // comment add\r\n\r\n    ];\r\n\r\n    //todo include the container ID\r\n    //\r\n    let quill = new Quill(`#${this._editorContainerID} #editor`, {\r\n      modules: {\r\n        formula: true,\r\n        toolbar: {\r\n          container: toolbarOptions,\r\n          handlers: {\r\n            subdocument: function(value) {\r\n              let range = this.quill.getSelection();\r\n              // let preview = this.quill.getText(range);\r\n              let preview = window.location.href.split('?')[0] + '?' + session.default.GUID();\r\n              let tooltip = this.quill.theme.tooltip;\r\n              tooltip.edit('link', preview);\r\n            },\r\n            undo: function(value) {\r\n              this.quill.history.undo();\r\n            },\r\n            redo: function(value) {\r\n              this.quill.history.redo();\r\n            }\r\n          }\r\n        },\r\n        cursors: {\r\n          autoRegisterListener: true, // default: true\r\n          hideDelay: 500, // default: 3000\r\n          hideSpeed: 0\r\n          // default: 400\r\n        },\r\n        history: {\r\n          delay: 500,\r\n          maxStack: 1000\r\n        },\r\n        comment: {\r\n          enabled: true,\r\n          commentAuthorId: 123,\r\n          commentAddOn: 'Author Name', // any additional info needed\r\n          color: 'yellow', // comment background color in the text\r\n          commentAddClick: this._comments.commentAddClick, // get called when `ADD COMMENT` btn on options bar is clicked\r\n          commentsClick: this._comments.commentsClick, // get called when you click `COMMENTS` btn on options bar for you to do additional things beside color on/off. Color on/off is already done before the callback is called.\r\n          commentTimestamp: this._comments.commentServerTimestamp,\r\n          containerID: this._editorContainerID\r\n        }\r\n      },\r\n\r\n      theme: 'snow'\r\n    });\r\n\r\n    $(\".ql-subdocument .ql-comments-toggle .ql-comments-add\").attr('data-toggle', 'tooltip');\r\n    $(\".ql-comments-toggle,.ql-comments-add\").css({\r\n      \"position\": \"relative\",\r\n      \"top\": \"-5px\"\r\n    });\r\n\r\n    $(\".ql-subdocument\").html('<strong>SUB</strong>');\r\n    $(\".ql-subdocument\").attr('title', 'Add subdocument');\r\n\r\n    $('.ql-comments-toggle').html('<i class=\"fa fa-comments\"></i>');\r\n    $(\".ql-comments-toggle\").attr('title', 'Show/hide comments');\r\n\r\n\r\n    $('.ql-comments-add').html('<i class=\"fa fa-comment\"></i>');\r\n    $(\".ql-comments-add\").attr('title', 'Add comment');\r\n\r\n\r\n    // hook changing the editor when click on save link ==> open in the document\r\n    quill.theme.tooltip.save2 = quill.theme.tooltip.save\r\n\r\n    quill.theme.tooltip.save = function() {\r\n      quill.theme.tooltip.save2()\r\n      session.default.openIn()\r\n    }\r\n\r\n\r\n    this._comments.viewEditor = quill\r\n    this.viewEditor = quill\r\n  }\r\n\r\n\r\n  /**\r\n   * saveDocument save the document in local storage\r\n   * @return {[type]} [description]\r\n   */\r\n  saveDocument() {\r\n    var timeNow = new Date().getTime()\r\n    var title = jQuery(`#${this._editorContainerID} #title`).text()\r\n    var document = {\r\n      date: timeNow,\r\n      title: title,\r\n      delta: this.viewEditor.editor.delta,\r\n      sequence: this.model.sequence,\r\n      causality: this.model.causality,\r\n      name: this.model.name,\r\n      webRTCOptions: this.model.webRTCOptions,\r\n      markers: {},\r\n      signalingOptions: this.model.signalingOptions\r\n    }\r\n    store.set(\"CRATE2-\" + this.model.signalingOptions.session, document)\r\n    alert(\"Document is saved successfully\")\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * textChange description\r\n   * @param  {[type]} delta    [description]\r\n   * @param  {[type]} oldDelta [description]\r\n   * @param  {[type]} source   [description]\r\n   * @listens editor content changes\r\n   * @return {[type]}          [description]\r\n   */\r\n  textChange(delta, oldDelta, source) {\r\n\r\n    this.cleanQuill()\r\n\r\n    this.applyChanges(delta, 0)\r\n  }\r\n\r\n\r\n  /**\r\n   * applyChanges Send delta object with attributes character by character starting from  the position \"iniRetain\"  ]\r\n   * @param  {[type]} delta     [description]\r\n   * @param  {[type]} iniRetain [description]\r\n   * @return {[type]}           [description]\r\n   */\r\n  applyChanges(delta, iniRetain) {\r\n\r\n    let changes = JSON.parse(JSON.stringify(delta, null, 2))\r\n\r\n    let retain = iniRetain\r\n\r\n    let text = \"\"\r\n\r\n    changes.ops.forEach((op) => {\r\n      var operation = Object.keys(op)\r\n      var oper = \"\"\r\n      var att = \"\"\r\n      var value = \"\"\r\n\r\n      // extract attributes from the operation in the case of there existance\r\n      for (var i = operation.length - 1; i >= 0; i--) {\r\n        var v = op[operation[i]]\r\n        if (operation[i] === \"attributes\") {\r\n          att = v\r\n        } else {\r\n          oper = operation[i]\r\n          value = v\r\n\r\n        }\r\n      }\r\n\r\n      // Change the style = remove the word and insert again with attribues,  \r\n\r\n      // In the case of changing the style, delta will contain \"retain\" (the start postion) with attributes \r\n\r\n      var isItInsertWithAtt = false // to know if we have to update comments or not, if its delete because of changing style, no update comments is needed\r\n\r\n      retain = this.sendIt(text, att, 0, value, oper, retain, isItInsertWithAtt)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * sendIt Send the changes character by character \r\n   * @param  {[type]}  text              [description]\r\n   * @param  {[type]}  att               [description]\r\n   * @param  {[type]}  start             [description]\r\n   * @param  {[type]}  value             [description]\r\n   * @param  {[type]}  oper              [description]\r\n   * @param  {[type]}  retain            [description]\r\n   * @param  {Boolean} isItInsertWithAtt [description]\r\n   * @return {[type]}                    [description]\r\n   */\r\n  sendIt(text, att, start, value, oper, retain, isItInsertWithAtt) {\r\n    switch (oper) {\r\n      case \"retain\":\r\n        if (att != \"\") {\r\n          let isItInsertWithAtt = true\r\n\r\n          // the value in this case is the end of format \r\n\r\n          // insert the changed text with the new attributes\r\n\r\n          // 1 delete the changed text  from retain to value\r\n          this.sendIt(\"\", \"\", retain, value, \"delete\", retain, isItInsertWithAtt)\r\n\r\n          // 2 insert with attributes\r\n          var Deltat = this.viewEditor.editor.delta.slice(retain, retain + value)\r\n\r\n          this.applyChanges(Deltat, retain)\r\n\r\n        } else {\r\n          retain += value\r\n\r\n        }\r\n\r\n        // If there is attributes than delete and then insert   \r\n        break\r\n\r\n      case \"insert\":\r\n        text = value\r\n        // Insert character by character or by object for the other formats\r\n\r\n        // this is a formula\r\n        if (value.formula != undefined) {\r\n\r\n          att = this.viewEditor.getFormat(retain, 1)\r\n          this.model.core.insert({\r\n            type: 'formula',\r\n            text: value,\r\n            att: att\r\n          }, retain)\r\n        } else\r\n\r\n        {\r\n\r\n          // this is a video\r\n          if (value.video != undefined) {\r\n\r\n            att = this.viewEditor.getFormat(retain, 1)\r\n            this.model.core.insert({\r\n              type: 'video',\r\n              text: value,\r\n              att: att\r\n            }, retain)\r\n\r\n\r\n          } else {\r\n            // It is an image\r\n            if (value.image != undefined) {\r\n\r\n              att = this.viewEditor.getFormat(retain, 1)\r\n\r\n              this.model.core.insert({\r\n                type: 'image',\r\n                text: value,\r\n                att: att\r\n              }, retain)\r\n\r\n            } else { // text\r\n\r\n              for (var i = retain; i < (retain + text.length); ++i) {\r\n                att = this.viewEditor.getFormat(i, 1)\r\n               debug(\"Local insert : \", text[i - retain], i)\r\n                this.model.core.insert({\r\n                  type: 'char',\r\n                  text: text[i - retain],\r\n                  att: att\r\n                }, i)\r\n              }\r\n              retain = retain + text.length\r\n            }\r\n          }\r\n        }\r\n        break\r\n\r\n      case \"delete\":\r\n        var length = value\r\n\r\n        //to ensure that the editor contains just \\n without any attributes \r\n        if (!isItInsertWithAtt) {\r\n          this.UpdateComments()\r\n        }\r\n        if (start == 0) {\r\n          start = retain\r\n        }\r\n        // Delete caracter by caracter\r\n\r\n        for (var i = start; i < (start + length); ++i) {\r\n          this.model.core.remove(start)\r\n\r\n        }\r\n        break\r\n    }\r\n    return retain\r\n  }\r\n\r\n  /**\r\n   * remoteInsert At the reception of insert operation\r\n   * @param  {[type]} element [description]\r\n   * @param  {[type]} indexp  [description]\r\n   * @return {[type]}         [description]\r\n   */\r\n  remoteInsert(element, indexp) {\r\n    var index = indexp - 1\r\n\r\n    debug(\"Remote Insert : \", element, index)\r\n\r\n    if (index !== -1) {\r\n      switch (element.type) {\r\n        case \"formula\":\r\n          this.viewEditor.insertEmbed(index, 'formula', element.text.formula, 'silent')\r\n\r\n          break\r\n        case \"image\":\r\n          this.viewEditor.insertEmbed(index, 'image', element.text.image, 'silent')\r\n\r\n          break\r\n        case \"video\":\r\n          this.viewEditor.insertEmbed(index, 'video', element.text.video, 'silent')\r\n\r\n          break\r\n        case \"char\":\r\n          this.viewEditor.insertText(index, element.text, element.att, 'silent')\r\n\r\n          if (element.text != \"\\n\") {\r\n            this.viewEditor.removeFormat(index, 1, 'silent')\r\n          }\r\n          break\r\n      }\r\n      if (element.att) {\r\n        if (element.text != \"\\n\") {\r\n          this.viewEditor.formatLine(index, element.att, 'silent')\r\n          this.viewEditor.formatText(index, 1, element.att, 'silent')\r\n        }\r\n\r\n        if (element.att.commentAuthor) {\r\n          this.UpdateComments()\r\n        }\r\n\r\n        if (element.att.link) {\r\n          session.default.openIn()\r\n        }\r\n\r\n\r\n\r\n      }\r\n\r\n\r\n    }\r\n    session.default.openIn()\r\n    this.cleanQuill()\r\n  }\r\n\r\n  /**\r\n   * remoteRemove At the reception of remove operation\r\n   * @param  {[type]} index [description]\r\n   * @return {[type]}       [description]\r\n   */\r\n  remoteRemove(index) {\r\n\r\n    debug(\"Remote remove : \", index)\r\n    let removedIndex = index - 1\r\n    if (removedIndex !== -1) {\r\n      this.viewEditor.deleteText(removedIndex, 1, 'silent')\r\n      this.UpdateComments()\r\n    }\r\n    this.cleanQuill()\r\n  }\r\n\r\n\r\n  /**\r\n   * remoteCaretMoved At the reception of CARET position\r\n   * @param  {[type]} range  [description]\r\n   * @param  {[type]} origin [description]\r\n   * @return {[type]}        [description]\r\n   */\r\n  remoteCaretMoved(range, origin) {\r\n    if (!origin) return\r\n\r\n    if (this.markers[origin]) {\r\n      this.markers[origin].update(range, true) // to keep avatar\r\n\r\n    } else {\r\n      let options = {\r\n        lifeTime: 5 * 1000,\r\n        range,\r\n        cursor: false,\r\n        isItME: false\r\n      }\r\n      this.markers[origin] = new Marker(origin, options, this)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * cleanQuill description\r\n   * @return {[type]} [description]\r\n   */\r\n  cleanQuill() {\r\n\r\n    /*\r\n           delta = quill.editor.delta\r\n           console.log('before clean')\r\n           console.dir(delta)\r\n           \r\n           lastOperation=delta.ops.length-1\r\n           if (delta.ops[lastOperation].insert=='\\n' && lastOperation != 0) {\r\n\r\n            attributes= delta.ops[lastOperation].attributes\r\n            delete delta.ops[lastOperation]  \r\n\r\n            //delta.ops.splice(length-1,1)\r\n\r\n           if(lastOperation-1 != 0 && delta.ops[lastOperation-1]) {\r\n              delta.ops[lastOperation-1].attributes=attributes\r\n            }\r\n\r\n            }\r\n\r\n           /*if (delta.ops[0].insert=='\\n' &&  quill.getLength() <=2) {\r\n            delta.ops[0].attributes={}\r\n            }\r\n\r\n           console.log('after clean')\r\n           console.dir(delta)\r\n             \r\n          //quill.setContents(delta,'silent')*/\r\n  }\r\n\r\n\r\n  /**\r\n   * changeTitle For any change in title, broadcast the new title\r\n   * @return {[type]} [description]\r\n   */\r\n  changeTitle() {\r\n    jQuery(`#${this._editorContainerID} #title`).attr('contenteditable', 'false')\r\n    if (jQuery(`#${this._editorContainerID} #title`).text() == \"\") {\r\n      jQuery(`#${this._editorContainerID} #title`).text('Untitled document')\r\n    }\r\n    this.model.name = jQuery(`#${this._editorContainerID} #title`).text()\r\n    //TODO: Optimize change only if the text is changed from last state \r\n    this.model.core.sendChangeTitle(jQuery(`#${this._editorContainerID} #title`).text())\r\n  }\r\n\r\n\r\n  /**\r\n   * startPing send periodically ping\r\n   * @param  {[type]} interval [description]\r\n   * @return {[type]}          [description]\r\n   * @todo TODO: Make interval as global parameter\r\n   */\r\n  startPing(interval) {\r\n    this.startTimer = setInterval(() => {\r\n      let pseudo = \"Anonymous\"\r\n      if (store.get('myId').pseudo) {\r\n        pseudo = store.get('myId').pseudo;\r\n      }\r\n      this.model.core.sendPing(pseudo)\r\n    }, interval)\r\n  }\r\n\r\n  /**\r\n   * stopPing stopPing\r\n   * @todo  implement this function\r\n   * @return {[type]} [description]\r\n   */\r\n  stopPing() {\r\n    clearInterval(this.startTimer);\r\n  }\r\n\r\n  /**\r\n   * atPing at the reception of ping\r\n   * @param  {[type]} origin [description]\r\n   * @param  {[type]} pseudo [description]\r\n   * @return {[type]}        [description]\r\n   */\r\n  atPing(origin, pseudo) {\r\n    if (this.markers[origin]) {\r\n      this.markers[origin].update(null, false) // to keep avatar\r\n      this.markers[origin].setPseudo(pseudo)\r\n\r\n    } else { // to create the avatar\r\n      //this.markers.push(origin)\r\n      //\r\n\r\n      let options = {\r\n        lifeTime: 5 * 1000,\r\n        range: {\r\n          index: 0,\r\n          length: 0\r\n        },\r\n        cursor: false,\r\n        isItME: false\r\n      }\r\n      this.markers[origin] = new Marker(origin, options, this)\r\n      this.markers[origin].setPseudo(pseudo)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * UpdateComments This function to extract the comments form the editor and show them in #comments\r\n   */\r\n  UpdateComments() {\r\n    // clear comments \r\n    jQuery(`#${this._editorContainerID} #comments`).empty()\r\n    // for each insert check att if it contains the author then insert comment \r\n    this.viewEditor.editor.delta.ops.forEach((op) => {\r\n      if (op.insert) {\r\n        if (op.attributes) {\r\n          if (op.attributes.commentAuthor) {\r\n            var id = op.attributes.commentAuthor\r\n            //\r\n            let m = {}\r\n            if (this.markers[id]) {\r\n              m = this.markers[id]\r\n            } else {\r\n              m = {\r\n                animal: Marker.getPseudoname(id, null),\r\n                pseudoName: Marker.getPseudoname(id),\r\n                colorRGB: Marker.getColor(id, 'rgb')\r\n              }\r\n            }\r\n\r\n            let animal = m.animal\r\n            let pseudoName = m.pseudoName\r\n            let colorRGB = m.colorRGB\r\n\r\n            this._comments.addCommentToList(op.attributes.comment, id, animal, pseudoName, colorRGB, op.attributes.commentTimestamp)\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n\r\n\r\n    })\r\n\r\n  }\r\n\r\n  saveComment() {\r\n    this._comments.saveComment();\r\n  }\r\n\r\n\r\n}\r\n"," //require('jquery-qrcode')\r\n/**\r\n * Marker is class for managing the marker of one user,it includes the caret, avatar, and pseudo Names.\r\n */\r\n\r\nexport default class StatesHeader {\r\n    /**\r\n     * StatesHeader is class that is for showing the state of the network, share option of the document.\r\n     * @param  {[type]} model     [description]\r\n     * @param  {[type]} linkView  [description]\r\n     * @param  {[type]} shareView [description]\r\n     * @return {[type]}           [description]\r\n     */\r\n    constructor(model, linkView, shareView, editorContainerID) {\r\n\r\n        this.model = model\r\n        this.startSharingText = '<i class=\"fa fa-link fa-2x ficon2\"></i>'\r\n        this.startSharingTooltip = 'start sharing'\r\n        this.stopSharingText = '<i class=\"fa fa-unlink fa-2x ficon2\"></i>'\r\n        this.stopSharingTooltip = 'stop sharing'\r\n\r\n        this.red = \"#cd2626\"\r\n        this.yellow = \"#eead0e\"\r\n        this.green = \"#228b22\"\r\n        this.blue = \"#00BFFF\"\r\n        this._editorContainerID = editorContainerID\r\n        this.networkState = jQuery(`#${this._editorContainerID} #state`)\r\n\r\n        this.setNetworkState(\"connected\");\r\n        model.rps.on(\"statechange\", (state) => {\r\n            switch (state) {\r\n                case 'connected':\r\n                    this.setNetworkState('connected')\r\n                    break\r\n                case 'partially connected':\r\n                    this.setNetworkState('partiallyConnected')\r\n                    break\r\n                case 'disconnected':\r\n                    this.setNetworkState('disconnected')\r\n                    break\r\n            }\r\n        })\r\n\r\n        shareView.click(() => {\r\n            var address = (window.location.href).split('?')[0]\r\n            linkView.printLink(address + \"?\" + this.model.signalingOptions.session)\r\n\r\n            jQuery(`#${this._editorContainerID} #copyButton`).click(() => {\r\n                this.copyLink()\r\n            })\r\n\r\n        })\r\n\r\n        linkView.qrcode.click(() => {\r\n            var address = (window.location.href).split('?')[0]\r\n            address = address + \"?\" + this.model.signalingOptions.session\r\n            linkView.qrcodeCanvas.html(\"\")\r\n            linkView.qrcodeCanvas.qrcode({\r\n                size: 400,\r\n                text: address\r\n            })\r\n        })\r\n    }\r\n\r\n\r\n    /**\r\n     * copyLink copy the link of the document\r\n     * @return {[type]} [description]\r\n     */\r\n    copyLink() {\r\n        console.log(`Copy => #${this._editorContainerID} #sessionUrl`)\r\n        jQuery(`#${this._editorContainerID} #sessionUrl`).select()\r\n        document.execCommand(\"Copy\")\r\n    }\r\n\r\n\r\n    /**\r\n     * Set the state of the network on the browser \r\n     * @param {[type]} state set three different states according Spray protocol states:'connected', 'partiallyconnected', and 'disconnected' \r\n     */\r\n    setNetworkState(state) {\r\n        switch (state) {\r\n            case \"connected\":\r\n                var connectedString =\r\n                    `<span class='alert-success'>Congratulations!</span>\r\n                     You are connected to people, and people are \r\n                     connected to you. <span class='alert-info'>You can start editing \" \r\n                     together</span>.`\r\n                this.networkState.css(\"color\", this.green)\r\n                this.networkState.attr(\"data-content\", connectedString)\r\n                break\r\n            case \"partiallyConnected\":\r\n                var partiallyConnectedString =\r\n                    `<span class='alert-warning'>Partially connected</span>: \r\n                     either you are connected to people, or people are connected to you. \r\n                     This is not great, but you <span class='alert-info'> still can edit.</span>`\r\n\r\n                this.networkState.css(\"color\", this.green)\r\n                this.networkState.attr(\"data-content\", partiallyConnectedString)\r\n                break\r\n            case \"disconnected\":\r\n                var disconnectedString =\r\n                    `<span class='alert-danger'>Disconnected</span>:\r\n                     you are currently editing <span class='alert-info'>on\r\n                    your own</span>.`\r\n                this.networkState.css(\"color\", this.red)\r\n                this.networkState.attr(\"data-content\", disconnectedString)\r\n                break\r\n        }\r\n    }\r\n}\r\n","/**\r\n * This class is for the interface of the sharing link with QRcode\r\n */\r\nexport default class LinkView {\r\n    /**\r\n     * [constructor description]\r\n     * @param  {[type]} container [description]\r\n     * @param  {[type]} id        [description]\r\n     * @return {[type]}           [description]\r\n     */\r\n    constructor(container, id) {\r\n        this.linkContainer = jQuery('<div>').appendTo(container)\r\n            .css('position', 'relative')\r\n            .css('top', '0px')\r\n            .css('width', '45vw-25px')\r\n            .css('z-index', '0')\r\n            .css('opacity', '0.9')\r\n            .attr('id', 'linkContainer')\r\n            .hide();\r\n\r\n\r\n        // #0 qr code modal\r\n        var qrCodeModal = jQuery('<div>').appendTo(container)\r\n            .attr('id', 'modalQRCode' + id)\r\n            .attr('tabindex', '-1')\r\n            .attr('role', 'dialog')\r\n            .attr('aria-labelledby', 'modalQRCodeLabel')\r\n            .attr('aria-hidden', 'true')\r\n            .addClass('modal');\r\n\r\n        var qrCodeModalDialog = jQuery('<div>').appendTo(qrCodeModal)\r\n            .addClass('modal-dialog');\r\n        var qrCodeModalContent = jQuery('<div>').appendTo(qrCodeModalDialog)\r\n            .addClass('modal-content text-center');\r\n        this.qrcodeCanvas = jQuery('<div>');\r\n        qrCodeModalContent.append(jQuery('<br>'))\r\n            .append(this.qrcodeCanvas)\r\n            .append(jQuery('<br>'));\r\n\r\n        // #1 overall division\r\n        this.alert = jQuery('<div>').appendTo(this.linkContainer);\r\n        // #2 cross to close the division\r\n        this.dismiss = jQuery('<button>').appendTo(this.alert)\r\n            .attr('type', 'button')\r\n            .addClass('close')\r\n            .html('<span  aria-hidden=\"true\">&times;</span><span class=\"sr-only\"> ' +\r\n                'Close </span>');\r\n        var rowContainer = jQuery('<div>').appendTo(this.alert)\r\n            .addClass('container');\r\n        var inputGroup = jQuery('<div>').appendTo(rowContainer)\r\n            .addClass('input-group')\r\n            .attr('style', 'margin-left: -16px;');\r\n        this.input = jQuery('<input>').appendTo(inputGroup)\r\n            .attr('type', 'text')\r\n            .attr('id', 'sessionUrl')\r\n            .attr('placeholder', 'Nothing to see here, move along.')\r\n            .addClass('form-control');\r\n\r\n        var inputGroup2 = jQuery('<span>').appendTo(inputGroup)\r\n            .addClass('input-group-btn');\r\n\r\n        this.qrcode = jQuery('<button>').appendTo(inputGroup2)\r\n            .attr('aria-label', 'QR-code')\r\n            .attr('type', 'button')\r\n            .attr('data-target', '#modalQRCode' + id)\r\n            .attr('data-toggle', 'modal')\r\n            .addClass('btn btn-default')\r\n            .html('<i class=\"fa fa-qrcode\"></i>');\r\n\r\n        this.action = jQuery('<button  id=\"copyButton\">').appendTo(inputGroup2)\r\n            .attr('aria-label', 'Go!')\r\n            .attr('type', 'button')\r\n            .addClass('btn btn-default')\r\n            .html('Go!')\r\n            .css('z-index', '15');\r\n\r\n        var self = this;\r\n        this.dismiss.unbind(\"click\").click(function() {\r\n            self.linkContainer.hide();\r\n        });\r\n    };\r\n    /**\r\n     * [printLink description]\r\n     * @param  {[type]} link [description]\r\n     * @return {[type]}      [description]\r\n     */\r\n    printLink(link) {\r\n        this.linkContainer.show();\r\n        this.action.html('<i class=\"fa fa-clipboard\"></i>');\r\n        this.action.attr(\"aria-label\", \"Copy to clipboard\");\r\n        this.input.attr(\"readonly\", \"readonly\");\r\n        this.input.val(link);\r\n        this.qrcode.show();\r\n    };\r\n\r\n    /**\r\n     * [printLaunchLink description]\r\n     * @param  {[type]} link [description]\r\n     * @return {[type]}      [description]\r\n     */\r\n    printLaunchLink(link) {\r\n        this.printLink(link);\r\n        this.input.attr(\"placeholder\",\r\n            \"A link will appear in this field, give it to your \" +\r\n            \"friend!\");\r\n        this.action.unbind(\"click\");\r\n        this.qrcode.hide();\r\n        return this.action;\r\n    };\r\n    /**\r\n     * [printAnswerLink description]\r\n     * @param  {[type]} link [description]\r\n     * @return {[type]}      [description]\r\n     */\r\n    printAnswerLink(link) {\r\n        this.printLink(link);\r\n        this.input.attr(\"placeholder\",\r\n            \"A link will appear in this field. Please give it \" +\r\n            \"back to your friend.\");\r\n        this.action.unbind(\"click\");\r\n        this.qrcode.hide();\r\n        return this.action;\r\n    };\r\n    /**\r\n     * [askLink description]\r\n     * @return {[type]} [description]\r\n     */\r\n    askLink() {\r\n        this.linkContainer.show();\r\n        this.alert.removeClass(\"alert-warning\").addClass(\"alert-info\");\r\n        this.action.html('Go!');\r\n        this.action.attr(\"aria-label\", \"Stamp the ticket\");\r\n        this.input.removeAttr(\"readonly\");\r\n        this.input.val(\"\");\r\n        this.action.unbind(\"click\");\r\n        this.qrcode.hide();\r\n    };\r\n    /**\r\n     * [askLaunchLink description]\r\n     * @return {[type]} [description]\r\n     */\r\n    askLaunchLink() {\r\n        this.askLink();\r\n        this.input.attr(\"placeholder\",\r\n            \"Please, copy the ticket of your friend here to stamp \" +\r\n            \"it!\");\r\n        this.qrcode.hide();\r\n        return this.action;\r\n    };\r\n    /**\r\n     * [askAnswerLink description]\r\n     * @return {[type]} [description]\r\n     */\r\n    askAnswerLink() {\r\n        this.askLink();\r\n        this.input.attr(\"placeholder\", \"Copy the stamped ticket to confirm \" +\r\n            \"your arrival in the network\");\r\n        this.qrcode.hide();\r\n        return this.action;\r\n    };\r\n    /**\r\n     * [hide description]\r\n     * @return {[type]} [description]\r\n     */\r\n    hide() {\r\n        this.linkContainer.hide();\r\n    };\r\n}\r\n"],"sourceRoot":""}